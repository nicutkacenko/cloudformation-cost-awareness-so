{"Id": "52538295", "PostTypeId": "1", "CreationDate": "2018-09-27T13:33:55.270", "Score": "0", "ViewCount": "318", "Body": "<p>I am looking to use CloudFormation templates alongside AMI's for which I installed and configured my software to simplify deployment of software setups to a handful of regions and maybe other AWS accounts.</p>\n\n<p>One issue is that the AMI for creating EC2 instances must be in the region, and also the ID gets changed when copying it. Since this is only for a small number of deployments, and most of the images are not needed after the instance is created, I would like to avoid having to copy (and pay for) every image to every region just in case.</p>\n\n<p>Instead is there some way to have my template copy the AMI (e.g. <code>copy-image</code> CLI ) and then use that with the Instance? Ideally it would also delete the AMI afterwards (e.g. <code>deregister-image</code> and <code>delete-snapshot</code>) where being used for persistent EC2 instances or on stack deletion/rollback.</p>\n", "OwnerUserId": "6266", "LastActivityDate": "2018-09-27T13:33:55.270", "Title": "CloudFormation copy AMI to region on demand", "Tags": "|amazon-web-services|amazon-ec2|deployment|aws-cloudformation|", "AnswerCount": "0", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "92020799", "PostId": "52538295", "Score": "0", "Text": "You could potentially do this with CloudFormation Custom Resources which allows your template to create, update, or delete a custom resource (the AMI in the remote region). I'm not sure this is a great idea because AMI copy may be slow but something to look at. Or simply surround your CF stack operations with a script that does the necessary AMI work outside of the CF template.", "CreationDate": "2018-09-27T15:32:17.773", "UserId": "271415", "filtered-sentences": []}, {"Id": "92021427", "PostId": "52538295", "Score": "0", "Text": "Timeout issues? While I realise copying that many GB of data will take some time, but the time is spent to get the AMI's to the region somewhere and I want the minimal chance of me/someone screwing it up and putting in the wrong AMI ID parameter or something. Will look at the customer resources. A script is an option, I was liking the idea of just providing the S3 template URL and using the console, but perhaps a custom script/UI frontend is inevitable", "CreationDate": "2018-09-27T15:49:22.997", "UserId": "6266", "filtered-sentences": []}, {"Id": "92021620", "PostId": "52538295", "Score": "0", "Text": "* \"custom\" not \"customer\" resources", "CreationDate": "2018-09-27T15:54:57.823", "UserId": "6266", "filtered-sentences": []}], "history": [{"Id": "182630475", "PostHistoryTypeId": "2", "PostId": "52538295", "RevisionGUID": "e0282baf-4d87-462c-8d7d-a1dd856fed6a", "CreationDate": "2018-09-27T13:33:55.270", "UserId": "6266", "Text": "I am looking to use CloudFormation templates alongside AMI's for which I installed and configured my software to simplify deployment of software setups to a handful of regions and maybe other AWS accounts.\r\n\r\nOne issue is that the AMI for creating EC2 instances must be in the region, and also the ID gets changed when copying it. Since this is only for a small number of deployments, and most of the images are not needed after the instance is created, I would like to avoid having to copy (and pay for) every image to every region just in case.\r\n\r\nInstead is there some way to have my template copy the AMI (e.g. `copy-image` CLI ) and then use that with the Instance? Ideally it would also delete the AMI afterwards (e.g. `deregister-image` and `delete-snapshot`) where being used for persistent EC2 instances or on stack deletion/rollback.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "One issue is that the AMI for creating EC2 instances must be in the region, and also the ID gets changed when copying it. ", "keywords": ["change"]}, {"source": "Text", "text": "Since this is only for a small number of deployments, and most of the images are not needed after the instance is created, I would like to avoid having to copy (and pay for) every image to every region just in case. ", "keywords": ["pay", "instance"]}, {"source": "Text", "text": "Instead is there some way to have my template copy the AMI (e.g. `copy-image` CLI ) and then use that with the Instance? ", "keywords": ["instance"]}]}, {"Id": "182630476", "PostHistoryTypeId": "1", "PostId": "52538295", "RevisionGUID": "e0282baf-4d87-462c-8d7d-a1dd856fed6a", "CreationDate": "2018-09-27T13:33:55.270", "UserId": "6266", "Text": "CloudFormation copy AMI to region on demand", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "182630477", "PostHistoryTypeId": "3", "PostId": "52538295", "RevisionGUID": "e0282baf-4d87-462c-8d7d-a1dd856fed6a", "CreationDate": "2018-09-27T13:33:55.270", "UserId": "6266", "Text": "|amazon-web-services|amazon-ec2|deployment|aws-cloudformation|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "One issue is that the AMI for creating EC2 instances must be in the region, and also the ID gets changed when copying it. ", "keywords": ["change"]}, {"source": "Body", "text": "Since this is only for a small number of deployments, and most of the images are not needed after the instance is created, I would like to avoid having to copy (and pay for) every image to every region just in case. ", "keywords": ["pay", "instance"]}, {"source": "Body", "text": "Instead is there some way to have my template copy the AMI (e.g. copy-image CLI ) and then use that with the Instance? ", "keywords": ["instance"]}]}