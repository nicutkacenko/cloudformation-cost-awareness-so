{"Id": "51596254", "PostTypeId": "1", "CreationDate": "2018-07-30T14:26:59.183", "Score": "11", "ViewCount": "1725", "Body": "<p>Just wondering whats the best practice for determining what permissions I should give for my CloudFormation template? </p>\n\n<p>After some time of trying to give the minimal permissions it require, I find that thats really time consuming and error prone. I note that depending on the state of my stack, really new vs some updates vs delete, I will need different permissions. </p>\n\n<p>I guess, it should be possible for there to be some parser that given a CloudFormation template can determine the minimum set of permissions it require? </p>\n\n<p>Maybe I can give <code>ec2:*</code> access to resources tagged <code>Cost Center: My Project Name</code>? Is this ok? But I wonder what happens when I change my project name for example? </p>\n\n<p>Alternatively, isit ok to assume its ok to give say <code>ec2:*</code> access based on the assumption the CloudFormation parts is usually only executed off CodeCommit/Github/CodePipeline and its not something that is likely to be public/easy to hack? --- Tho this sounds like a flawed statement to me ...</p>\n", "OwnerUserId": "292291", "LastActivityDate": "2020-04-28T20:44:18.513", "Title": "Is there anyway to determine what IAM permissions I actually need for a CloudFormation template?", "Tags": "|amazon-web-services|aws-cloudformation|amazon-iam|", "AnswerCount": "1", "CommentCount": "3", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "90158929", "PostId": "51596254", "Score": "4", "Text": "I discussed this with multiple AWS engineers at a conference and their answer was: \"not really\". Best way is to assign nothing and see what errors it throws.", "CreationDate": "2018-07-30T14:40:50.417", "UserId": "199682", "filtered-sentences": []}, {"Id": "90159119", "PostId": "51596254", "Score": "0", "Text": "@Exelian omg ... have been doing that like for nearly 2 days already ... and I didnt even give all access ... I just read through the list and try to select only those I think I need ... even then I took so long ...", "CreationDate": "2018-07-30T14:45:51.240", "UserId": "292291", "filtered-sentences": []}, {"Id": "134111843", "PostId": "51596254", "Score": "0", "Text": "@JiewMeng did you ever find a solution to this that you were happy with?", "CreationDate": "2023-04-18T08:19:51.840", "UserId": "366529", "filtered-sentences": []}], "history": [{"Id": "178716777", "PostHistoryTypeId": "2", "PostId": "51596254", "RevisionGUID": "613213b7-6eda-49ff-8e09-68bbd2dd8b69", "CreationDate": "2018-07-30T14:26:59.183", "UserId": "292291", "Text": "Just wondering whats the best practice for determining what permissions I should give for my CloudFormation template? \r\n\r\nAfter some time of trying to give the minimal permissions it require, I find that thats really time consuming and error prone. I note that depending on the state of my stack, really new vs some updates vs delete, I will need different permissions. \r\n\r\nI guess, it should be possible for there to be some parser that given a CloudFormation template can determine the minimum set of permissions it require? \r\n\r\nMaybe I can give `ec2:*` access to resources tagged `Cost Center: My Project Name`? Is this ok? But I wonder what happens when I change my project name for example? \r\n\r\nAlternatively, isit ok to assume its ok to give say `ec2:*` access based on the assumption the CloudFormation parts is usually only executed off CodeCommit/Github/CodePipeline and its not something that is likely to be public/easy to hack? --- Tho this sounds like a flawed statement to me ...", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "access to resources tagged `Cost Center: My Project Name`? ", "keywords": ["cost"]}, {"source": "Text", "text": "But I wonder what happens when I change my project name for example? ", "keywords": ["change"]}]}, {"Id": "178716778", "PostHistoryTypeId": "1", "PostId": "51596254", "RevisionGUID": "613213b7-6eda-49ff-8e09-68bbd2dd8b69", "CreationDate": "2018-07-30T14:26:59.183", "UserId": "292291", "Text": "Is there anyway to determine what IAM permissions I actually need for a CloudFormation template?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "178716779", "PostHistoryTypeId": "3", "PostId": "51596254", "RevisionGUID": "613213b7-6eda-49ff-8e09-68bbd2dd8b69", "CreationDate": "2018-07-30T14:26:59.183", "UserId": "292291", "Text": "|amazon-web-services|aws-cloudformation|amazon-iam|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "61489646", "PostTypeId": "2", "ParentId": "51596254", "CreationDate": "2020-04-28T20:44:18.513", "Score": "4", "Body": "<p>In the short term, you can use <a href=\"https://github.com/iann0036/aws-leastprivilege\" rel=\"nofollow noreferrer\">aws-leastprivilege</a>. <a href=\"https://github.com/iann0036/aws-leastprivilege/tree/master/cfnlp/mappings\" rel=\"nofollow noreferrer\">But it doesn't support every resource type</a>.</p>\n\n<p>For the long term: <a href=\"https://www.youtube.com/watch?v=pRGF7TidkNM&amp;feature=youtu.be&amp;t=2786\" rel=\"nofollow noreferrer\">as mentioned in this 2019 re:invent talk</a>, CloudFormation is working towards open sourcing and migrating most of its resource types to a new public <a href=\"https://github.com/aws-cloudformation/aws-cloudformation-resource-schema\" rel=\"nofollow noreferrer\">resource schema</a>. One of the benefits of this is that you'll be able to see  the permissions required to perform each operation. </p>\n\n<p>E.g. for <a href=\"https://github.com/aws-cloudformation/aws-cloudformation-resource-providers-imagebuilder/tree/master/image\" rel=\"nofollow noreferrer\">AWS::ImageBuilder::Image</a>, the schema says</p>\n\n<pre><code>    \"handlers\": {\n        \"create\": {\n            \"permissions\": [\n                \"iam:GetRole\",\n                \"imagebuilder:GetImageRecipe\",\n                \"imagebuilder:GetInfrastructureConfiguration\",\n                \"imagebuilder:GetDistributionConfiguration\",\n                \"imagebuilder:GetImage\",\n                \"imagebuilder:CreateImage\",\n                \"imagebuilder:TagResource\"\n            ]\n        },\n        \"read\": {\n            \"permissions\": [\n                \"imagebuilder:GetImage\"\n            ]\n        },\n        \"delete\": {\n            \"permissions\": [\n                \"imagebuilder:GetImage\",\n                \"imagebuilder:DeleteImage\",\n                \"imagebuilder:UnTagResource\"\n            ]\n        },\n        \"list\": {\n            \"permissions\": [\n                \"imagebuilder:ListImages\"\n            ]\n        }\n    }\n</code></pre>\n", "OwnerUserId": "1623249", "LastActivityDate": "2020-04-28T20:44:18.513", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "220354698", "PostHistoryTypeId": "2", "PostId": "61489646", "RevisionGUID": "126ad752-3bea-4a00-8e10-3087351c2268", "CreationDate": "2020-04-28T20:44:18.513", "UserId": "1623249", "Text": "In the short term, you can use [aws-leastprivilege](https://github.com/iann0036/aws-leastprivilege). [But it doesn't support every resource type](https://github.com/iann0036/aws-leastprivilege/tree/master/cfnlp/mappings).\r\n\r\nFor the long term: [as mentioned in this 2019 re:invent talk](https://www.youtube.com/watch?v=pRGF7TidkNM&feature=youtu.be&t=2786), CloudFormation is working towards open sourcing and migrating most of its resource types to a new public [resource schema](https://github.com/aws-cloudformation/aws-cloudformation-resource-schema). One of the benefits of this is that you'll be able to see  the permissions required to perform each operation. \r\n\r\nE.g. for [AWS::ImageBuilder::Image](https://github.com/aws-cloudformation/aws-cloudformation-resource-providers-imagebuilder/tree/master/image), the schema says\r\n\r\n```json\r\n    \"handlers\": {\r\n        \"create\": {\r\n            \"permissions\": [\r\n                \"iam:GetRole\",\r\n                \"imagebuilder:GetImageRecipe\",\r\n                \"imagebuilder:GetInfrastructureConfiguration\",\r\n                \"imagebuilder:GetDistributionConfiguration\",\r\n                \"imagebuilder:GetImage\",\r\n                \"imagebuilder:CreateImage\",\r\n                \"imagebuilder:TagResource\"\r\n            ]\r\n        },\r\n        \"read\": {\r\n            \"permissions\": [\r\n                \"imagebuilder:GetImage\"\r\n            ]\r\n        },\r\n        \"delete\": {\r\n            \"permissions\": [\r\n                \"imagebuilder:GetImage\",\r\n                \"imagebuilder:DeleteImage\",\r\n                \"imagebuilder:UnTagResource\"\r\n            ]\r\n        },\r\n        \"list\": {\r\n            \"permissions\": [\r\n                \"imagebuilder:ListImages\"\r\n            ]\r\n        }\r\n    }\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "For the long term: [as mentioned in this 2019 re:invent talk](https://www.youtube.com/watch?v=pRGF7TidkNM&feature=youtu.be&t=2786), CloudFormation is working towards open sourcing and migrating most of its resource types to a new public [resource schema](https://github.com/aws-cloudformation/aws-cloudformation-resource-schema). ", "keywords": ["feature"]}]}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "Maybe I can give ec2:* access to resources tagged Cost Center: My Project Name? ", "keywords": ["cost"]}, {"source": "Body", "text": "But I wonder what happens when I change my project name for example? ", "keywords": ["change"]}]}