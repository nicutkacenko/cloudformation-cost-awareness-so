{"Id": "44856905", "PostTypeId": "1", "AcceptedAnswerId": "44866654", "CreationDate": "2017-07-01T02:41:57.633", "Score": "-2", "ViewCount": "3183", "Body": "<p>Here is a working Amazon CloudFormation JSON template that creates an Amazon EC2 Windows 2016 instance.</p>\n\n<p>I want to attach an EBS volume that is backed-up on an S3 bucket. How can I do this? Any pointers please?</p>\n\n<pre><code>  {\n\"Parameters\" :{\n    \"KeyName\" : {\n        \"Description\" : \"Name of the existing EC2 KeyPair\",\n     \"Type\" : \"String\"\n    }\n },\n \"Mappings\" : {\n\"RegionMap\" : {\n   \"us-east-1\" : {\n    \"AMI\" : \"ami-48b4bf31\"\n   },\n   \"us-west-1\": {\n    \"AMI\" : \"ami-48b4bf31\"\n    },\n       \"us-west-2\":{\n            \"AMI\" : \"ami-48b4bf31\"\n       }        \n}\n },\n \"Resources\" :  {\n  \"Ec2Instance\" : {\n          \"Type\" : \"AWS::EC2::Instance\",\n      \"Properties\": {\n            \"KeyName\" : {\"Ref\" : \"KeyName\"},\n        \"ImageId\" : { \"Fn::FindInMap\" : [ \"RegionMap\", { \"Ref\" : \"AWS::Region\" }, \"AMI\" ]}\n\n          }         \n   }    \n  },\n  \"Outputs\" : {\n  \"AvailablityZone\" : {\n        \"Description\" : \"Availability Zone of the newly created EC2 instance\",\n        \"Value\" : { \"Fn::GetAtt\" : [ \"Ec2Instance\", \"AvailabilityZone\" ] }\n      },\n  \"PublicIp\" :{\n    \"Description\" : \"Public IP is\",\n    \"Value\": {\"Fn::GetAtt\": [\"Ec2Instance\", \"PublicIp\"] }\n\n    }\n\n}   \n}\n</code></pre>\n", "OwnerUserId": "8201204", "LastEditorUserId": "174777", "LastEditDate": "2017-07-02T01:09:44.770", "LastActivityDate": "2018-06-27T00:44:35.007", "Title": "AWS cloudformation - how to attach EBS volume to EC2 windows instance", "Tags": "|amazon-web-services|aws-cloudformation|amazon-ami|", "AnswerCount": "2", "CommentCount": "3", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "76695880", "PostId": "44856905", "Score": "0", "Text": "If folks are interested in creating a venue for these types of questions, follow the proposal for a [dedicated Cloud Computing site on StackExchange](https://area51.stackexchange.com/proposals/110490/cloud-computing-aws-azure-google-openstack-etc?referrer=Gtut7wQSWPk88jFJz_zqMg2) and up-vote some sample questions.", "CreationDate": "2017-07-01T06:04:06.273", "UserId": "174777", "filtered-sentences": []}, {"Id": "76695935", "PostId": "44856905", "Score": "0", "Text": "Could you please clarify what you currently have? Is it an Amazon EBS volume, an AMI or an Amazon EBS snapshot? Also, is it going to be your boot volume (C:) or a secondary volume?", "CreationDate": "2017-07-01T06:08:33.127", "UserId": "174777", "filtered-sentences": []}, {"Id": "76703055", "PostId": "44856905", "Score": "0", "Text": "The plan is to host a server on AWS. That servers has 2 or 3 EBS volumes attached to it. We will be taking backups of those volumes on daily basis to S3 bucket. And also we will have an AMI of that server. If that server goes down due to any reason, using a Cloudformation template we want to bring that instance back from AMI and attach the EBS volumes from S3 bucket. so far I wrote the code to bring up the E2instance from AMI as shown above. I am trying to understand how to attach the EBS volumes to the instance.", "CreationDate": "2017-07-01T13:58:18.620", "UserId": "8201204", "filtered-sentences": [{"source": "Text", "text": "If that server goes down due to any reason, using a Cloudformation template we want to bring that instance back from AMI and attach the EBS volumes from S3 bucket. ", "keywords": ["instance"]}, {"source": "Text", "text": "I am trying to understand how to attach the EBS volumes to the instance.", "keywords": ["instance"]}]}], "history": [{"Id": "150611049", "PostHistoryTypeId": "5", "PostId": "44856905", "RevisionGUID": "3e803492-5e2d-4b50-8f17-ea05a10f9626", "CreationDate": "2017-07-01T06:06:27.453", "UserId": "174777", "Comment": "Explained that it is CloudFormation", "Text": "Here is a working Amazon CloudFormation JSON template that creates an Amazon EC2 Windows 2016 instance.\r\n\r\nI want to attach an EBS volume that is backed-up on an S3 bucket. How can I do this? Any pointers please?\r\n\r\n      {\r\n    \"Parameters\" :{\r\n        \"KeyName\" : {\r\n            \"Description\" : \"Name of the existing EC2 KeyPair\",\r\n      \"Type\" : \"String\"\r\n        }\r\n     },\r\n     \"Mappings\" : {\r\n \"RegionMap\" : {\r\n    \"us-east-1\" : {\r\n  \"AMI\" : \"ami-48b4bf31\"\r\n    },\r\n    \"us-west-1\": {\r\n  \"AMI\" : \"ami-48b4bf31\"\r\n     },\r\n           \"us-west-2\":{\r\n                \"AMI\" : \"ami-48b4bf31\"\r\n           }  \r\n }\r\n     },\r\n     \"Resources\" :  {\r\n   \"Ec2Instance\" : {\r\n              \"Type\" : \"AWS::EC2::Instance\",\r\n       \"Properties\": {\r\n             \"KeyName\" : {\"Ref\" : \"KeyName\"},\r\n      \"ImageId\" : { \"Fn::FindInMap\" : [ \"RegionMap\", { \"Ref\" : \"AWS::Region\" }, \"AMI\" ]}\r\n\r\n              }   \r\n    }    \r\n      },\r\n      \"Outputs\" : {\r\n   \"AvailablityZone\" : {\r\n        \"Description\" : \"Availability Zone of the newly created EC2 instance\",\r\n        \"Value\" : { \"Fn::GetAtt\" : [ \"Ec2Instance\", \"AvailabilityZone\" ] }\r\n       },\r\n   \"PublicIp\" :{\r\n  \"Description\" : \"Public IP is\",\r\n  \"Value\": {\"Fn::GetAtt\": [\"Ec2Instance\", \"PublicIp\"] }\r\n\r\n     }\r\n \r\n } \r\n    }", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "Here is a working Amazon CloudFormation JSON template that creates an Amazon EC2 Windows 2016 instance. ", "keywords": ["instance"]}, {"source": "Text", "text": "Any pointers please? { \"Parameters\" :{ \"KeyName\" : { \"Description\" : \"Name of the existing EC2 KeyPair\", \"Type\" : \"String\" } }, \"Mappings\" : { \"RegionMap\" : { \"us-east-1\" : { \"AMI\" : \"ami-48b4bf31\" }, \"us-west-1\": { \"AMI\" : \"ami-48b4bf31\" }, \"us-west-2\":{ \"AMI\" : \"ami-48b4bf31\" } } }, \"Resources\" : { \"Ec2Instance\" : { \"Type\" : \"AWS::EC2::Instance\", \"Properties\": { \"KeyName\" : {\"Ref\" : \"KeyName\"}, \"ImageId\" : { \"Fn::FindInMap\" : [ \"RegionMap\", { \"Ref\" : \"AWS::Region\" }, \"AMI\" ]} } } }, \"Outputs\" : { \"AvailablityZone\" : { \"Description\" : \"Availability Zone of the newly created EC2 instance\", \"Value\" : { \"Fn::GetAtt\" : [ \"Ec2Instance\", \"AvailabilityZone\" ] } ", "keywords": ["instance"]}]}, {"Id": "150596435", "PostHistoryTypeId": "2", "PostId": "44856905", "RevisionGUID": "0cb68552-4a0b-473b-8319-c4cc80071a3c", "CreationDate": "2017-07-01T02:41:57.633", "UserId": "8201204", "Text": "Code below shows working JSON template to create an EC2 windows 2016 instance. I want to attach an EBS volume that is backedup on S3 bucket. How can I do this? any pointers please?\r\n\r\n      {\r\n    \"Parameters\" :{\r\n        \"KeyName\" : {\r\n            \"Description\" : \"Name of the existing EC2 KeyPair\",\r\n      \"Type\" : \"String\"\r\n        }\r\n     },\r\n     \"Mappings\" : {\r\n \"RegionMap\" : {\r\n    \"us-east-1\" : {\r\n  \"AMI\" : \"ami-48b4bf31\"\r\n    },\r\n    \"us-west-1\": {\r\n  \"AMI\" : \"ami-48b4bf31\"\r\n     },\r\n           \"us-west-2\":{\r\n                \"AMI\" : \"ami-48b4bf31\"\r\n           }  \r\n }\r\n     },\r\n     \"Resources\" :  {\r\n   \"Ec2Instance\" : {\r\n              \"Type\" : \"AWS::EC2::Instance\",\r\n       \"Properties\": {\r\n             \"KeyName\" : {\"Ref\" : \"KeyName\"},\r\n      \"ImageId\" : { \"Fn::FindInMap\" : [ \"RegionMap\", { \"Ref\" : \"AWS::Region\" }, \"AMI\" ]}\r\n\r\n              }   \r\n    }    \r\n      },\r\n      \"Outputs\" : {\r\n   \"AvailablityZone\" : {\r\n        \"Description\" : \"Availability Zone of the newly created EC2 instance\",\r\n        \"Value\" : { \"Fn::GetAtt\" : [ \"Ec2Instance\", \"AvailabilityZone\" ] }\r\n       },\r\n   \"PublicIp\" :{\r\n  \"Description\" : \"Public IP is\",\r\n  \"Value\": {\"Fn::GetAtt\": [\"Ec2Instance\", \"PublicIp\"] }\r\n\r\n     }\r\n \r\n } \r\n    }", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "Code below shows working JSON template to create an EC2 windows 2016 instance. ", "keywords": ["instance"]}, {"source": "Text", "text": "How can I do this? any pointers please? { \"Parameters\" :{ \"KeyName\" : { \"Description\" : \"Name of the existing EC2 KeyPair\", \"Type\" : \"String\" } }, \"Mappings\" : { \"RegionMap\" : { \"us-east-1\" : { \"AMI\" : \"ami-48b4bf31\" }, \"us-west-1\": { \"AMI\" : \"ami-48b4bf31\" }, \"us-west-2\":{ \"AMI\" : \"ami-48b4bf31\" } } }, \"Resources\" : { \"Ec2Instance\" : { \"Type\" : \"AWS::EC2::Instance\", \"Properties\": { \"KeyName\" : {\"Ref\" : \"KeyName\"}, \"ImageId\" : { \"Fn::FindInMap\" : [ \"RegionMap\", { \"Ref\" : \"AWS::Region\" ", "keywords": ["instance"]}, {"source": "Text", "text": "}, \"AMI\" ]} } } }, \"Outputs\" : { \"AvailablityZone\" : { \"Description\" : \"Availability Zone of the newly created EC2 instance\", \"Value\" : { \"Fn::GetAtt\" : [ \"Ec2Instance\", \"AvailabilityZone\" ] } ", "keywords": ["instance"]}]}, {"Id": "150596436", "PostHistoryTypeId": "1", "PostId": "44856905", "RevisionGUID": "0cb68552-4a0b-473b-8319-c4cc80071a3c", "CreationDate": "2017-07-01T02:41:57.633", "UserId": "8201204", "Text": "AWS cloudformation - how to attach EBS volume to EC2 windows instance", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "AWS cloudformation - how to attach EBS volume to EC2 windows instance", "keywords": ["instance"]}]}, {"Id": "150596437", "PostHistoryTypeId": "3", "PostId": "44856905", "RevisionGUID": "0cb68552-4a0b-473b-8319-c4cc80071a3c", "CreationDate": "2017-07-01T02:41:57.633", "UserId": "8201204", "Text": "|aws-cloudformation|cloudformation|", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "150646959", "PostHistoryTypeId": "6", "PostId": "44856905", "RevisionGUID": "7842c850-9551-4a52-9baa-cc55acb865f2", "CreationDate": "2017-07-02T01:09:44.770", "UserId": "174777", "Comment": "edited tags; edited tags", "Text": "|amazon-web-services|aws-cloudformation|amazon-ami|", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "answers": [{"Id": "51053078", "PostTypeId": "2", "ParentId": "44856905", "CreationDate": "2018-06-27T00:44:35.007", "Score": "0", "Body": "<p>There are probably two parts to this question:</p>\n\n<ul>\n<li>1) How do I specify details about the ebs volumes of my windows host in cloudformation</li>\n</ul>\n\n<p>I think you are looking for something like <a href=\"https://stackoverflow.com/questions/15391718/aws-cloudformation-awsec2instance-blockdevicemappings-and-volumes\">this</a> block device mappings (ephemeral disk or ebs) or Volumes (EBS only)</p>\n\n<pre><code> \"BlockDeviceMappings\" : [\n                 {\n                     \"DeviceName\" : \"/dev/sdc\",\n                     \"Ebs\" : { \"VolumeSize\" : \"50\" }\n                 },\n                 {\n                     \"DeviceName\" : \"/dev/sdd\",\n                     \"Ebs\" : { \"VolumeSize\" : \"100\" }\n                 }\n             ]\n</code></pre>\n\n<p>or volumes</p>\n\n<pre><code>\"Volumes\" : [\n{ \"VolumeId\" : \n      { \"Ref\" : \"NewVolume\" }, \"Device\" : \"/dev/sdk\" }\n</code></pre>\n\n<p>]</p>\n\n<p>and secondly</p>\n\n<ul>\n<li>2) How do I back up my windows host.</li>\n</ul>\n\n<p>The easiest way is probably with the aws cli snapshot command.</p>\n\n<pre><code>aws ec2 create-snapshot --volume-id vol-1234567890abcdef0 --description \"Backup of my windows server\"\n</code></pre>\n\n<p>Sometimes people drop that in cron on a linux box, wrap it with a little logic and loop it over the whole infrastructure. Nice, easy, cheap backups of AWS infrastructure. If you ever need to restore you can create a new image from snapshot.</p>\n", "OwnerUserId": "4736211", "LastActivityDate": "2018-06-27T00:44:35.007", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "176401118", "PostHistoryTypeId": "2", "PostId": "51053078", "RevisionGUID": "4293abe7-b185-4461-92ec-c1ccafda44dc", "CreationDate": "2018-06-27T00:44:35.007", "UserId": "4736211", "Text": "There are probably two parts to this question:\r\n\r\n - 1) How do I specify details about the ebs volumes of my windows host in cloudformation\r\n\r\nI think you are looking for something like [this][1] block device mappings (ephemeral disk or ebs) or Volumes (EBS only)\r\n\r\n     \"BlockDeviceMappings\" : [\r\n                     {\r\n                         \"DeviceName\" : \"/dev/sdc\",\r\n                         \"Ebs\" : { \"VolumeSize\" : \"50\" }\r\n                     },\r\n                     {\r\n                         \"DeviceName\" : \"/dev/sdd\",\r\n                         \"Ebs\" : { \"VolumeSize\" : \"100\" }\r\n                     }\r\n                 ]\r\n\r\nor volumes\r\n\r\n    \"Volumes\" : [\r\n    { \"VolumeId\" : \r\n          { \"Ref\" : \"NewVolume\" }, \"Device\" : \"/dev/sdk\" }\r\n ]\r\n\r\nand secondly\r\n\r\n - 2) How do I back up my windows host.\r\n\r\nThe easiest way is probably with the aws cli snapshot command.\r\n\r\n    aws ec2 create-snapshot --volume-id vol-1234567890abcdef0 --description \"Backup of my windows server\"\r\n\r\nSometimes people drop that in cron on a linux box, wrap it with a little logic and loop it over the whole infrastructure. Nice, easy, cheap backups of AWS infrastructure. If you ever need to restore you can create a new image from snapshot.\r\n\r\n\r\n  [1]: https://stackoverflow.com/questions/15391718/aws-cloudformation-awsec2instance-blockdevicemappings-and-volumes", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Nice, easy, cheap backups of AWS infrastructure. ", "keywords": ["cheap"]}]}], "filtered-sentences": [{"source": "Body", "text": "Nice, easy, cheap backups of AWS infrastructure. ", "keywords": ["cheap"]}]}, {"Id": "44866654", "PostTypeId": "2", "ParentId": "44856905", "CreationDate": "2017-07-02T01:09:23.433", "Score": "-1", "Body": "<p><strong>Backup:</strong> Your best strategy is to <strong>create an AMI on a regular basis</strong>. An AMI is a snapshot of the volumes attached to an Amazon EC2 instance -- yes, it can include <em>ALL</em> the disks attached to an instance. An AMI is actually just a collection of EBS snapshots, plus some metadata.</p>\n\n<p><strong>Restore:</strong> Launch a new Amazon EC2 instance from that AMI. It will contain all data, on all disks, that was present when the AMI was created. (It creates new EBS volumes, but they will contain the same data as when the AMI was created.)</p>\n\n<p>Each time you create a new AMI, it will receive a new AMI-ID. Therefore, I suggest that your CloudFormation template accepts the AMI-ID as a <strong>parameter</strong> that can be entered when the stack is created. You would simply paste in the AMI-ID of the latest AMI and the instance would use that AMI.</p>\n\n<p>Also, please note that AMIs are created in one region only. You can <strong>copy the AMI to a different region</strong>, but it will receive a different AMI-ID in the new region.</p>\n\n<p>Frankly, your CloudFormation templates appears to be merely launching the EC2 instance, which you could do just as easily in the console without using CloudFormation.</p>\n", "OwnerUserId": "174777", "LastActivityDate": "2017-07-02T01:09:23.433", "CommentCount": "2", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "76846469", "PostId": "44866654", "Score": "0", "Text": "Is there a service on AWS to create an AMI of EBS volumes? or creating AMI has to be done outside of AWS?", "CreationDate": "2017-07-05T20:11:55.933", "UserId": "8201204", "filtered-sentences": []}, {"Id": "76856023", "PostId": "44866654", "Score": "0", "Text": "You can *only* create an AMI within AWS. In the console, select your instance and choose Actions / Image / Create Image. Or, using the [AWS Command-Line Interface (CLI)](http://aws.amazon.com/cli/), use the `aws ec2 create-image` command. See: [Creating an Amazon EBS-Backed Linux AMI](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/creating-an-ami-ebs.html)", "CreationDate": "2017-07-06T04:52:11.603", "UserId": "174777", "filtered-sentences": [{"source": "Text", "text": "In the console, select your instance and choose Actions / Image / Create Image. ", "keywords": ["instance"]}]}], "history": [{"Id": "150646953", "PostHistoryTypeId": "2", "PostId": "44866654", "RevisionGUID": "dff7e0f4-1d09-4663-ad42-4efe50a79063", "CreationDate": "2017-07-02T01:09:23.433", "UserId": "174777", "Text": "**Backup:** Your best strategy is to **create an AMI on a regular basis**. An AMI is a snapshot of the volumes attached to an Amazon EC2 instance -- yes, it can include *ALL* the disks attached to an instance. An AMI is actually just a collection of EBS snapshots, plus some metadata.\r\n\r\n**Restore:** Launch a new Amazon EC2 instance from that AMI. It will contain all data, on all disks, that was present when the AMI was created. (It creates new EBS volumes, but they will contain the same data as when the AMI was created.)\r\n\r\nEach time you create a new AMI, it will receive a new AMI-ID. Therefore, I suggest that your CloudFormation template accepts the AMI-ID as a **parameter** that can be entered when the stack is created. You would simply paste in the AMI-ID of the latest AMI and the instance would use that AMI.\r\n\r\nAlso, please note that AMIs are created in one region only. You can **copy the AMI to a different region**, but it will receive a different AMI-ID in the new region.\r\n\r\nFrankly, your CloudFormation templates appears to be merely launching the EC2 instance, which you could do just as easily in the console without using CloudFormation.", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "An AMI is a snapshot of the volumes attached to an Amazon EC2 instance -- yes, it can include *ALL* the disks attached to an instance. ", "keywords": ["instance"]}, {"source": "Text", "text": "**Restore:** Launch a new Amazon EC2 instance from that AMI. ", "keywords": ["instance"]}, {"source": "Text", "text": "You would simply paste in the AMI-ID of the latest AMI and the instance would use that AMI. ", "keywords": ["instance"]}, {"source": "Text", "text": "Frankly, your CloudFormation templates appears to be merely launching the EC2 instance, which you could do just as easily in the console without using CloudFormation.", "keywords": ["instance"]}]}], "filtered-sentences": [{"source": "Body", "text": "An AMI is a snapshot of the volumes attached to an Amazon EC2 instance -- yes, it can include ALL the disks attached to an instance. ", "keywords": ["instance"]}, {"source": "Body", "text": "Restore: Launch a new Amazon EC2 instance from that AMI. ", "keywords": ["instance"]}, {"source": "Body", "text": "You would simply paste in the AMI-ID of the latest AMI and the instance would use that AMI. ", "keywords": ["instance"]}, {"source": "Body", "text": "Frankly, your CloudFormation templates appears to be merely launching the EC2 instance, which you could do just as easily in the console without using CloudFormation.", "keywords": ["instance"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "AWS cloudformation - how to attach EBS volume to EC2 windows instance", "keywords": ["instance"]}, {"source": "Body", "text": "Here is a working Amazon CloudFormation JSON template that creates an Amazon EC2 Windows 2016 instance. ", "keywords": ["instance"]}]}