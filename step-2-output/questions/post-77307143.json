{"Id": "77307143", "PostTypeId": "1", "CreationDate": "2023-10-17T08:02:00.573", "Score": "0", "ViewCount": "131", "Body": "<p>I've read that small objects (&lt; 128kb) are not included in Intelligent Tiering for S3. See <a href=\"https://awsmadeeasy.com/blog/aws-s3-intelligent-tiering/#:%7E:text=If%20there%20are%20multiple%20lifecycle%20policies%20AWS%20S3,the%20per-object%20monitoring%20would%20outweigh%20potential%20cost%20savings.\" rel=\"nofollow noreferrer\">link</a>. Can you overwrite that by transitioning small files yourself?</p>\n<p>More concretely, imagine a small file (1kb) in a bucket governed by below policy. The two rules both apply, so what will happen?</p>\n<p>A:</p>\n<ul>\n<li>0-1 days: nothing</li>\n<li>1-90 days: INTELLIGENT_TIERING, which will ignore them</li>\n<li>90+ days: GLACIER</li>\n</ul>\n<p>B:</p>\n<ul>\n<li>0-1 days: nothing</li>\n<li>90+ days: GLACIER</li>\n</ul>\n<p>C:</p>\n<ul>\n<li>0-1 days: nothing</li>\n<li>1+ days: INTELLIGENT_TIERING, which will ignore them.</li>\n</ul>\n<pre><code>\nResources:\n  AthenaResultsS3Bucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketName: some-bucket\n      ...\n      LifecycleConfiguration:\n        Rules:  \n          - Id: MoveSmallFilesToGlacier\n            Prefix: &quot;&quot;\n            Status: Enabled\n            ObjectSizeLessThan: 128 000  # Files this small don't get Intelligent Tiering\n            Transitions:\n              - TransitionInDays: 90\n                StorageClass: GLACIER\n          - Id: RemoveAllFiles\n            Prefix: &quot;&quot;\n            Status: Enabled\n            # ObjectSizeMoreThan: 128 000  # If this is uncommented, we're in scenario B\n            ExpirationInDays: 1000\n            Transitions:\n              - TransitionInDays: 1\n                StorageClass: INTELLIGENT_TIERING\n</code></pre>\n", "OwnerUserId": "7441757", "LastEditorUserId": "7441757", "LastEditDate": "2023-10-17T20:26:07.290", "LastActivityDate": "2023-10-17T20:36:18.677", "Title": "S3 intelligent tiering with small objects (cloudformation template)", "Tags": "|amazon-web-services|amazon-s3|aws-cloudformation|", "AnswerCount": "1", "CommentCount": "4", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "136288835", "PostId": "77307143", "Score": "0", "Text": "Your question is confusing; is your question regarding standard to intelligent tier, or standard to glacier?", "CreationDate": "2023-10-17T09:22:04.920", "UserId": "4800344", "filtered-sentences": []}, {"Id": "136290492", "PostId": "77307143", "Score": "0", "Text": "More clear like this?", "CreationDate": "2023-10-17T11:42:36.717", "UserId": "7441757", "filtered-sentences": []}, {"Id": "136291276", "PostId": "77307143", "Score": "0", "Text": "And is your problem understanding the above, or actually moving smaller than 128kb objects between storage tiers?", "CreationDate": "2023-10-17T12:48:37.120", "UserId": "4800344", "filtered-sentences": [{"source": "Text", "text": "And is your problem understanding the above, or actually moving smaller than 128kb objects between storage tiers?", "keywords": ["storage"]}]}, {"Id": "136296318", "PostId": "77307143", "Score": "0", "Text": "In the end, both :) Practically, I want to move small files to Glacier but I can add the ObjectSizeMoreThan for that. I just would like to understand what happens if both rules apply :)", "CreationDate": "2023-10-17T20:26:34.563", "UserId": "7441757", "filtered-sentences": []}], "history": [{"Id": "299085869", "PostHistoryTypeId": "2", "PostId": "77307143", "RevisionGUID": "c58f6141-8a37-4b6a-a83a-b855ffceca6b", "CreationDate": "2023-10-17T08:02:00.573", "UserId": "7441757", "Text": "I've read that small objects (< 128kb) are not included in Intelligent Tiering for S3 [link](https://awsmadeeasy.com/blog/aws-s3-intelligent-tiering/#:~:text=If%20there%20are%20multiple%20lifecycle%20policies%20AWS%20S3,the%20per-object%20monitoring%20would%20outweigh%20potential%20cost%20savings.). Can you overwrite that by transitioning small files yourself? \r\n\r\nMy questions are:\r\n- Is `ObjectSizeLessThan` inclusive or exclusive?\r\n- In the template below, where I've introduced a double rule for all small files, would they indeed be put in GLACIER after 90 days?\r\n\r\n```\r\n\r\nResources:\r\n  AthenaResultsS3Bucket:\r\n    Type: AWS::S3::Bucket\r\n    Properties:\r\n      BucketName: some-bucket\r\n      ...\r\n      LifecycleConfiguration:\r\n        Rules:  \r\n          - Id: MoveSmallFilesToGlacier\r\n            Prefix: \"\"\r\n            Status: Enabled\r\n            ObjectSizeLessThan: 128 000  # Files this small don't get Intelligent Tiering\r\n            Transitions:\r\n              - TransitionInDays: 90\r\n                StorageClass: GLACIER\r\n          - Id: RemoveAllFiles\r\n            Prefix: \"\"\r\n            Status: Enabled\r\n            ObjectSizeMoreThan: 128 000\r\n            ExpirationInDays: 1000\r\n            Transitions:\r\n              - TransitionInDays: 1\r\n                StorageClass: INTELLIGENT_TIERING\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "299085871", "PostHistoryTypeId": "1", "PostId": "77307143", "RevisionGUID": "c58f6141-8a37-4b6a-a83a-b855ffceca6b", "CreationDate": "2023-10-17T08:02:00.573", "UserId": "7441757", "Text": "S3 intelligent tiering with small objects (cloudformation template)", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "299085872", "PostHistoryTypeId": "3", "PostId": "77307143", "RevisionGUID": "c58f6141-8a37-4b6a-a83a-b855ffceca6b", "CreationDate": "2023-10-17T08:02:00.573", "UserId": "7441757", "Text": "|amazon-web-services|amazon-s3|aws-cloudformation|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "299094527", "PostHistoryTypeId": "5", "PostId": "77307143", "RevisionGUID": "3056b00f-5b08-46d5-bc46-33b864f0f080", "CreationDate": "2023-10-17T11:38:41.273", "UserId": "7441757", "Comment": "added 5 characters in body", "Text": "I've read that small objects (< 128kb) are not included in Intelligent Tiering for S3. See [link](https://awsmadeeasy.com/blog/aws-s3-intelligent-tiering/#:~:text=If%20there%20are%20multiple%20lifecycle%20policies%20AWS%20S3,the%20per-object%20monitoring%20would%20outweigh%20potential%20cost%20savings.). Can you overwrite that by transitioning small files yourself? \r\n\r\nMore concretely, imagine a small file (1kb) in a bucket governed by below policy. The two rules both apply, so what will happen?\r\n\r\nA:\r\n- 0-1 days: nothing\r\n- 1-90 days: INTELLIGENT_TIERING, which will ignore them\r\n- 90+ days: GLACIER\r\n\r\nB:\r\n- 0-1 days: nothing\r\n- 90+ days: GLACIER\r\n\r\nC:\r\n- 0-1 days: nothing\r\n- 1+ days: INTELLIGENT_TIERING, which will ignore them.\r\n\r\n```\r\n\r\nResources:\r\n  AthenaResultsS3Bucket:\r\n    Type: AWS::S3::Bucket\r\n    Properties:\r\n      BucketName: some-bucket\r\n      ...\r\n      LifecycleConfiguration:\r\n        Rules:  \r\n          - Id: MoveSmallFilesToGlacier\r\n            Prefix: \"\"\r\n            Status: Enabled\r\n            ObjectSizeLessThan: 128 000  # Files this small don't get Intelligent Tiering\r\n            Transitions:\r\n              - TransitionInDays: 90\r\n                StorageClass: GLACIER\r\n          - Id: RemoveAllFiles\r\n            Prefix: \"\"\r\n            Status: Enabled\r\n            ObjectSizeMoreThan: 128 000\r\n            ExpirationInDays: 1000\r\n            Transitions:\r\n              - TransitionInDays: 1\r\n                StorageClass: INTELLIGENT_TIERING\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "More concretely, imagine a small file (1kb) in a bucket governed by below policy. ", "keywords": ["policy"]}]}, {"Id": "299113697", "PostHistoryTypeId": "5", "PostId": "77307143", "RevisionGUID": "4f8eb620-6ac8-41bb-afa4-26d7de9d2015", "CreationDate": "2023-10-17T20:26:07.290", "UserId": "7441757", "Comment": "added 2 characters in body", "Text": "I've read that small objects (< 128kb) are not included in Intelligent Tiering for S3. See [link](https://awsmadeeasy.com/blog/aws-s3-intelligent-tiering/#:~:text=If%20there%20are%20multiple%20lifecycle%20policies%20AWS%20S3,the%20per-object%20monitoring%20would%20outweigh%20potential%20cost%20savings.). Can you overwrite that by transitioning small files yourself? \r\n\r\nMore concretely, imagine a small file (1kb) in a bucket governed by below policy. The two rules both apply, so what will happen?\r\n\r\nA:\r\n- 0-1 days: nothing\r\n- 1-90 days: INTELLIGENT_TIERING, which will ignore them\r\n- 90+ days: GLACIER\r\n\r\nB:\r\n- 0-1 days: nothing\r\n- 90+ days: GLACIER\r\n\r\nC:\r\n- 0-1 days: nothing\r\n- 1+ days: INTELLIGENT_TIERING, which will ignore them.\r\n\r\n```\r\n\r\nResources:\r\n  AthenaResultsS3Bucket:\r\n    Type: AWS::S3::Bucket\r\n    Properties:\r\n      BucketName: some-bucket\r\n      ...\r\n      LifecycleConfiguration:\r\n        Rules:  \r\n          - Id: MoveSmallFilesToGlacier\r\n            Prefix: \"\"\r\n            Status: Enabled\r\n            ObjectSizeLessThan: 128 000  # Files this small don't get Intelligent Tiering\r\n            Transitions:\r\n              - TransitionInDays: 90\r\n                StorageClass: GLACIER\r\n          - Id: RemoveAllFiles\r\n            Prefix: \"\"\r\n            Status: Enabled\r\n            # ObjectSizeMoreThan: 128 000  # If this is uncommented, we're in scenario B\r\n            ExpirationInDays: 1000\r\n            Transitions:\r\n              - TransitionInDays: 1\r\n                StorageClass: INTELLIGENT_TIERING\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "More concretely, imagine a small file (1kb) in a bucket governed by below policy. ", "keywords": ["policy"]}]}], "answers": [{"Id": "77312123", "PostTypeId": "2", "ParentId": "77307143", "CreationDate": "2023-10-17T20:36:18.677", "Score": "0", "Body": "<p>Yes you can (haven't tested it though personally) <a href=\"https://aws.amazon.com/s3/pricing/\" rel=\"nofollow noreferrer\">the pricing page</a> has the information.\nFor IA:</p>\n<blockquote>\n<p>S3 Standard-IA and S3 One Zone-IA storage have a minimum billable object size of 128 KB. Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate.</p>\n</blockquote>\n<p>For Glacier:</p>\n<blockquote>\n<p>S3 Glacier Instant Retrieval has a minimum billable object size of 128 KB. Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate.\n(...)\nFor each object that is stored in S3 Glacier Flexible Retrieval or S3 Glacier Deep Archive, Amazon S3 adds 40 KB of chargeable overhead for metadata, with 8 KB charged at S3 Standard rates and 32 KB charged at S3 Glacier Flexible Retrieval or S3 Deep Archive rates.</p>\n</blockquote>\n<p>So the general answer is: You can but it will be more expensive.</p>\n", "OwnerUserId": "2115135", "LastActivityDate": "2023-10-17T20:36:18.677", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "299113984", "PostHistoryTypeId": "2", "PostId": "77312123", "RevisionGUID": "490abea8-c3eb-4518-932b-ffe058e2f53a", "CreationDate": "2023-10-17T20:36:18.677", "UserId": "2115135", "Text": "Yes you can (haven't tested it though personally) [the pricing page][1] has the information.\r\nFor IA:\r\n\r\n>  S3 Standard-IA and S3 One Zone-IA storage have a minimum billable object size of 128 KB. Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate.\r\n\r\nFor Glacier:\r\n>  S3 Glacier Instant Retrieval has a minimum billable object size of 128 KB. Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate.\r\n(...)\r\nFor each object that is stored in S3 Glacier Flexible Retrieval or S3 Glacier Deep Archive, Amazon S3 adds 40 KB of chargeable overhead for metadata, with 8 KB charged at S3 Standard rates and 32 KB charged at S3 Glacier Flexible Retrieval or S3 Deep Archive rates.\r\n\r\nSo the general answer is: You can but it will be more expensive.\r\n \r\n\r\n  [1]: https://aws.amazon.com/s3/pricing/", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Yes you can (haven't tested it though personally) [the pricing page][1] has the information. ", "keywords": ["test"]}, {"source": "Text", "text": "For IA: > S3 Standard-IA and S3 One Zone-IA storage have a minimum billable object size of 128 KB. ", "keywords": ["bill", "storage"]}, {"source": "Text", "text": "Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate. ", "keywords": ["storage"]}, {"source": "Text", "text": "For Glacier: > S3 Glacier Instant Retrieval has a minimum billable object size of 128 KB. ", "keywords": ["bill"]}, {"source": "Text", "text": "Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate. ", "keywords": ["storage"]}, {"source": "Text", "text": "So the general answer is: You can but it will be more expensive. ", "keywords": ["expense"]}]}], "filtered-sentences": [{"source": "Body", "text": "Yes you can (haven't tested it though personally) the pricing page has the information. ", "keywords": ["test"]}, {"source": "Body", "text": "For IA: S3 Standard-IA and S3 One Zone-IA storage have a minimum billable object size of 128 KB. ", "keywords": ["bill", "storage"]}, {"source": "Body", "text": "Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate. ", "keywords": ["storage"]}, {"source": "Body", "text": "For Glacier: S3 Glacier Instant Retrieval has a minimum billable object size of 128 KB. ", "keywords": ["bill"]}, {"source": "Body", "text": "Smaller objects may be stored but will be charged for 128 KB of storage at the appropriate storage class rate. ", "keywords": ["storage"]}, {"source": "Body", "text": "So the general answer is: You can but it will be more expensive.", "keywords": ["expense"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "More concretely, imagine a small file (1kb) in a bucket governed by below policy. ", "keywords": ["policy"]}]}