{"Id": "25680599", "PostTypeId": "1", "CreationDate": "2014-09-05T07:24:07.287", "Score": "1", "ViewCount": "3061", "Body": "<p>I am currently fighting with AWS CloudFormation because I want to tag a bucket with its own name (in order to separate its costs in my Cost Allocation report). </p>\n\n<p>When I do </p>\n\n<pre><code>\"MyBucket\" : {\n        \"Type\" : \"AWS::S3::Bucket\",\n            \"Properties\" : {\n                \"AccessControl\" : \"Private\",\n                \"Tags\" : [\n                    { \"Key\" : \"Name\", \"Value\" : { \"Ref\" : \"MyBucket\" } }\n                ]\n        }\n    },  \n</code></pre>\n\n<p>the CloudFormation wizard throws the following error: </p>\n\n<pre><code>Error\nTemplate validation error: Circular dependency between resources: [MyBucket]\n</code></pre>\n\n<p>The real problem is that I want to keep the generated name (such as my-bucket-15jsi17g9cby0) as not specify a custom name through the \"BucketName\" property. </p>\n\n<p>Does anybody have an idea ? </p>\n", "OwnerUserId": "2611083", "LastActivityDate": "2019-02-11T23:34:54.690", "Title": "Amazon Web Services - Tag a S3 bucket with its own name within a CloudFormation", "Tags": "|amazon-web-services|amazon-s3|aws-cloudformation|", "AnswerCount": "2", "CommentCount": "3", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "41429263", "PostId": "25680599", "Score": "0", "Text": "What is the reason you do not want to use BucketName?", "CreationDate": "2014-10-15T16:44:40.460", "UserId": "1700477", "filtered-sentences": []}, {"Id": "41430951", "PostId": "25680599", "Score": "0", "Text": "I plan to use the cloudFormation for large deployments (1 CFN per client) and I do not want to generate the BucketName by myself to be sure that the bucket does not already exists.", "CreationDate": "2014-10-15T17:39:26.577", "UserId": "2611083", "filtered-sentences": []}, {"Id": "96073454", "PostId": "25680599", "Score": "0", "Text": "You can use a lambda-backed custom resource to do this. What is the reason you need the bucket to be tagged with the name?", "CreationDate": "2019-02-11T23:43:31.910", "UserId": "1142167", "filtered-sentences": []}], "history": [{"Id": "72887859", "PostHistoryTypeId": "2", "PostId": "25680599", "RevisionGUID": "2a988d61-23ed-4d12-9f88-24339b4b8885", "CreationDate": "2014-09-05T07:24:07.287", "UserId": "2611083", "Text": "I am currently fighting with AWS CloudFormation because I want to tag a bucket with its own name (in order to separate its costs in my Cost Allocation report). \r\n\r\nWhen I do \r\n\r\n    \"MyBucket\" : {\r\n            \"Type\" : \"AWS::S3::Bucket\",\r\n                \"Properties\" : {\r\n                    \"AccessControl\" : \"Private\",\r\n                    \"Tags\" : [\r\n                        { \"Key\" : \"Name\", \"Value\" : { \"Ref\" : \"MyBucket\" } }\r\n                    ]\r\n            }\r\n        },  \r\n\r\nthe CloudFormation wizard throws the following error: \r\n\r\n    Error\r\n    Template validation error: Circular dependency between resources: [MyBucket]\r\n\r\nThe real problem is that I want to keep the generated name (such as my-bucket-15jsi17g9cby0) as not specify a custom name through the \"BucketName\" property. \r\n\r\nDoes anybody have an idea ? \r\n", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "I am currently fighting with AWS CloudFormation because I want to tag a bucket with its own name (in order to separate its costs in my Cost Allocation report). ", "keywords": ["cost"]}]}, {"Id": "72887860", "PostHistoryTypeId": "1", "PostId": "25680599", "RevisionGUID": "2a988d61-23ed-4d12-9f88-24339b4b8885", "CreationDate": "2014-09-05T07:24:07.287", "UserId": "2611083", "Text": "Amazon Web Services - Tag a S3 bucket with its own name within a CloudFormation", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "72887861", "PostHistoryTypeId": "3", "PostId": "25680599", "RevisionGUID": "2a988d61-23ed-4d12-9f88-24339b4b8885", "CreationDate": "2014-09-05T07:24:07.287", "UserId": "2611083", "Text": "|amazon-web-services|amazon-s3|aws-cloudformation|", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "answers": [{"Id": "26389824", "PostTypeId": "2", "ParentId": "25680599", "CreationDate": "2014-10-15T18:43:32.853", "Score": "1", "Body": "<p>You could use the CloudFormation <a href=\"http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/pseudo-parameter-reference.html\" rel=\"nofollow\">pseudo parameters</a> to generate a unique name for the BucketName and the Name tag value.  This is similar to what the template generates automatically.  This also guarantees a unique name since the stack name combined with the region must be unique to CloudFormation.  If you're only using a single region, you could drop the region reference.</p>\n\n<pre><code>\"MyBucket\" : {\n  \"Type\" : \"AWS::S3::Bucket\",\n  \"Properties\" : {\n    \"BucketName\" : { \"Fn::Join\" : [ \"-\", [{ \"Ref\" : \"AWS::StackName\" }, \"s3\", { \"Ref\" : \"AWS::Region\" }]]},\n    \"AccessControl\" : \"Private\",\n    \"Tags\" : [\n      { \"Key\" : \"Name\", \"Value\" : { \"Fn::Join\" : [ \"-\", [{ \"Ref\" : \"AWS::StackName\" }, \"s3\", { \"Ref\" : \"AWS::Region\" }]]}}\n    ]\n  }\n}\n</code></pre>\n", "OwnerUserId": "1700477", "LastActivityDate": "2014-10-15T18:43:32.853", "CommentCount": "1", "ContentLicense": "CC BY-SA 3.0", "comments": [{"Id": "41655012", "PostId": "26389824", "Score": "0", "Text": "Are you sure that the CFN will allow capital letters in the BucketName parameter ? And how can I check that the length will not exceed the limitation ?", "CreationDate": "2014-10-22T16:33:07.663", "UserId": "2611083", "filtered-sentences": []}], "history": [{"Id": "75604803", "PostHistoryTypeId": "2", "PostId": "26389824", "RevisionGUID": "cf7643de-82fb-4c1d-a858-3cdc3e2cd8ef", "CreationDate": "2014-10-15T18:43:32.853", "UserId": "1700477", "Text": "You could use the CloudFormation [pseudo parameters][1] to generate a unique name for the BucketName and the Name tag value.  This is similar to what the template generates automatically.  This also guarantees a unique name since the stack name combined with the region must be unique to CloudFormation.  If you're only using a single region, you could drop the region reference.\r\n\r\n    \"MyBucket\" : {\r\n      \"Type\" : \"AWS::S3::Bucket\",\r\n      \"Properties\" : {\r\n        \"BucketName\" : { \"Fn::Join\" : [ \"-\", [{ \"Ref\" : \"AWS::StackName\" }, \"s3\", { \"Ref\" : \"AWS::Region\" }]]},\r\n        \"AccessControl\" : \"Private\",\r\n        \"Tags\" : [\r\n          { \"Key\" : \"Name\", \"Value\" : { \"Fn::Join\" : [ \"-\", [{ \"Ref\" : \"AWS::StackName\" }, \"s3\", { \"Ref\" : \"AWS::Region\" }]]}}\r\n        ]\r\n      }\r\n    }\r\n\r\n  [1]: http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/pseudo-parameter-reference.html", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "54640711", "PostTypeId": "2", "ParentId": "25680599", "CreationDate": "2019-02-11T23:34:54.690", "Score": "0", "Body": "<p>You can use stack id parameter and join it to form a unique id. E.g. </p>\n\n<pre><code>{\n  \"AWSTemplateFormatVersion\": \"2010-09-09\",\n  \"Resources\": {\n    \"MyBucket\": {\n      \"Type\": \"AWS::S3::Bucket\",\n      \"Properties\": {\n        \"BucketName\": {\n            \"Fn::Join\": [\n            \"-\",\n            [\n              \"my-bucket-name\",\n              {\n                \"Fn::Select\": [\n                  \"2\",\n                  {\n                    \"Fn::Split\": [\n                      \"/\",\n                      { \"Ref\": \"AWS::StackId\" }\n                    ]\n                  }\n                ]\n              }\n            ]\n          ]\n        },\n        \"AccessControl\": \"Private\"\n      }\n    }\n  }\n}\n</code></pre>\n", "OwnerUserId": "215336", "LastActivityDate": "2019-02-11T23:34:54.690", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "191433727", "PostHistoryTypeId": "2", "PostId": "54640711", "RevisionGUID": "67d2ae23-a776-43fe-8c0d-d44c289f9a46", "CreationDate": "2019-02-11T23:34:54.690", "UserId": "215336", "Text": "You can use stack id parameter and join it to form a unique id. E.g. \r\n\r\n\r\n    {\r\n      \"AWSTemplateFormatVersion\": \"2010-09-09\",\r\n      \"Resources\": {\r\n        \"MyBucket\": {\r\n          \"Type\": \"AWS::S3::Bucket\",\r\n          \"Properties\": {\r\n            \"BucketName\": {\r\n                \"Fn::Join\": [\r\n                \"-\",\r\n                [\r\n                  \"my-bucket-name\",\r\n                  {\r\n                    \"Fn::Select\": [\r\n                      \"2\",\r\n                      {\r\n                        \"Fn::Split\": [\r\n                          \"/\",\r\n                          { \"Ref\": \"AWS::StackId\" }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              ]\r\n            },\r\n            \"AccessControl\": \"Private\"\r\n          }\r\n        }\r\n      }\r\n    }", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "I am currently fighting with AWS CloudFormation because I want to tag a bucket with its own name (in order to separate its costs in my Cost Allocation report). ", "keywords": ["cost"]}]}