{"Id": "52218302", "PostTypeId": "1", "AcceptedAnswerId": "52218679", "CreationDate": "2018-09-07T08:19:19.153", "Score": "2", "ViewCount": "542", "Body": "<p>Trying to create an ECS Service using the following Cloudformation resource definition:</p>\n\n<pre><code>  MyUIService:\n    Type: AWS::ECS::Service\n    Properties:\n      Cluster: !ImportValue MyClusterName\n      DesiredCount: 1\n      LaunchType: EC2\n      LoadBalancers:\n        - !ImportValue ALBDemo\n      Role: !Ref MyServiceRole\n      ServiceName: my-ui-service\n      ServiceRegistries:\n       - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\n      TaskDefinition: !ImportValue MyTaskArn\n</code></pre>\n\n<p>However it fails with the following error:</p>\n\n<blockquote>\n  <p>Value of property LoadBalancers must be a list of objects</p>\n</blockquote>\n\n<p>But <strong>I am</strong> defining a list (albeit with one element).</p>\n\n<p>The list contains an export of the ALB's arn.</p>\n\n<p>What is the exact syntax?</p>\n\n<p><strong>edit</strong>: Here is the relevant <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html\" rel=\"nofollow noreferrer\">documentation</a> that does not seem consistent with the error:</p>\n\n<blockquote>\n  <p><em>LoadBalancers</em></p>\n  \n  <p>A list of load balancer objects to associate with the cluster. If you specify the Role property, LoadBalancers must be specified as\n  well. For information about the number of load balancers that you can\n  specify per service, see Service Load Balancing in the Amazon Elastic\n  Container Service Developer Guide.\n      Required: Conditional\n      Type: List of Amazon Elastic Container Service Service LoadBalancers</p>\n</blockquote>\n", "OwnerUserId": "2409793", "LastEditorUserId": "2409793", "LastEditDate": "2018-09-07T09:09:33.413", "LastActivityDate": "2018-09-07T09:09:33.413", "Title": "AWS ECS: LoadBalancers property error in ECSService CloudFormation resource definition", "Tags": "|amazon-web-services|aws-cloudformation|amazon-ecs|aws-ecs|", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "181300672", "PostHistoryTypeId": "4", "PostId": "52218302", "RevisionGUID": "4f9bee09-fe8f-4e14-9c33-f3acb0fdeb19", "CreationDate": "2018-09-07T09:03:30.963", "UserId": "2409793", "Comment": "edited title", "Text": "AWS ECS: LoadBalancers property error in ECSService CloudFormation resource definition", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "181301110", "PostHistoryTypeId": "5", "PostId": "52218302", "RevisionGUID": "0bc58a39-5ddd-47a2-a760-cf0aee0e15f4", "CreationDate": "2018-09-07T09:09:33.413", "UserId": "2409793", "Comment": "added 2 characters in body", "Text": "Trying to create an ECS Service using the following Cloudformation resource definition:\r\n\r\n\r\n      MyUIService:\r\n        Type: AWS::ECS::Service\r\n        Properties:\r\n          Cluster: !ImportValue MyClusterName\r\n          DesiredCount: 1\r\n          LaunchType: EC2\r\n          LoadBalancers:\r\n            - !ImportValue ALBDemo\r\n          Role: !Ref MyServiceRole\r\n          ServiceName: my-ui-service\r\n          ServiceRegistries:\r\n           - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\r\n          TaskDefinition: !ImportValue MyTaskArn\r\n\r\nHowever it fails with the following error:\r\n\r\n> Value of property LoadBalancers must be a list of objects\r\n\r\nBut __I am__ defining a list (albeit with one element).\r\n\r\nThe list contains an export of the ALB's arn.\r\n\r\nWhat is the exact syntax?\r\n\r\n__edit__: Here is the relevant [documentation][1] that does not seem consistent with the error:\r\n\r\n> *LoadBalancers*\r\n> \r\n>   A list of load balancer objects to associate with the cluster. If you specify the Role property, LoadBalancers must be specified as\r\n> well. For information about the number of load balancers that you can\r\n> specify per service, see Service Load Balancing in the Amazon Elastic\r\n> Container Service Developer Guide.\r\n>     Required: Conditional\r\n>     Type: List of Amazon Elastic Container Service Service LoadBalancers\r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Trying to create an ECS Service using the following Cloudformation resource definition: MyUIService: Type: AWS::ECS::Service Properties: Cluster: !ImportValue MyClusterName DesiredCount: 1 LaunchType: EC2 LoadBalancers: - !ImportValue ALBDemo Role: !Ref MyServiceRole ServiceName: my-ui-service ServiceRegistries: - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7 TaskDefinition: !ImportValue MyTaskArn ", "keywords": ["cluster"]}, {"source": "Text", "text": "What is the exact syntax? __edit__: Here is the relevant [documentation][1] that does not seem consistent with the error: > *LoadBalancers* > > A list of load balancer objects to associate with the cluster. ", "keywords": ["cluster"]}]}, {"Id": "181297562", "PostHistoryTypeId": "2", "PostId": "52218302", "RevisionGUID": "88fb0f3c-9c07-4c82-a124-db5488e93edf", "CreationDate": "2018-09-07T08:19:19.153", "UserId": "2409793", "Text": "Trying to create an ECS Service using the following Cloudformation resource definition:\r\n\r\n\r\n      MyUIService:\r\n        Type: AWS::ECS::Service\r\n        Properties:\r\n          Cluster: !ImportValue MyClusterName\r\n          DesiredCount: 1\r\n          LaunchType: EC2\r\n          LoadBalancers:\r\n            - !ImportValue ALBDemo\r\n          Role: !Ref MyServiceRole\r\n          ServiceName: my-ui-service\r\n          ServiceRegistries:\r\n           - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\r\n          TaskDefinition: !ImportValue MyTaskArn\r\n\r\nHowever it fails with the following error:\r\n\r\n> Value of property LoadBalancers must be a list of objects\r\n\r\nBut __I am__ defining a list (even with one element).\r\n\r\nThe list contains an export of the ALB's arn.\r\n\r\nWhat is the exact syntax?\r\n\r\n__edit__: Here is the relevant [documentation][1] that does not seem consistent with the error:\r\n\r\n> *LoadBalancers*\r\n> \r\n>     A list of load balancer objects to associate with the cluster. If you specify the Role property, LoadBalancers must be specified as\r\n> well. For information about the number of load balancers that you can\r\n> specify per service, see Service Load Balancing in the Amazon Elastic\r\n> Container Service Developer Guide.\r\n>     Required: Conditional\r\n>     Type: List of Amazon Elastic Container Service Service LoadBalancers\r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Trying to create an ECS Service using the following Cloudformation resource definition: MyUIService: Type: AWS::ECS::Service Properties: Cluster: !ImportValue MyClusterName DesiredCount: 1 LaunchType: EC2 LoadBalancers: - !ImportValue ALBDemo Role: !Ref MyServiceRole ServiceName: my-ui-service ServiceRegistries: - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7 TaskDefinition: !ImportValue MyTaskArn ", "keywords": ["cluster"]}, {"source": "Text", "text": "What is the exact syntax? __edit__: Here is the relevant [documentation][1] that does not seem consistent with the error: > *LoadBalancers* > > A list of load balancer objects to associate with the cluster. ", "keywords": ["cluster"]}]}, {"Id": "181297563", "PostHistoryTypeId": "1", "PostId": "52218302", "RevisionGUID": "88fb0f3c-9c07-4c82-a124-db5488e93edf", "CreationDate": "2018-09-07T08:19:19.153", "UserId": "2409793", "Text": "AWS ECS: Error when creating ECS service via CloudFormation", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "181297564", "PostHistoryTypeId": "3", "PostId": "52218302", "RevisionGUID": "88fb0f3c-9c07-4c82-a124-db5488e93edf", "CreationDate": "2018-09-07T08:19:19.153", "UserId": "2409793", "Text": "|amazon-web-services|aws-cloudformation|amazon-ecs|aws-ecs|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "181297896", "PostHistoryTypeId": "5", "PostId": "52218302", "RevisionGUID": "cabaa1ef-3366-4ae7-96f3-933c0c308b18", "CreationDate": "2018-09-07T08:24:41.390", "UserId": "2409793", "Comment": "deleted 2 characters in body", "Text": "Trying to create an ECS Service using the following Cloudformation resource definition:\r\n\r\n\r\n      MyUIService:\r\n        Type: AWS::ECS::Service\r\n        Properties:\r\n          Cluster: !ImportValue MyClusterName\r\n          DesiredCount: 1\r\n          LaunchType: EC2\r\n          LoadBalancers:\r\n            - !ImportValue ALBDemo\r\n          Role: !Ref MyServiceRole\r\n          ServiceName: my-ui-service\r\n          ServiceRegistries:\r\n           - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\r\n          TaskDefinition: !ImportValue MyTaskArn\r\n\r\nHowever it fails with the following error:\r\n\r\n> Value of property LoadBalancers must be a list of objects\r\n\r\nBut __I am__ defining a list (even with one element).\r\n\r\nThe list contains an export of the ALB's arn.\r\n\r\nWhat is the exact syntax?\r\n\r\n__edit__: Here is the relevant [documentation][1] that does not seem consistent with the error:\r\n\r\n> *LoadBalancers*\r\n> \r\n>   A list of load balancer objects to associate with the cluster. If you specify the Role property, LoadBalancers must be specified as\r\n> well. For information about the number of load balancers that you can\r\n> specify per service, see Service Load Balancing in the Amazon Elastic\r\n> Container Service Developer Guide.\r\n>     Required: Conditional\r\n>     Type: List of Amazon Elastic Container Service Service LoadBalancers\r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-service.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Trying to create an ECS Service using the following Cloudformation resource definition: MyUIService: Type: AWS::ECS::Service Properties: Cluster: !ImportValue MyClusterName DesiredCount: 1 LaunchType: EC2 LoadBalancers: - !ImportValue ALBDemo Role: !Ref MyServiceRole ServiceName: my-ui-service ServiceRegistries: - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7 TaskDefinition: !ImportValue MyTaskArn ", "keywords": ["cluster"]}, {"source": "Text", "text": "What is the exact syntax? __edit__: Here is the relevant [documentation][1] that does not seem consistent with the error: > *LoadBalancers* > > A list of load balancer objects to associate with the cluster. ", "keywords": ["cluster"]}]}], "answers": [{"Id": "52218679", "PostTypeId": "2", "ParentId": "52218302", "CreationDate": "2018-09-07T08:40:59.710", "Score": "3", "Body": "<p>I see that you copied the same template from <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ecs.html\" rel=\"nofollow noreferrer\">AWS templates</a>.</p>\n\n<pre><code>MyUIService:\n  Type: AWS::ECS::Service\n  Properties:\n    Cluster: !ImportValue MyClusterName\n    DesiredCount: 1\n    LaunchType: EC2\n    LoadBalancers:\n      - ContainerName: simple-app\n        ContainerPort: '80'\n        TargetGroupArn: !Ref 'ECSTG'\n    Role: !Ref MyServiceRole\n    ServiceName: my-ui-service\n    ServiceRegistries:\n     - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\n    TaskDefinition: !ImportValue MyTaskArn\n</code></pre>\n\n<p>Note that LoadBalancers does not really directly reference the load balancer. It references the target group. This is quite weird given the naming but if you go through the web console you will reach the same conclusion.</p>\n\n<p>If you look at <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-loadbalancers.html\" rel=\"nofollow noreferrer\">AWS documentation</a>:</p>\n\n<pre><code>ContainerName\nThe name of a container to use with the load balancer.\n\nRequired: Yes\n\nType: String\n\n\nContainerPort\nThe port number on the container to direct load balancer traffic to. Your container instances must allow ingress traffic on this port.\n\nRequired: Yes\n\nType: Integer\n</code></pre>\n\n<p>These are <strong>Required</strong> but you can never get them by importing a load balancer.</p>\n\n<p>If you think about it, by referencing a target group instead of a load balancer, you can share the same ALB for multiple target groups which is good for cost. So in conclusion it makes sense to reference the target group but the property name is misleading indeed.</p>\n", "OwnerUserId": "7323888", "LastEditorUserId": "7323888", "LastEditDate": "2018-09-07T08:54:47.807", "LastActivityDate": "2018-09-07T08:54:47.807", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "91385896", "PostId": "52218679", "Score": "1", "Text": "So the `LoadBalancer` property actually refers to the __triplet__: `ContainerName`, `ContainerPort`, `TargetGroupArn` ? weird and misleading approach by Amazon ...", "CreationDate": "2018-09-07T08:45:48.910", "UserId": "2409793", "filtered-sentences": []}], "history": [{"Id": "181299030", "PostHistoryTypeId": "2", "PostId": "52218679", "RevisionGUID": "117e965b-c3f8-475b-b48e-8282be70eef6", "CreationDate": "2018-09-07T08:40:59.710", "UserId": "7323888", "Text": "I see that you copied the same template from [AWS templates][1].\r\n\r\n    MyUIService:\r\n      Type: AWS::ECS::Service\r\n      Properties:\r\n        Cluster: !ImportValue MyClusterName\r\n        DesiredCount: 1\r\n        LaunchType: EC2\r\n        LoadBalancers:\r\n          - ContainerName: simple-app\r\n            ContainerPort: '80'\r\n            TargetGroupArn: !Ref 'ECSTG'\r\n        Role: !Ref MyServiceRole\r\n        ServiceName: my-ui-service\r\n        ServiceRegistries:\r\n         - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\r\n        TaskDefinition: !ImportValue MyTaskArn\r\n\r\n\r\n\r\nNote that LoadBalancers does not really directly reference the load balancer. It references the target group. This is quite weird given the naming but if you go through the web console you will reach the same conclusion.\r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ecs.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I see that you copied the same template from [AWS templates][1]. MyUIService: Type: AWS::ECS::Service Properties: Cluster: !ImportValue MyClusterName DesiredCount: 1 LaunchType: EC2 LoadBalancers: - ContainerName: simple-app ContainerPort: '80' TargetGroupArn: !Ref 'ECSTG' Role: !Ref MyServiceRole ServiceName: my-ui-service ServiceRegistries: - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7 TaskDefinition: !ImportValue MyTaskArn Note that LoadBalancers does not really directly reference the load balancer. ", "keywords": ["cluster"]}]}, {"Id": "181299628", "PostHistoryTypeId": "5", "PostId": "52218679", "RevisionGUID": "0e4eee89-ac0a-417d-b061-429c41fd0021", "CreationDate": "2018-09-07T08:49:29.253", "UserId": "7323888", "Comment": "added 585 characters in body", "Text": "I see that you copied the same template from [AWS templates][1].\r\n\r\n    MyUIService:\r\n      Type: AWS::ECS::Service\r\n      Properties:\r\n        Cluster: !ImportValue MyClusterName\r\n        DesiredCount: 1\r\n        LaunchType: EC2\r\n        LoadBalancers:\r\n          - ContainerName: simple-app\r\n            ContainerPort: '80'\r\n            TargetGroupArn: !Ref 'ECSTG'\r\n        Role: !Ref MyServiceRole\r\n        ServiceName: my-ui-service\r\n        ServiceRegistries:\r\n         - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\r\n        TaskDefinition: !ImportValue MyTaskArn\r\n\r\n\r\n\r\nNote that LoadBalancers does not really directly reference the load balancer. It references the target group. This is quite weird given the naming but if you go through the web console you will reach the same conclusion.\r\n\r\nIf you look at [AWS documentation][2]:\r\n\r\n    ContainerName\r\n    The name of a container to use with the load balancer.\r\n    \r\n    Required: Yes\r\n    \r\n    Type: String\r\n    \r\n\r\n    ContainerPort\r\n    The port number on the container to direct load balancer traffic to. Your container instances must allow ingress traffic on this port.\r\n    \r\n    Required: Yes\r\n    \r\n    Type: Integer\r\n\r\nThese are **Required** but you can never get them by importing a load balancer.\r\n\r\n  [1]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ecs.html\r\n  [2]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-loadbalancers.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I see that you copied the same template from [AWS templates][1]. MyUIService: Type: AWS::ECS::Service Properties: Cluster: !ImportValue MyClusterName DesiredCount: 1 LaunchType: EC2 LoadBalancers: - ContainerName: simple-app ContainerPort: '80' TargetGroupArn: !Ref 'ECSTG' Role: !Ref MyServiceRole ServiceName: my-ui-service ServiceRegistries: - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7 TaskDefinition: !ImportValue MyTaskArn Note that LoadBalancers does not really directly reference the load balancer. ", "keywords": ["cluster"]}]}, {"Id": "181299968", "PostHistoryTypeId": "5", "PostId": "52218679", "RevisionGUID": "e6dc9fd2-175d-4cd6-99b9-f5e6c5275137", "CreationDate": "2018-09-07T08:54:47.807", "UserId": "7323888", "Comment": "added 585 characters in body", "Text": "I see that you copied the same template from [AWS templates][1].\r\n\r\n    MyUIService:\r\n      Type: AWS::ECS::Service\r\n      Properties:\r\n        Cluster: !ImportValue MyClusterName\r\n        DesiredCount: 1\r\n        LaunchType: EC2\r\n        LoadBalancers:\r\n          - ContainerName: simple-app\r\n            ContainerPort: '80'\r\n            TargetGroupArn: !Ref 'ECSTG'\r\n        Role: !Ref MyServiceRole\r\n        ServiceName: my-ui-service\r\n        ServiceRegistries:\r\n         - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7\r\n        TaskDefinition: !ImportValue MyTaskArn\r\n\r\n\r\n\r\nNote that LoadBalancers does not really directly reference the load balancer. It references the target group. This is quite weird given the naming but if you go through the web console you will reach the same conclusion.\r\n\r\nIf you look at [AWS documentation][2]:\r\n\r\n    ContainerName\r\n    The name of a container to use with the load balancer.\r\n    \r\n    Required: Yes\r\n    \r\n    Type: String\r\n    \r\n\r\n    ContainerPort\r\n    The port number on the container to direct load balancer traffic to. Your container instances must allow ingress traffic on this port.\r\n    \r\n    Required: Yes\r\n    \r\n    Type: Integer\r\n\r\nThese are **Required** but you can never get them by importing a load balancer.\r\n\r\nIf you think about it, by referencing a target group instead of a load balancer, you can share the same ALB for multiple target groups which is good for cost. So in conclusion it makes sense to reference the target group but the property name is misleading indeed.\r\n\r\n  [1]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-ecs.html\r\n  [2]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-loadbalancers.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I see that you copied the same template from [AWS templates][1]. MyUIService: Type: AWS::ECS::Service Properties: Cluster: !ImportValue MyClusterName DesiredCount: 1 LaunchType: EC2 LoadBalancers: - ContainerName: simple-app ContainerPort: '80' TargetGroupArn: !Ref 'ECSTG' Role: !Ref MyServiceRole ServiceName: my-ui-service ServiceRegistries: - arn:aws:servicediscovery:eu-west-1:2398942890842:service/srv-ohc098mdj55yesez7 TaskDefinition: !ImportValue MyTaskArn Note that LoadBalancers does not really directly reference the load balancer. ", "keywords": ["cluster"]}, {"source": "Text", "text": "If you think about it, by referencing a target group instead of a load balancer, you can share the same ALB for multiple target groups which is good for cost. ", "keywords": ["cost"]}]}], "filtered-sentences": [{"source": "Body", "text": "If you think about it, by referencing a target group instead of a load balancer, you can share the same ALB for multiple target groups which is good for cost. ", "keywords": ["cost"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "A list of load balancer objects to associate with the cluster. ", "keywords": ["cluster"]}]}