{"Id": "42837692", "PostTypeId": "1", "CreationDate": "2017-03-16T15:00:48.697", "Score": "3", "ViewCount": "1985", "Body": "<p>I have large cloudformation json file which I used to create new vpc, subnets, ec2 instance.\nBasically looking into breaking file into multiple small file for easy maintenance.</p>\n\n<p>How do I create\na) create_vpc.json and vpc_param.json file. \nb) how do I get list of vpc from aws cli and   pass vpc name/id to create_subnet.json and define subnet_param.json.\nc) get list of subnet for a vpc using aws cli and pass that as arguments to create_routetable.json and routetable_param.json</p>\n\n<p>Similarly want to create other scripts for ec2/elb/other stuffs. </p>\n\n<pre><code>aws cloudformation create-stack --stackname startmyinstance  --template-body file:///some/local/path/templates/startmyinstance.json --parameters file:///some/local/path/params/startmyinstance-parameters.json\n</code></pre>\n\n<p>my current file is :</p>\n\n<pre><code> {\n   \"AWSTemplateFormatVersion\": \"2010-09-09\",\n   \"Description\": \" Tempalte to launch Custom VPC with two availablilty zones. **WARNING** This template might create one or more Amazon EC2 instances. You will be billed for the AWS resources used if you create a stack from this template.\",\n   \"Parameters\": {\n      \"KeyName\": {\n         \"Description\": \"Name of an existing EC2 KeyPair to enable SSH access to the instances\",\n         \"Type\": \"String\",\n         \"MinLength\": \"1\",\n         \"MaxLength\": \"64\",\n         \"AllowedPattern\": \"[-_ a-zA-Z0-9]*\",\n         \"Default\": \"Helix-PROD\",\n         \"ConstraintDescription\": \"can contain only alphanumeric characters, spaces, dashes and underscores.\"\n      },\n      \"VpcCidr\": {\n         \"Description\": \"CIDR address for the VPC to be created.\",\n         \"Type\": \"String\",\n         \"Default\": \"10.206.36.0/22\"\n      },\n      \"SUB1\": {\n         \"Description\": \"subnet1.\",\n         \"Type\": \"String\",\n         \"Default\": \"10.206.36.0/27\"\n      },\n      \"SUB2\": {\n         \"Description\": \"subnet2\",\n         \"Type\": \"String\",\n         \"Default\": \"10.206.36.32/27\"\n      },\n\n      \"AvailabilityZone1\": {\n         \"Description\": \"First AZ to use for Public1/private1 subnets.\",\n         \"Type\": \"AWS::EC2::AvailabilityZone::Name\",\n         \"Default\": \"eu-west-1a\"\n      },\n      \"AvailabilityZone2\": {\n         \"Description\": \"First AZ to use for Public2/private2 subnets.\",\n         \"Type\": \"AWS::EC2::AvailabilityZone::Name\",\n         \"Default\": \"eu-west-1b\"\n      },\n   },\n   \"Mappings\": {\n      \"RegionMap\": {\n\n         \"eu-west-1\": {\n            \"64\": \"ami-70edb016\"\n         }\n      }\n\n   },\n\n   \"Resources\": {\n      \"VPC\": {\n         \"Type\": \"AWS::EC2::VPC\",\n         \"Properties\": {\n            \"CidrBlock\": {\n               \"Ref\": \"VpcCidr\"\n            },\n            \"Tags\": [{\n               \"Key\": \"Network\",\n               \"Value\": \"Public\"\n            }]\n         }\n      },\n      \"Sub1\": {\n         \"Type\": \"AWS::EC2::Subnet\",\n         \"Properties\": {\n            \"VpcId\": {\n               \"Ref\": \"VPC\"\n            },\n            \"AvailabilityZone\": {\n               \"Ref\": \"AvailabilityZone1\"\n            },\n            \"CidrBlock\": {\n               \"Ref\": \"subnet1\"\n            },\n            \"Tags\": [{\n               \"Key\": \"Network\",\n               \"Value\": \"Private\"\n            }, {\n               \"Key\": \"Name\",\n               \"Value\": \"Sub1\"\n            }]\n         }\n      },\n      \"Sub2\": {\n         \"Type\": \"AWS::EC2::Subnet\",\n         \"Properties\": {\n            \"VpcId\": {\n               \"Ref\": \"VPC\"\n            },\n            \"AvailabilityZone\": {\n               \"Ref\": \"AvailabilityZone2\"\n            },\n            \"CidrBlock\": {\n               \"Ref\": \"subnet2\"\n            },\n            \"Tags\": [{\n               \"Key\": \"Network\",\n               \"Value\": \"Private\"\n            }, {\n               \"Key\": \"Name\",\n               \"Value\": \"Sub2\"\n            }]\n         }\n      },\n   }\n}\n</code></pre>\n", "OwnerUserId": "1186780", "LastActivityDate": "2019-01-10T07:09:35.363", "Title": "Break cloudformation file into smaller scripts", "Tags": "|amazon-web-services|aws-cloudformation|aws-cli|", "AnswerCount": "2", "CommentCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "140794269", "PostHistoryTypeId": "2", "PostId": "42837692", "RevisionGUID": "ec79d336-7d66-44d4-a7d3-a1a315fd9e9f", "CreationDate": "2017-03-16T15:00:48.697", "UserId": "1186780", "Text": "I have large cloudformation json file which I used to create new vpc, subnets, ec2 instance.\r\nBasically looking into breaking file into multiple small file for easy maintenance.\r\n\r\n\r\nHow do I create\r\na) create_vpc.json and vpc_param.json file. \r\nb) how do I get list of vpc from aws cli and   pass vpc name/id to create_subnet.json and define subnet_param.json.\r\nc) get list of subnet for a vpc using aws cli and pass that as arguments to create_routetable.json and routetable_param.json\r\n\r\nSimilarly want to create other scripts for ec2/elb/other stuffs. \r\n\r\n    aws cloudformation create-stack --stackname startmyinstance  --template-body file:///some/local/path/templates/startmyinstance.json --parameters file:///some/local/path/params/startmyinstance-parameters.json\r\n\r\nmy current file is :\r\n   \r\n\r\n     {\r\n       \"AWSTemplateFormatVersion\": \"2010-09-09\",\r\n       \"Description\": \" Tempalte to launch Custom VPC with two availablilty zones. **WARNING** This template might create one or more Amazon EC2 instances. You will be billed for the AWS resources used if you create a stack from this template.\",\r\n       \"Parameters\": {\r\n          \"KeyName\": {\r\n             \"Description\": \"Name of an existing EC2 KeyPair to enable SSH access to the instances\",\r\n             \"Type\": \"String\",\r\n             \"MinLength\": \"1\",\r\n             \"MaxLength\": \"64\",\r\n             \"AllowedPattern\": \"[-_ a-zA-Z0-9]*\",\r\n             \"Default\": \"Helix-PROD\",\r\n             \"ConstraintDescription\": \"can contain only alphanumeric characters, spaces, dashes and underscores.\"\r\n          },\r\n          \"VpcCidr\": {\r\n             \"Description\": \"CIDR address for the VPC to be created.\",\r\n             \"Type\": \"String\",\r\n             \"Default\": \"10.206.36.0/22\"\r\n          },\r\n          \"SUB1\": {\r\n             \"Description\": \"subnet1.\",\r\n             \"Type\": \"String\",\r\n             \"Default\": \"10.206.36.0/27\"\r\n          },\r\n          \"SUB2\": {\r\n             \"Description\": \"subnet2\",\r\n             \"Type\": \"String\",\r\n             \"Default\": \"10.206.36.32/27\"\r\n          },\r\n          \r\n          \"AvailabilityZone1\": {\r\n             \"Description\": \"First AZ to use for Public1/private1 subnets.\",\r\n             \"Type\": \"AWS::EC2::AvailabilityZone::Name\",\r\n             \"Default\": \"eu-west-1a\"\r\n          },\r\n          \"AvailabilityZone2\": {\r\n             \"Description\": \"First AZ to use for Public2/private2 subnets.\",\r\n             \"Type\": \"AWS::EC2::AvailabilityZone::Name\",\r\n             \"Default\": \"eu-west-1b\"\r\n          },\r\n       },\r\n       \"Mappings\": {\r\n          \"RegionMap\": {\r\n    \r\n             \"eu-west-1\": {\r\n                \"64\": \"ami-70edb016\"\r\n             }\r\n          }\r\n    \r\n       },\r\n    \r\n       \"Resources\": {\r\n          \"VPC\": {\r\n             \"Type\": \"AWS::EC2::VPC\",\r\n             \"Properties\": {\r\n                \"CidrBlock\": {\r\n                   \"Ref\": \"VpcCidr\"\r\n                },\r\n                \"Tags\": [{\r\n                   \"Key\": \"Network\",\r\n                   \"Value\": \"Public\"\r\n                }]\r\n             }\r\n          },\r\n          \"Sub1\": {\r\n             \"Type\": \"AWS::EC2::Subnet\",\r\n             \"Properties\": {\r\n                \"VpcId\": {\r\n                   \"Ref\": \"VPC\"\r\n                },\r\n                \"AvailabilityZone\": {\r\n                   \"Ref\": \"AvailabilityZone1\"\r\n                },\r\n                \"CidrBlock\": {\r\n                   \"Ref\": \"subnet1\"\r\n                },\r\n                \"Tags\": [{\r\n                   \"Key\": \"Network\",\r\n                   \"Value\": \"Private\"\r\n                }, {\r\n                   \"Key\": \"Name\",\r\n                   \"Value\": \"Sub1\"\r\n                }]\r\n             }\r\n          },\r\n          \"Sub2\": {\r\n             \"Type\": \"AWS::EC2::Subnet\",\r\n             \"Properties\": {\r\n                \"VpcId\": {\r\n                   \"Ref\": \"VPC\"\r\n                },\r\n                \"AvailabilityZone\": {\r\n                   \"Ref\": \"AvailabilityZone2\"\r\n                },\r\n                \"CidrBlock\": {\r\n                   \"Ref\": \"subnet2\"\r\n                },\r\n                \"Tags\": [{\r\n                   \"Key\": \"Network\",\r\n                   \"Value\": \"Private\"\r\n                }, {\r\n                   \"Key\": \"Name\",\r\n                   \"Value\": \"Sub2\"\r\n                }]\r\n             }\r\n          },\r\n       }\r\n    }\r\n\r\n", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "I have large cloudformation json file which I used to create new vpc, subnets, ec2 instance. ", "keywords": ["instance"]}, {"source": "Text", "text": "You will be billed for the AWS resources used if you create a stack from this template.\", \"Parameters\": { \"KeyName\": { \"Description\": \"Name of an existing EC2 KeyPair to enable SSH access to the instances\", \"Type\": \"String\", \"MinLength\": \"1\", \"MaxLength\": \"64\", \"AllowedPattern\": \"[-_ a-zA-Z0-9]*\", \"Default\": \"Helix-PROD\", \"ConstraintDescription\": \"can contain only alphanumeric characters, spaces, dashes and underscores.\" }, \"VpcCidr\": { \"Description\": \"CIDR address for the VPC to be created.\", \"Type\": \"String\", \"Default\": \"10.206.36.0/22\" }, \"SUB1\": { \"Description\": \"subnet1.\", \"Type\": \"String\", \"Default\": \"10.206.36.0/27\" ", "keywords": ["bill"]}]}, {"Id": "140794270", "PostHistoryTypeId": "1", "PostId": "42837692", "RevisionGUID": "ec79d336-7d66-44d4-a7d3-a1a315fd9e9f", "CreationDate": "2017-03-16T15:00:48.697", "UserId": "1186780", "Text": "Break cloudformation file into smaller scripts", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "140794271", "PostHistoryTypeId": "3", "PostId": "42837692", "RevisionGUID": "ec79d336-7d66-44d4-a7d3-a1a315fd9e9f", "CreationDate": "2017-03-16T15:00:48.697", "UserId": "1186780", "Text": "|amazon-web-services|aws-cloudformation|aws-cli|", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}], "answers": [{"Id": "42897044", "PostTypeId": "2", "ParentId": "42837692", "CreationDate": "2017-03-20T06:22:44.917", "Score": "2", "Body": "<p>You could make use of <a href=\"https://aws.amazon.com/blogs/devops/use-nested-stacks-to-create-reusable-templates-and-support-role-specialization/\" rel=\"nofollow noreferrer\">Nested Stacks</a> - (This link explains what they are or when to use). If you want to see sample templates or snippets visit <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-cloudformation.html\" rel=\"nofollow noreferrer\">this</a> AWS page to see sample templates.</p>\n", "OwnerUserId": "1505583", "LastEditorUserId": "139150", "LastEditDate": "2019-01-10T07:09:35.363", "LastActivityDate": "2019-01-10T07:09:35.363", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "141030597", "PostHistoryTypeId": "2", "PostId": "42897044", "RevisionGUID": "b2014154-87c8-436c-a30c-0888fddc9175", "CreationDate": "2017-03-20T06:22:44.917", "UserId": "1505583", "Text": "You could make use of [Nested Stacks][1] - (This link explains what they are or when to use). If you want to see sample templates or snippets visit [this][2] AWS page to see sample templates.\r\n\r\n\r\n  [1]: http://%20https://aws.amazon.com/blogs/devops/use-nested-stacks-to-create-reusable-templates-and-support-role-specialization/\r\n  [2]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-cloudformation.html", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "189275074", "PostHistoryTypeId": "5", "PostId": "42897044", "RevisionGUID": "419241e2-214d-4000-9354-2ce105e4570b", "CreationDate": "2019-01-10T07:09:35.363", "UserId": "139150", "Comment": "Updated url", "Text": "You could make use of [Nested Stacks][1] - (This link explains what they are or when to use). If you want to see sample templates or snippets visit [this][2] AWS page to see sample templates.\r\n\r\n\r\n  [1]: https://aws.amazon.com/blogs/devops/use-nested-stacks-to-create-reusable-templates-and-support-role-specialization/\r\n\r\n  [2]: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-cloudformation.html", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}, {"Id": "54056013", "PostTypeId": "2", "ParentId": "42837692", "CreationDate": "2019-01-05T20:34:02.490", "Score": "1", "Body": "<p>You can use <a href=\"https://www.npmjs.com/package/cfpack.js\" rel=\"nofollow noreferrer\">cfpack.js</a> for this. It allows you to use multiple smaller templates that will be built into one bigger template and deployed to your CloudFormation stack.</p>\n", "OwnerUserId": "531994", "LastActivityDate": "2019-01-05T20:34:02.490", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "188998129", "PostHistoryTypeId": "2", "PostId": "54056013", "RevisionGUID": "722a4e9e-4ed8-466f-83f6-bc8256a3c2b2", "CreationDate": "2019-01-05T20:34:02.490", "UserId": "531994", "Text": "You can use [cfpack.js][1] for this. It allows you to use multiple smaller templates that will be built into one bigger template and deployed to your CloudFormation stack.\r\n\r\n\r\n  [1]: https://www.npmjs.com/package/cfpack.js", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "I have large cloudformation json file which I used to create new vpc, subnets, ec2 instance. ", "keywords": ["instance"]}]}