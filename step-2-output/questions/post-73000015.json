{"Id": "73000015", "PostTypeId": "1", "CreationDate": "2022-07-15T22:05:52.940", "Score": "0", "ViewCount": "49", "Body": "<p>I have the below config to read data from S3 written there by Kinesis Firehose:</p>\n<pre><code>S3AthenaStore:\n  Type: AWS::S3::Bucket\n  Properties:\n    BucketName:  ${self:custom.s3AthenaStore}\n\nAnalysisGlueDatabase:\n  Type: AWS::Glue::Database\n  Properties:\n    CatalogId: !Ref AWS::AccountId\n    DatabaseInput:\n      Name:  !Join \n        - ''\n        - - '${self:custom.glueName}-'\n          - 'db'\n      Description: &quot;Analysis aws Glue database&quot;\n  DependsOn:\n    - S3AthenaStore\n\nAnalyticsGlueRole:\n  Type: AWS::IAM::Role\n  DependsOn:\n    - S3AnalyticsStore\n  Properties:\n    AssumeRolePolicyDocument:\n      Version: &quot;2012-10-17&quot;\n      Statement:\n        -\n          Effect: &quot;Allow&quot;\n          Principal:\n            Service:\n              - &quot;glue.amazonaws.com&quot;\n          Action:\n            - &quot;sts:AssumeRole&quot;\n    Path: &quot;/&quot;\n    ManagedPolicyArns:\n      ['arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole']\n    Policies:\n      -\n        PolicyName: &quot;S3BucketAccessPolicy&quot;\n        PolicyDocument:\n          Version: &quot;2012-10-17&quot;\n          Statement:\n            -\n              Effect: &quot;Allow&quot;\n              Action: \n                - &quot;s3:GetObject&quot;\n                - &quot;s3:PutObject&quot;\n              Resource: \n                - !Join\n                  - ''\n                  - - !GetAtt S3AnalyticsStore.Arn\n                    - &quot;*&quot;\n\nAnalyticsGlueCrawler:\n  Type: AWS::Glue::Crawler\n  Properties:\n    Name: &quot;AnalysisCrawler&quot;\n    Role: !GetAtt AnalyticsGlueRole.Arn\n    DatabaseName: !Ref AnalysisGlueDatabase\n    Targets:\n      S3Targets:\n        - Path: !Ref S3AnalyticsStore\n    SchemaChangePolicy:\n      UpdateBehavior: &quot;LOG&quot;\n      DeleteBehavior: &quot;LOG&quot;\n    Schedule:\n      ScheduleExpression: &quot;cron(00 0/1 * * ? *)&quot;\n    RecrawlPolicy: \n      RecrawlBehavior: CRAWL_NEW_FOLDERS_ONLY\n  DependsOn:\n    - AnalyticsGlueRole\n    - AnalysisGlueDatabase\n\nAnalyticsAthenaWorkGroup:\n  Type: AWS::Athena::WorkGroup\n  Properties: \n    Name: ${self:service}-${self:provider.stage}-wg\n    WorkGroupConfiguration: \n      ResultConfiguration:\n        OutputLocation: \n          !Join\n            - ''\n            - - 's3://'\n              - !Ref S3AthenaStore\n  DependsOn:\n    - S3AthenaStore\n</code></pre>\n<p>The data is the folders with the following pattern: <code>${bucket}/${year}/${month}/${date}/${hour}/event-collection-stream-staging-deliver-1-2022-07-14-23-51-22-cdb2f06a-e825-47d0-a781-efd4195ab88d.gz</code> and it looks like:</p>\n<pre><code>{&quot;anonymous_id&quot;:&quot;123&quot;,&quot;url&quot;:&quot;-&quot;,&quot;event_type&quot;:&quot;pageView&quot;,&quot;timestamp&quot;:&quot;2022-07-12T03:29:47.186Z&quot;,&quot;source_ip&quot;:&quot;69.113.177.222&quot;,&quot;user_agent&quot;:&quot;curl/7.54.0&quot;} {&quot;anonymous_id&quot;:&quot;123&quot;,&quot;url&quot;:&quot;-&quot;,&quot;event_type&quot;:&quot;pageView&quot;,&quot;timestamp&quot;:&quot;2022-07-12T03:29:50.726Z&quot;,&quot;source_ip&quot;:&quot;69.113.177.222&quot;,&quot;user_agent&quot;:&quot;curl/7.54.0&quot;} {&quot;anonymous_id&quot;:&quot;123&quot;,&quot;url&quot;:&quot;-&quot;,&quot;event_type&quot;:&quot;pageView&quot;,&quot;timestamp&quot;:&quot;2022-07-12T03:29:53.628Z&quot;,&quot;source_ip&quot;:&quot;69.113.177.222&quot;,&quot;user_agent&quot;:&quot;curl/7.54.0&quot;}\n</code></pre>\n<p>My question is - how come my data is automatically partitioned in Athena? When I run: <code>select * from page_view_store_staging</code>, it returns: my columns, plus columns for four (4) partitions 0-3 with column <code>partition_0</code> having a value of <code>2022</code> etc.</p>\n<p>I did not specify this in my config, did I?</p>\n", "OwnerUserId": "5800846", "LastEditorUserId": "6296561", "LastEditDate": "2022-08-05T21:07:04.220", "LastActivityDate": "2022-08-05T21:07:04.220", "Title": "Athena partitions data based on the location/date", "Tags": "|amazon-web-services|aws-cloudformation|aws-glue|amazon-athena|", "AnswerCount": "0", "CommentCount": "6", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "128933360", "PostId": "73000015", "Score": "0", "Text": "it could be kinesis firehose doing the partitioning for you", "CreationDate": "2022-07-15T22:17:03.217", "UserId": "223478", "filtered-sentences": []}, {"Id": "128933631", "PostId": "73000015", "Score": "1", "Text": "Its your crawler.  By default crawler tries to partition data.", "CreationDate": "2022-07-15T22:42:31.530", "UserId": "248823", "filtered-sentences": []}, {"Id": "128934263", "PostId": "73000015", "Score": "0", "Text": "thank you @Marcin should i leave the data partitioned, as it is now?", "CreationDate": "2022-07-16T00:03:13.327", "UserId": "5800846", "filtered-sentences": []}, {"Id": "128934341", "PostId": "73000015", "Score": "1", "Text": "Its good practice to partition data. Can speed up queries a lot.", "CreationDate": "2022-07-16T00:15:32.290", "UserId": "248823", "filtered-sentences": []}, {"Id": "128937177", "PostId": "73000015", "Score": "0", "Text": "Partition allows you to speed up queries and reduce number of processed files(which leads to reducing the cost) if filtering applied based on partition columns.", "CreationDate": "2022-07-16T07:47:39.610", "UserId": "2501279", "filtered-sentences": [{"source": "Text", "text": "Partition allows you to speed up queries and reduce number of processed files(which leads to reducing the cost) if filtering applied based on partition columns.", "keywords": ["cost"]}]}, {"Id": "128948018", "PostId": "73000015", "Score": "0", "Text": "If I am not utilizing those partitions for my queries, won't it just make the data set larger? I imagine that whenever a query would need to take into account time, it would utilize the timestamp value. understand how in general partitioning might be useful, but is it useful here, if we don't have use for those values?", "CreationDate": "2022-07-17T03:02:07.230", "UserId": "5800846", "filtered-sentences": []}], "history": [{"Id": "274304719", "PostHistoryTypeId": "5", "PostId": "73000015", "RevisionGUID": "d66f8ddc-466d-4b7c-b8e8-e47ec2145cf6", "CreationDate": "2022-07-16T00:01:39.797", "UserId": "16790137", "Comment": "Improved readability ", "Text": "I have the below config to read data from `S3` written there by Kinesis Firehose:\r\n\r\n    S3AthenaStore:\r\n      Type: AWS::S3::Bucket\r\n      Properties:\r\n        BucketName:  ${self:custom.s3AthenaStore}\r\n\r\n    AnalysisGlueDatabase:\r\n      Type: AWS::Glue::Database\r\n      Properties:\r\n        CatalogId: !Ref AWS::AccountId\r\n        DatabaseInput:\r\n          Name:  !Join \r\n            - ''\r\n            - - '${self:custom.glueName}-'\r\n              - 'db'\r\n          Description: \"Analysis aws Glue database\"\r\n      DependsOn:\r\n        - S3AthenaStore\r\n\r\n    AnalyticsGlueRole:\r\n      Type: AWS::IAM::Role\r\n      DependsOn:\r\n        - S3AnalyticsStore\r\n      Properties:\r\n        AssumeRolePolicyDocument:\r\n          Version: \"2012-10-17\"\r\n          Statement:\r\n            -\r\n              Effect: \"Allow\"\r\n              Principal:\r\n                Service:\r\n                  - \"glue.amazonaws.com\"\r\n              Action:\r\n                - \"sts:AssumeRole\"\r\n        Path: \"/\"\r\n        ManagedPolicyArns:\r\n          ['arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole']\r\n        Policies:\r\n          -\r\n            PolicyName: \"S3BucketAccessPolicy\"\r\n            PolicyDocument:\r\n              Version: \"2012-10-17\"\r\n              Statement:\r\n                -\r\n                  Effect: \"Allow\"\r\n                  Action: \r\n                    - \"s3:GetObject\"\r\n                    - \"s3:PutObject\"\r\n                  Resource: \r\n                    - !Join\r\n                      - ''\r\n                      - - !GetAtt S3AnalyticsStore.Arn\r\n                        - \"*\"\r\n  \r\n    AnalyticsGlueCrawler:\r\n      Type: AWS::Glue::Crawler\r\n      Properties:\r\n        Name: \"AnalysisCrawler\"\r\n        Role: !GetAtt AnalyticsGlueRole.Arn\r\n        DatabaseName: !Ref AnalysisGlueDatabase\r\n        Targets:\r\n          S3Targets:\r\n            - Path: !Ref S3AnalyticsStore\r\n        SchemaChangePolicy:\r\n          UpdateBehavior: \"LOG\"\r\n          DeleteBehavior: \"LOG\"\r\n        Schedule:\r\n          ScheduleExpression: \"cron(00 0/1 * * ? *)\"\r\n        RecrawlPolicy: \r\n          RecrawlBehavior: CRAWL_NEW_FOLDERS_ONLY\r\n      DependsOn:\r\n        - AnalyticsGlueRole\r\n        - AnalysisGlueDatabase\r\n\r\n    AnalyticsAthenaWorkGroup:\r\n      Type: AWS::Athena::WorkGroup\r\n      Properties: \r\n        Name: ${self:service}-${self:provider.stage}-wg\r\n        WorkGroupConfiguration: \r\n          ResultConfiguration:\r\n            OutputLocation: \r\n              !Join\r\n                - ''\r\n                - - 's3://'\r\n                  - !Ref S3AthenaStore\r\n      DependsOn:\r\n        - S3AthenaStore\r\n\r\nThe data is the folders with the following pattern: `${bucket}/${year}/${month}/${date}/${hour}/event-collection-stream-staging-deliver-1-2022-07-14-23-51-22-cdb2f06a-e825-47d0-a781-efd4195ab88d.gz` and it looks like:\r\n\r\n    {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:47.186Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:50.726Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:53.628Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"}\r\n\r\nMy question is - **how come my data is automatically partitioned in Athena?** When I run: `select * from page_view_store_staging`, it returns: my columns, plus columns for four (4) partitions 0-3 with column `partition_0` having a value of `2022` etc.\r\n\r\nI did not specify this in my config, did I?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have the below config to read data from `S3` written there by Kinesis Firehose: S3AthenaStore: Type: AWS::S3::Bucket Properties: BucketName: ${self:custom.s3AthenaStore} AnalysisGlueDatabase: Type: AWS::Glue::Database Properties: CatalogId: !Ref AWS::AccountId DatabaseInput: Name: !Join - '' - - '${self:custom.glueName}-' - 'db' Description: \"Analysis aws Glue database\" DependsOn: - S3AthenaStore AnalyticsGlueRole: Type: AWS::IAM::Role DependsOn: - S3AnalyticsStore Properties: AssumeRolePolicyDocument: Version: \"2012-10-17\" Statement: - Effect: \"Allow\" Principal: Service: - \"glue.amazonaws.com\" Action: - \"sts:AssumeRole\" Path: \"/\" ManagedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole'] Policies: - PolicyName: \"S3BucketAccessPolicy\" PolicyDocument: Version: \"2012-10-17\" Statement: - Effect: \"Allow\" Action: - \"s3:GetObject\" - \"s3:PutObject\" Resource: - !Join - '' - - !GetAtt S3AnalyticsStore.Arn - \"*\" AnalyticsGlueCrawler: Type: AWS::Glue::Crawler Properties: Name: \"AnalysisCrawler\" Role: !GetAtt AnalyticsGlueRole.Arn DatabaseName: !Ref AnalysisGlueDatabase Targets: S3Targets: - Path: !Ref S3AnalyticsStore SchemaChangePolicy: UpdateBehavior: \"LOG\" DeleteBehavior: \"LOG\" Schedule: ScheduleExpression: \"cron(00 0/1 * * ? *)\" RecrawlPolicy: RecrawlBehavior: CRAWL_NEW_FOLDERS_ONLY DependsOn: - AnalyticsGlueRole - AnalysisGlueDatabase AnalyticsAthenaWorkGroup: Type: AWS::Athena::WorkGroup Properties: Name: ${self:service}-${self:provider.stage}-wg WorkGroupConfiguration: ResultConfiguration: OutputLocation: !Join - '' - - 's3://' - !Ref S3AthenaStore DependsOn: - S3AthenaStore The data is the folders with the following pattern: `${bucket}/${year}/${month}/${date}/${hour}/event-collection-stream-staging-deliver-1-2022-07-14-23-51-22-cdb2f06a-e825-47d0-a781-efd4195ab88d.gz` and it looks like: {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:47.186Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:50.726Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:53.628Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} My question is - **how come my data is automatically partitioned in Athena?** When I run: `select * from page_view_store_staging`, it returns: my columns, plus columns for four (4) partitions 0-3 with column `partition_0` having a value of `2022` etc", "keywords": ["provider", "policy"]}]}, {"Id": "274304720", "PostHistoryTypeId": "24", "PostId": "73000015", "RevisionGUID": "d66f8ddc-466d-4b7c-b8e8-e47ec2145cf6", "CreationDate": "2022-07-16T00:01:39.797", "Comment": "Proposed by 16790137 approved by 5800846 edit id of 5393946", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "274300431", "PostHistoryTypeId": "2", "PostId": "73000015", "RevisionGUID": "1157e939-8da7-4f9a-bfcf-3b2951ae274a", "CreationDate": "2022-07-15T22:05:52.940", "UserId": "5800846", "Text": "I have the below config to read data from S3 written there by Kinesis Firehose:\r\n\r\n    S3AthenaStore:\r\n      Type: AWS::S3::Bucket\r\n      Properties:\r\n        BucketName:  ${self:custom.s3AthenaStore}\r\n\r\n    AnalysisGlueDatabase:\r\n      Type: AWS::Glue::Database\r\n      Properties:\r\n        CatalogId: !Ref AWS::AccountId\r\n        DatabaseInput:\r\n          Name:  !Join \r\n            - ''\r\n            - - '${self:custom.glueName}-'\r\n              - 'db'\r\n          Description: \"Analysis aws Glue database\"\r\n      DependsOn:\r\n        - S3AthenaStore\r\n\r\n    AnalyticsGlueRole:\r\n      Type: AWS::IAM::Role\r\n      DependsOn:\r\n        - S3AnalyticsStore\r\n      Properties:\r\n        AssumeRolePolicyDocument:\r\n          Version: \"2012-10-17\"\r\n          Statement:\r\n            -\r\n              Effect: \"Allow\"\r\n              Principal:\r\n                Service:\r\n                  - \"glue.amazonaws.com\"\r\n              Action:\r\n                - \"sts:AssumeRole\"\r\n        Path: \"/\"\r\n        ManagedPolicyArns:\r\n          ['arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole']\r\n        Policies:\r\n          -\r\n            PolicyName: \"S3BucketAccessPolicy\"\r\n            PolicyDocument:\r\n              Version: \"2012-10-17\"\r\n              Statement:\r\n                -\r\n                  Effect: \"Allow\"\r\n                  Action: \r\n                    - \"s3:GetObject\"\r\n                    - \"s3:PutObject\"\r\n                  Resource: \r\n                    - !Join\r\n                      - ''\r\n                      - - !GetAtt S3AnalyticsStore.Arn\r\n                        - \"*\"\r\n  \r\n    AnalyticsGlueCrawler:\r\n      Type: AWS::Glue::Crawler\r\n      Properties:\r\n        Name: \"AnalysisCrawler\"\r\n        Role: !GetAtt AnalyticsGlueRole.Arn\r\n        DatabaseName: !Ref AnalysisGlueDatabase\r\n        Targets:\r\n          S3Targets:\r\n            - Path: !Ref S3AnalyticsStore\r\n        SchemaChangePolicy:\r\n          UpdateBehavior: \"LOG\"\r\n          DeleteBehavior: \"LOG\"\r\n        Schedule:\r\n          ScheduleExpression: \"cron(00 0/1 * * ? *)\"\r\n        RecrawlPolicy: \r\n          RecrawlBehavior: CRAWL_NEW_FOLDERS_ONLY\r\n      DependsOn:\r\n        - AnalyticsGlueRole\r\n        - AnalysisGlueDatabase\r\n\r\n    AnalyticsAthenaWorkGroup:\r\n      Type: AWS::Athena::WorkGroup\r\n      Properties: \r\n        Name: ${self:service}-${self:provider.stage}-wg\r\n        WorkGroupConfiguration: \r\n          ResultConfiguration:\r\n            OutputLocation: \r\n              !Join\r\n                - ''\r\n                - - 's3://'\r\n                  - !Ref S3AthenaStore\r\n      DependsOn:\r\n        - S3AthenaStore\r\n\r\nThe data is the folders with the following pattern: `${bucket}/${year}/${month}/${date}/${hour}/event-collection-stream-staging-deliver-1-2022-07-14-23-51-22-cdb2f06a-e825-47d0-a781-efd4195ab88d.gz` and it looks like:\r\n\r\n    {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:47.186Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:50.726Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:53.628Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"}\r\n\r\nMy question is - how come my data is automatically partitioned in Athena? When I run: `select * from page_view_store_staging`, it returns: my columns, plus columns for four (4) partitions 0-3 with column `partition_0` having a value of `2022` etc.\r\n\r\nI did not specify this in my config, did I?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have the below config to read data from S3 written there by Kinesis Firehose: S3AthenaStore: Type: AWS::S3::Bucket Properties: BucketName: ${self:custom.s3AthenaStore} AnalysisGlueDatabase: Type: AWS::Glue::Database Properties: CatalogId: !Ref AWS::AccountId DatabaseInput: Name: !Join - '' - - '${self:custom.glueName}-' - 'db' Description: \"Analysis aws Glue database\" DependsOn: - S3AthenaStore AnalyticsGlueRole: Type: AWS::IAM::Role DependsOn: - S3AnalyticsStore Properties: AssumeRolePolicyDocument: Version: \"2012-10-17\" Statement: - Effect: \"Allow\" Principal: Service: - \"glue.amazonaws.com\" Action: - \"sts:AssumeRole\" Path: \"/\" ManagedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole'] Policies: - PolicyName: \"S3BucketAccessPolicy\" PolicyDocument: Version: \"2012-10-17\" Statement: - Effect: \"Allow\" Action: - \"s3:GetObject\" - \"s3:PutObject\" Resource: - !Join - '' - - !GetAtt S3AnalyticsStore.Arn - \"*\" AnalyticsGlueCrawler: Type: AWS::Glue::Crawler Properties: Name: \"AnalysisCrawler\" Role: !GetAtt AnalyticsGlueRole.Arn DatabaseName: !Ref AnalysisGlueDatabase Targets: S3Targets: - Path: !Ref S3AnalyticsStore SchemaChangePolicy: UpdateBehavior: \"LOG\" DeleteBehavior: \"LOG\" Schedule: ScheduleExpression: \"cron(00 0/1 * * ? *)\" RecrawlPolicy: RecrawlBehavior: CRAWL_NEW_FOLDERS_ONLY DependsOn: - AnalyticsGlueRole - AnalysisGlueDatabase AnalyticsAthenaWorkGroup: Type: AWS::Athena::WorkGroup Properties: Name: ${self:service}-${self:provider.stage}-wg WorkGroupConfiguration: ResultConfiguration: OutputLocation: !Join - '' - - 's3://' - !Ref S3AthenaStore DependsOn: - S3AthenaStore ", "keywords": ["provider", "policy"]}]}, {"Id": "274300433", "PostHistoryTypeId": "1", "PostId": "73000015", "RevisionGUID": "1157e939-8da7-4f9a-bfcf-3b2951ae274a", "CreationDate": "2022-07-15T22:05:52.940", "UserId": "5800846", "Text": "Athena partitions data based on the location/date", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "274300434", "PostHistoryTypeId": "3", "PostId": "73000015", "RevisionGUID": "1157e939-8da7-4f9a-bfcf-3b2951ae274a", "CreationDate": "2022-07-15T22:05:52.940", "UserId": "5800846", "Text": "|amazon-web-services|aws-cloudformation|aws-glue|amazon-athena|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "275691569", "PostHistoryTypeId": "8", "PostId": "73000015", "RevisionGUID": "86d9cd8f-b52c-413a-8b71-a2c2347dfbe0", "CreationDate": "2022-08-05T21:07:04.220", "UserId": "6296561", "Comment": "Rollback to [1157e939-8da7-4f9a-bfcf-3b2951ae274a] - Edit approval overridden by post owner or moderator", "Text": "I have the below config to read data from S3 written there by Kinesis Firehose:\r\n\r\n    S3AthenaStore:\r\n      Type: AWS::S3::Bucket\r\n      Properties:\r\n        BucketName:  ${self:custom.s3AthenaStore}\r\n\r\n    AnalysisGlueDatabase:\r\n      Type: AWS::Glue::Database\r\n      Properties:\r\n        CatalogId: !Ref AWS::AccountId\r\n        DatabaseInput:\r\n          Name:  !Join \r\n            - ''\r\n            - - '${self:custom.glueName}-'\r\n              - 'db'\r\n          Description: \"Analysis aws Glue database\"\r\n      DependsOn:\r\n        - S3AthenaStore\r\n\r\n    AnalyticsGlueRole:\r\n      Type: AWS::IAM::Role\r\n      DependsOn:\r\n        - S3AnalyticsStore\r\n      Properties:\r\n        AssumeRolePolicyDocument:\r\n          Version: \"2012-10-17\"\r\n          Statement:\r\n            -\r\n              Effect: \"Allow\"\r\n              Principal:\r\n                Service:\r\n                  - \"glue.amazonaws.com\"\r\n              Action:\r\n                - \"sts:AssumeRole\"\r\n        Path: \"/\"\r\n        ManagedPolicyArns:\r\n          ['arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole']\r\n        Policies:\r\n          -\r\n            PolicyName: \"S3BucketAccessPolicy\"\r\n            PolicyDocument:\r\n              Version: \"2012-10-17\"\r\n              Statement:\r\n                -\r\n                  Effect: \"Allow\"\r\n                  Action: \r\n                    - \"s3:GetObject\"\r\n                    - \"s3:PutObject\"\r\n                  Resource: \r\n                    - !Join\r\n                      - ''\r\n                      - - !GetAtt S3AnalyticsStore.Arn\r\n                        - \"*\"\r\n  \r\n    AnalyticsGlueCrawler:\r\n      Type: AWS::Glue::Crawler\r\n      Properties:\r\n        Name: \"AnalysisCrawler\"\r\n        Role: !GetAtt AnalyticsGlueRole.Arn\r\n        DatabaseName: !Ref AnalysisGlueDatabase\r\n        Targets:\r\n          S3Targets:\r\n            - Path: !Ref S3AnalyticsStore\r\n        SchemaChangePolicy:\r\n          UpdateBehavior: \"LOG\"\r\n          DeleteBehavior: \"LOG\"\r\n        Schedule:\r\n          ScheduleExpression: \"cron(00 0/1 * * ? *)\"\r\n        RecrawlPolicy: \r\n          RecrawlBehavior: CRAWL_NEW_FOLDERS_ONLY\r\n      DependsOn:\r\n        - AnalyticsGlueRole\r\n        - AnalysisGlueDatabase\r\n\r\n    AnalyticsAthenaWorkGroup:\r\n      Type: AWS::Athena::WorkGroup\r\n      Properties: \r\n        Name: ${self:service}-${self:provider.stage}-wg\r\n        WorkGroupConfiguration: \r\n          ResultConfiguration:\r\n            OutputLocation: \r\n              !Join\r\n                - ''\r\n                - - 's3://'\r\n                  - !Ref S3AthenaStore\r\n      DependsOn:\r\n        - S3AthenaStore\r\n\r\nThe data is the folders with the following pattern: `${bucket}/${year}/${month}/${date}/${hour}/event-collection-stream-staging-deliver-1-2022-07-14-23-51-22-cdb2f06a-e825-47d0-a781-efd4195ab88d.gz` and it looks like:\r\n\r\n    {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:47.186Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:50.726Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"} {\"anonymous_id\":\"123\",\"url\":\"-\",\"event_type\":\"pageView\",\"timestamp\":\"2022-07-12T03:29:53.628Z\",\"source_ip\":\"69.113.177.222\",\"user_agent\":\"curl/7.54.0\"}\r\n\r\nMy question is - how come my data is automatically partitioned in Athena? When I run: `select * from page_view_store_staging`, it returns: my columns, plus columns for four (4) partitions 0-3 with column `partition_0` having a value of `2022` etc.\r\n\r\nI did not specify this in my config, did I?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I have the below config to read data from S3 written there by Kinesis Firehose: S3AthenaStore: Type: AWS::S3::Bucket Properties: BucketName: ${self:custom.s3AthenaStore} AnalysisGlueDatabase: Type: AWS::Glue::Database Properties: CatalogId: !Ref AWS::AccountId DatabaseInput: Name: !Join - '' - - '${self:custom.glueName}-' - 'db' Description: \"Analysis aws Glue database\" DependsOn: - S3AthenaStore AnalyticsGlueRole: Type: AWS::IAM::Role DependsOn: - S3AnalyticsStore Properties: AssumeRolePolicyDocument: Version: \"2012-10-17\" Statement: - Effect: \"Allow\" Principal: Service: - \"glue.amazonaws.com\" Action: - \"sts:AssumeRole\" Path: \"/\" ManagedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole'] Policies: - PolicyName: \"S3BucketAccessPolicy\" PolicyDocument: Version: \"2012-10-17\" Statement: - Effect: \"Allow\" Action: - \"s3:GetObject\" - \"s3:PutObject\" Resource: - !Join - '' - - !GetAtt S3AnalyticsStore.Arn - \"*\" AnalyticsGlueCrawler: Type: AWS::Glue::Crawler Properties: Name: \"AnalysisCrawler\" Role: !GetAtt AnalyticsGlueRole.Arn DatabaseName: !Ref AnalysisGlueDatabase Targets: S3Targets: - Path: !Ref S3AnalyticsStore SchemaChangePolicy: UpdateBehavior: \"LOG\" DeleteBehavior: \"LOG\" Schedule: ScheduleExpression: \"cron(00 0/1 * * ? *)\" RecrawlPolicy: RecrawlBehavior: CRAWL_NEW_FOLDERS_ONLY DependsOn: - AnalyticsGlueRole - AnalysisGlueDatabase AnalyticsAthenaWorkGroup: Type: AWS::Athena::WorkGroup Properties: Name: ${self:service}-${self:provider.stage}-wg WorkGroupConfiguration: ResultConfiguration: OutputLocation: !Join - '' - - 's3://' - !Ref S3AthenaStore DependsOn: - S3AthenaStore ", "keywords": ["provider", "policy"]}]}], "contains-topic": true, "filtered-sentences": []}