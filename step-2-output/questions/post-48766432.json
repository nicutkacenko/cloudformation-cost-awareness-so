{"Id": "48766432", "PostTypeId": "1", "CreationDate": "2018-02-13T12:04:09.813", "Score": "3", "ViewCount": "194", "Body": "<blockquote>\n  <p>Note: This is not a repeated question. As of Oct 2017 SpotFleets can\n  now be attached to a ELB.</p>\n</blockquote>\n\n<p>I am trying to attach a LoadBalancer (Classic) to my SpotFleet config using CloudFormation. \nUnfortunately their documentation does not reflect the Oct 2017 update and I am aware that there are at times delays in adding new features in CF.</p>\n\n<p>The ultimate goal is to have an AutoScalingGroup of 1-2 On-Demand Instances and then supplement the system with 2-3 Spot Instances which will cost, in average, the same as 1 On-Demand Instance of the same size.</p>\n\n<p>I've tried adding the \"LoadBalancerNames\" field in my SpotFleet resource but obviously that fails and rolls back as it's not an existing field.</p>\n\n<p>Here's the config for my SpotFleet:</p>\n\n<pre><code>SpotFleet:\n    Type: 'AWS::EC2::SpotFleet'\n    Properties:\n      LoadBalancerNames:\n        - !Ref ElasticLoadBalancer\n      SpotFleetRequestConfigData:\n        AllocationStrategy: lowestPrice\n        ExcessCapacityTerminationPolicy : default\n        IamFleetRole: 'arn:aws:iam::{removed}:instance-profile/ec2_deployed'\n        ReplaceUnhealthyInstances: true\n        SpotPrice: !Ref FleetInstancePrice\n        TargetCapacity: !Ref FleetInstanceCount\n        TerminateInstancesWithExpiration: false\n        Type: maintain\n        ValidUntil: 2019-12-30T23:59:59Z\n        LaunchSpecifications:\n            - !Ref LaunchConfig\n</code></pre>\n\n<p>I have tried adding the LoadBalancerNames field inside the SpotFleetRequestConfigData object to no avail.</p>\n\n<p><strong>Things I know:</strong></p>\n\n<p>1 - I can add some UserData script to attach each launches Spot Instance to the ELB.</p>\n\n<p>2 - I can create a custom Lambda resource to attach the Spot Fleet to the ELB.</p>\n\n<p>3- I can add the field \"SpotPrice\" to an AutoScalingGroup and it will launch Spot Instances. However I am looking to use SpotFleet and not a bunch of rogue Spot Instances and ultimately prevents me from achieving what I need to achieve.</p>\n\n<p><strong>What exactly am I asking?</strong></p>\n\n<p>Do you know of a more \"Native\" way of attaching the SpotFleet to my ELB?</p>\n", "OwnerUserId": "9329917", "LastEditorUserId": "9329917", "LastEditDate": "2018-02-13T12:21:16.320", "LastActivityDate": "2018-02-13T12:21:16.320", "Title": "CloudFormation: SpotFleet + ElasticLoadBalancer", "Tags": "|amazon-web-services|amazon-ec2|aws-cloudformation|", "AnswerCount": "0", "CommentCount": "0", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 3.0", "history": [{"Id": "166790862", "PostHistoryTypeId": "2", "PostId": "48766432", "RevisionGUID": "f1bfa5c0-abbe-45fd-8271-db5dc94a2c31", "CreationDate": "2018-02-13T12:04:09.813", "UserId": "9329917", "Text": "> Note: This is not a repeated question. As of Oct 2017 SpotFleets can\r\n> now be attached to a ELB.\r\n\r\nI am trying to attach a LoadBalancer (Classic) to my SpotFleet config using CloudFormation. \r\nUnfortunately their documentation does not reflect the Oct 2017 update and I am aware that there are at times delays in adding new features in CF.\r\n\r\nThe ultimate goal is to have an AutoScalingGroup of 1-2 On-Demand Instances and then supplement the system with 2-3 Spot Instances which will cost, in average, the same as 1 On-Demand Instance of the same size.\r\n\r\nI've tried adding the \"LoadBalancerNames\" field in my SpotFleet resource but obviously that fails and rolls back as it's not an existing field.\r\n\r\nHere's the config for my SpotFleet:\r\n\r\n    SpotFleet:\r\n        Type: 'AWS::EC2::SpotFleet'\r\n        Properties:\r\n          LoadBalancerNames:\r\n            - !Ref ElasticLoadBalancer\r\n          SpotFleetRequestConfigData:\r\n            AllocationStrategy: lowestPrice\r\n            ExcessCapacityTerminationPolicy : default\r\n            IamFleetRole: 'arn:aws:iam::{removed}:instance-profile/ec2_deployed'\r\n            ReplaceUnhealthyInstances: true\r\n            SpotPrice: !Ref FleetInstancePrice\r\n            TargetCapacity: !Ref FleetInstanceCount\r\n            TerminateInstancesWithExpiration: false\r\n            Type: maintain\r\n            ValidUntil: 2019-12-30T23:59:59Z\r\n            LaunchSpecification:\r\n                - !Ref LaunchConfig\r\n\r\nI have tried adding the LoadBalancerNames field inside the SpotFleetRequestConfigData object to no avail.\r\n\r\n\r\n**Things I know:**\r\n\r\n1 - I can add some UserData script to attach each launches Spot Instance to the ELB.\r\n\r\n2 - I can create a custom Lambda resource to attach the Spot Fleet to the ELB.\r\n\r\n3- I can add the field \"SpotPrice\" to an AutoScalingGroup and it will launch Spot Instances. However I am looking to use SpotFleet and not a bunch of rogue Spot Instances and ultimately prevents me from achieving what I need to achieve.\r\n\r\n\r\n**What exactly am I asking?**\r\n\r\nDo you know of a more \"Native\" way of attaching the SpotFleet to my ELB?", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "The ultimate goal is to have an AutoScalingGroup of 1-2 On-Demand Instances and then supplement the system with 2-3 Spot Instances which will cost, in average, the same as 1 On-Demand Instance of the same size. ", "keywords": ["cost", "instance"]}, {"source": "Text", "text": "Here's the config for my SpotFleet: SpotFleet: Type: 'AWS::EC2::SpotFleet' Properties: LoadBalancerNames: - !Ref ElasticLoadBalancer SpotFleetRequestConfigData: AllocationStrategy: lowestPrice ExcessCapacityTerminationPolicy : default IamFleetRole: 'arn:aws:iam::{removed}:instance-profile/ec2_deployed' ReplaceUnhealthyInstances: true SpotPrice: !Ref FleetInstancePrice TargetCapacity: !Ref FleetInstanceCount TerminateInstancesWithExpiration: false Type: maintain ValidUntil: 2019-12-30T23:59:59Z LaunchSpecification: - !Ref LaunchConfig I have tried adding the LoadBalancerNames field inside the SpotFleetRequestConfigData object to no avail. ", "keywords": ["instance"]}, {"source": "Text", "text": "**Things I know:** 1 - I can add some UserData script to attach each launches Spot Instance to the ELB. ", "keywords": ["instance"]}]}, {"Id": "166790863", "PostHistoryTypeId": "1", "PostId": "48766432", "RevisionGUID": "f1bfa5c0-abbe-45fd-8271-db5dc94a2c31", "CreationDate": "2018-02-13T12:04:09.813", "UserId": "9329917", "Text": "CloudFormation: SpotFleet + ElasticLoadBalancer", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "166790864", "PostHistoryTypeId": "3", "PostId": "48766432", "RevisionGUID": "f1bfa5c0-abbe-45fd-8271-db5dc94a2c31", "CreationDate": "2018-02-13T12:04:09.813", "UserId": "9329917", "Text": "|amazon-web-services|amazon-ec2|aws-cloudformation|", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": []}, {"Id": "166792145", "PostHistoryTypeId": "5", "PostId": "48766432", "RevisionGUID": "d39e35c6-7bd3-4d68-b3d0-899a24b7ffdf", "CreationDate": "2018-02-13T12:21:16.320", "UserId": "9329917", "Comment": "added 1 character in body", "Text": "> Note: This is not a repeated question. As of Oct 2017 SpotFleets can\r\n> now be attached to a ELB.\r\n\r\nI am trying to attach a LoadBalancer (Classic) to my SpotFleet config using CloudFormation. \r\nUnfortunately their documentation does not reflect the Oct 2017 update and I am aware that there are at times delays in adding new features in CF.\r\n\r\nThe ultimate goal is to have an AutoScalingGroup of 1-2 On-Demand Instances and then supplement the system with 2-3 Spot Instances which will cost, in average, the same as 1 On-Demand Instance of the same size.\r\n\r\nI've tried adding the \"LoadBalancerNames\" field in my SpotFleet resource but obviously that fails and rolls back as it's not an existing field.\r\n\r\nHere's the config for my SpotFleet:\r\n\r\n    SpotFleet:\r\n        Type: 'AWS::EC2::SpotFleet'\r\n        Properties:\r\n          LoadBalancerNames:\r\n            - !Ref ElasticLoadBalancer\r\n          SpotFleetRequestConfigData:\r\n            AllocationStrategy: lowestPrice\r\n            ExcessCapacityTerminationPolicy : default\r\n            IamFleetRole: 'arn:aws:iam::{removed}:instance-profile/ec2_deployed'\r\n            ReplaceUnhealthyInstances: true\r\n            SpotPrice: !Ref FleetInstancePrice\r\n            TargetCapacity: !Ref FleetInstanceCount\r\n            TerminateInstancesWithExpiration: false\r\n            Type: maintain\r\n            ValidUntil: 2019-12-30T23:59:59Z\r\n            LaunchSpecifications:\r\n                - !Ref LaunchConfig\r\n\r\nI have tried adding the LoadBalancerNames field inside the SpotFleetRequestConfigData object to no avail.\r\n\r\n\r\n**Things I know:**\r\n\r\n1 - I can add some UserData script to attach each launches Spot Instance to the ELB.\r\n\r\n2 - I can create a custom Lambda resource to attach the Spot Fleet to the ELB.\r\n\r\n3- I can add the field \"SpotPrice\" to an AutoScalingGroup and it will launch Spot Instances. However I am looking to use SpotFleet and not a bunch of rogue Spot Instances and ultimately prevents me from achieving what I need to achieve.\r\n\r\n\r\n**What exactly am I asking?**\r\n\r\nDo you know of a more \"Native\" way of attaching the SpotFleet to my ELB?", "ContentLicense": "CC BY-SA 3.0", "filtered-sentences": [{"source": "Text", "text": "The ultimate goal is to have an AutoScalingGroup of 1-2 On-Demand Instances and then supplement the system with 2-3 Spot Instances which will cost, in average, the same as 1 On-Demand Instance of the same size. ", "keywords": ["cost", "instance"]}, {"source": "Text", "text": "Here's the config for my SpotFleet: SpotFleet: Type: 'AWS::EC2::SpotFleet' Properties: LoadBalancerNames: - !Ref ElasticLoadBalancer SpotFleetRequestConfigData: AllocationStrategy: lowestPrice ExcessCapacityTerminationPolicy : default IamFleetRole: 'arn:aws:iam::{removed}:instance-profile/ec2_deployed' ReplaceUnhealthyInstances: true SpotPrice: !Ref FleetInstancePrice TargetCapacity: !Ref FleetInstanceCount TerminateInstancesWithExpiration: false Type: maintain ValidUntil: 2019-12-30T23:59:59Z LaunchSpecifications: - !Ref LaunchConfig I have tried adding the LoadBalancerNames field inside the SpotFleetRequestConfigData object to no avail. ", "keywords": ["instance"]}, {"source": "Text", "text": "**Things I know:** 1 - I can add some UserData script to attach each launches Spot Instance to the ELB. ", "keywords": ["instance"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "The ultimate goal is to have an AutoScalingGroup of 1-2 On-Demand Instances and then supplement the system with 2-3 Spot Instances which will cost, in average, the same as 1 On-Demand Instance of the same size. ", "keywords": ["cost", "instance"]}, {"source": "Body", "text": "Things I know: 1 - I can add some UserData script to attach each launches Spot Instance to the ELB. ", "keywords": ["instance"]}]}