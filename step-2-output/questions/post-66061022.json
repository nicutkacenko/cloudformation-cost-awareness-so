{"Id": "66061022", "PostTypeId": "1", "AcceptedAnswerId": "66095131", "CreationDate": "2021-02-05T09:49:09.397", "Score": "1", "ViewCount": "2351", "Body": "<p>When my azure-pipelines.yml file defines and passes down a variable with an integer-type value to a AWS Cloudformation template as a parameter, the template fails to use that parameter as a Number type.\nThis causes my Cloudformation stack to fail. How can I instruct the Azure pipeline to keep the integer type ? Here is the variable definitions in <code>azure-pipelines.yml</code> (The problematic ones are <code>budget_amount</code> and <code>amount_threshold</code>):</p>\n<pre><code>variables:\n  email_recipients: &quot;example@gmail.com&quot;\n  budget_amount: 100\n  amount_threshold: 80\n</code></pre>\n<p>Then sending them down to a azure-pipelines template <code>deploy_env.yml</code>:</p>\n<pre><code>- template: azure-pipelines/stages/deploy_env.yml\n  parameters:\n    stage_name: deploy\n    aws_credentials: $(aws_dev_credentials)\n    aws_region: $(aws_region)\n    user_initials: $(user_initials)\n    email_recipients: $(email_recipients)\n    budget_amount: $(budget_amount)\n    amount_threshold: $(amount_threshold)\n</code></pre>\n<p>And the passing of them to the Cloudformation template:</p>\n<pre><code>- task: CloudFormationCreateOrUpdateStack@1\n  displayName: budgets\n  inputs:\n    awsCredentials: ${{parameters.aws_credentials}}\n    regionName: ${{parameters.aws_region}}\n    stackName: ${{parameters.stack_name}}\n    templateSource: 'file'\n    templateFile: $(Pipeline.Workspace)/${{parameters.project_name}}-templates/budgets.yml\n    templateParametersSource: &quot;inline&quot;\n    templateParameters: |\n      - ParameterKey: EmailRecipients\n        ParameterValue: ${{parameters.email_recipients}}\n      - ParameterKey: BudgetAmount\n        ParameterValue: ${{parameters.budget_amount}}\n      - ParameterKey: AmountThreshold\n        ParameterValue: ${{parameters.amount_threshold}}\n    useChangeSet: true\n    changeSetName: 'role-changeset'\n    captureStackOutputs: asVariables\n    captureAsSecuredVars: false\n</code></pre>\n<p>The Cloudformation template <code>budgets.yml</code>:</p>\n<pre><code>Parameters:\n  EmailRecipients:\n    Type: String\n    Description: Name of the Email Recipient\n  BudgetAmount:\n    Type: Number\n    Default: 500\n    Description: Budget Amount\n  AmountThreshold:\n    Type: Number\n    Default: 80\n    Description: Budget Threshold\n\nResources:\n  BudgetExample:\n    Type: &quot;AWS::Budgets::Budget&quot;\n    Properties:\n      Budget:\n        BudgetLimit:\n          Amount: !Sub ${BudgetAmount}\n          Unit: USD\n        TimeUnit: MONTHLY\n        BudgetType: COST\n      NotificationsWithSubscribers:\n        - Notification:\n            NotificationType: ACTUAL\n            ComparisonOperator: GREATER_THAN\n            Threshold: !Sub ${AmountThreshold}\n          Subscribers:\n            - SubscriptionType: EMAIL\n              Address: !Sub ${EmailRecipients}\n</code></pre>\n<p>The error thrown is:</p>\n<pre><code>##[error]MultipleValidationErrors: There were 2 validation errors:\n* InvalidParameterType: Expected params.Parameters[1].ParameterValue to be a string\n* InvalidParameterType: Expected params.Parameters[2].ParameterValue to be a string\n</code></pre>\n", "OwnerUserId": "7445528", "LastEditorUserId": "7445528", "LastEditDate": "2021-02-05T10:28:14.313", "LastActivityDate": "2021-02-08T02:14:53.720", "Title": "Pass Azure pipeline variable to AWS Cloudformation template as parameter with type: Number", "Tags": "|amazon-web-services|azure-devops|azure-pipelines|aws-cloudformation|azure-pipelines-release-pipeline|", "AnswerCount": "1", "CommentCount": "4", "FavoriteCount": "0", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "116798129", "PostId": "66061022", "Score": "1", "Text": "Can you verify? You are setting `variables` but using `parameters` to access them. In the [docs](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch#user-defined-variables) it seems that it should be `variables` to access them?", "CreationDate": "2021-02-05T10:17:00.603", "UserId": "248823", "filtered-sentences": []}, {"Id": "116798174", "PostId": "66061022", "Score": "0", "Text": "@Marcin As I understand it: In Azure pipelines, variables are used, in AWS Cloudformation, parameters.", "CreationDate": "2021-02-05T10:19:08.403", "UserId": "7445528", "filtered-sentences": []}, {"Id": "116798262", "PostId": "66061022", "Score": "1", "Text": "I see. I though maybe `${{parameters.email_recipients}}` should be `${{variables.email_recipients}}`.", "CreationDate": "2021-02-05T10:22:37.827", "UserId": "248823", "filtered-sentences": []}, {"Id": "116798455", "PostId": "66061022", "Score": "1", "Text": "Updated the question to better show how variables are passed down as template parameters.", "CreationDate": "2021-02-05T10:29:35.797", "UserId": "7445528", "filtered-sentences": []}], "history": [{"Id": "240211144", "PostHistoryTypeId": "5", "PostId": "66061022", "RevisionGUID": "aa67f8bc-d269-4397-950e-0fb2b2d45975", "CreationDate": "2021-02-05T10:28:14.313", "UserId": "7445528", "Comment": "added 408 characters in body", "Text": "When my azure-pipelines.yml file defines and passes down a variable with an integer-type value to a AWS Cloudformation template as a parameter, the template fails to use that parameter as a Number type.\r\nThis causes my Cloudformation stack to fail. How can I instruct the Azure pipeline to keep the integer type ? Here is the variable definitions in `azure-pipelines.yml` (The problematic ones are `budget_amount` and `amount_threshold`):\r\n```\r\nvariables:\r\n  email_recipients: \"example@gmail.com\"\r\n  budget_amount: 100\r\n  amount_threshold: 80\r\n```\r\nThen sending them down to a azure-pipelines template `deploy_env.yml`:\r\n```\r\n- template: azure-pipelines/stages/deploy_env.yml\r\n  parameters:\r\n    stage_name: deploy\r\n    aws_credentials: $(aws_dev_credentials)\r\n    aws_region: $(aws_region)\r\n    user_initials: $(user_initials)\r\n    email_recipients: $(email_recipients)\r\n    budget_amount: $(budget_amount)\r\n    amount_threshold: $(amount_threshold)\r\n```\r\nAnd the passing of them to the Cloudformation template:\r\n```\r\n- task: CloudFormationCreateOrUpdateStack@1\r\n  displayName: budgets\r\n  inputs:\r\n    awsCredentials: ${{parameters.aws_credentials}}\r\n    regionName: ${{parameters.aws_region}}\r\n    stackName: ${{parameters.stack_name}}\r\n    templateSource: 'file'\r\n    templateFile: $(Pipeline.Workspace)/${{parameters.project_name}}-templates/budgets.yml\r\n    templateParametersSource: \"inline\"\r\n    templateParameters: |\r\n      - ParameterKey: EmailRecipients\r\n        ParameterValue: ${{parameters.email_recipients}}\r\n      - ParameterKey: BudgetAmount\r\n        ParameterValue: ${{parameters.budget_amount}}\r\n      - ParameterKey: AmountThreshold\r\n        ParameterValue: ${{parameters.amount_threshold}}\r\n    useChangeSet: true\r\n    changeSetName: 'role-changeset'\r\n    captureStackOutputs: asVariables\r\n    captureAsSecuredVars: false\r\n```\r\nThe Cloudformation template `budgets.yml`:\r\n```\r\nParameters:\r\n  EmailRecipients:\r\n    Type: String\r\n    Description: Name of the Email Recipient\r\n  BudgetAmount:\r\n    Type: Number\r\n    Default: 500\r\n    Description: Budget Amount\r\n  AmountThreshold:\r\n    Type: Number\r\n    Default: 80\r\n    Description: Budget Threshold\r\n\r\nResources:\r\n  BudgetExample:\r\n    Type: \"AWS::Budgets::Budget\"\r\n    Properties:\r\n      Budget:\r\n        BudgetLimit:\r\n          Amount: !Sub ${BudgetAmount}\r\n          Unit: USD\r\n        TimeUnit: MONTHLY\r\n        BudgetType: COST\r\n      NotificationsWithSubscribers:\r\n        - Notification:\r\n            NotificationType: ACTUAL\r\n            ComparisonOperator: GREATER_THAN\r\n            Threshold: !Sub ${AmountThreshold}\r\n          Subscribers:\r\n            - SubscriptionType: EMAIL\r\n              Address: !Sub ${EmailRecipients}\r\n```\r\nThe error thrown is:\r\n```\r\n##[error]MultipleValidationErrors: There were 2 validation errors:\r\n* InvalidParameterType: Expected params.Parameters[1].ParameterValue to be a string\r\n* InvalidParameterType: Expected params.Parameters[2].ParameterValue to be a string\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Then sending them down to a azure-pipelines template `deploy_env.yml`: ``` - template: azure-pipelines/stages/deploy_env.yml parameters: stage_name: deploy aws_credentials: $(aws_dev_credentials) aws_region: $(aws_region) user_initials: $(user_initials) email_recipients: $(email_recipients) budget_amount: $(budget_amount) amount_threshold: $(amount_threshold) ``` And the passing of them to the Cloudformation template: ``` - task: CloudFormationCreateOrUpdateStack@1 displayName: budgets inputs: awsCredentials: ${{parameters.aws_credentials}} regionName: ${{parameters.aws_region}} stackName: ${{parameters.stack_name}} templateSource: 'file' templateFile: $(Pipeline.Workspace)/${{parameters.project_name}}-templates/budgets.yml templateParametersSource: \"inline\" templateParameters: | - ParameterKey: EmailRecipients ParameterValue: ${{parameters.email_recipients}} - ParameterKey: BudgetAmount ParameterValue: ${{parameters.budget_amount}} - ParameterKey: AmountThreshold ParameterValue: ${{parameters.amount_threshold}} useChangeSet: true changeSetName: 'role-changeset' captureStackOutputs: asVariables captureAsSecuredVars: false ``` The Cloudformation template `budgets.yml`: ``` Parameters: EmailRecipients: Type: String Description: Name of the Email Recipient BudgetAmount: Type: Number Default: 500 Description: Budget Amount AmountThreshold: Type: Number Default: 80 Description: Budget Threshold Resources: BudgetExample: Type: \"AWS::Budgets::Budget\" Properties: Budget: BudgetLimit: Amount: !Sub ${BudgetAmount} Unit: USD TimeUnit: MONTHLY BudgetType: COST NotificationsWithSubscribers: - Notification: NotificationType: ACTUAL ComparisonOperator: GREATER_THAN Threshold: !Sub ${AmountThreshold} Subscribers: - SubscriptionType: EMAIL Address: !Sub ${EmailRecipients} ``` The error thrown is: ``` ##[error]MultipleValidationErrors: There were 2 validation errors: * InvalidParameterType: Expected params.Parameters[1].ParameterValue to be a string * InvalidParameterType: Expected params.Parameters[2].ParameterValue to be a string ```", "keywords": ["cost", "change"]}]}, {"Id": "240208781", "PostHistoryTypeId": "2", "PostId": "66061022", "RevisionGUID": "653e98e0-dcbd-4276-8061-0e6a96de6b7a", "CreationDate": "2021-02-05T09:49:09.397", "UserId": "7445528", "Text": "When my azure-pipelines.yml file defines and passes down a variable with an integer-type value to a AWS Cloudformation template as a parameter, the template fails to use that parameter as a Number type.\r\nThis causes my Cloudformation stack to fail. How can I instruct the Azure pipeline to keep the integer type ? Here is the variable definitions in `azure-pipelines.yml` (The problematic ones are `budget_amount` and `amount_threshold`):\r\n```\r\nvariables:\r\n  email_recipients: \"example@gmail.com\"\r\n  budget_amount: 100\r\n  amount_threshold: 80\r\n```\r\nAnd the passing of them to the Cloudformation template:\r\n```\r\n- task: CloudFormationCreateOrUpdateStack@1\r\n  displayName: budgets\r\n  inputs:\r\n    awsCredentials: ${{parameters.aws_credentials}}\r\n    regionName: ${{parameters.aws_region}}\r\n    stackName: ${{parameters.stack_name}}\r\n    templateSource: 'file'\r\n    templateFile: $(Pipeline.Workspace)/${{parameters.project_name}}-templates/budgets.yml\r\n    templateParametersSource: \"inline\"\r\n    templateParameters: |\r\n      - ParameterKey: EmailRecipients\r\n        ParameterValue: ${{parameters.email_recipients}}\r\n      - ParameterKey: BudgetAmount\r\n        ParameterValue: ${{parameters.budget_amount}}\r\n      - ParameterKey: AmountThreshold\r\n        ParameterValue: ${{parameters.amount_threshold}}\r\n    useChangeSet: true\r\n    changeSetName: 'role-changeset'\r\n    captureStackOutputs: asVariables\r\n    captureAsSecuredVars: false\r\n```\r\nThe Cloudformation template `budgets.yml`:\r\n```\r\nParameters:\r\n  EmailRecipients:\r\n    Type: String\r\n    Description: Name of the Email Recipient\r\n  BudgetAmount:\r\n    Type: Number\r\n    Default: 500\r\n    Description: Budget Amount\r\n  AmountThreshold:\r\n    Type: Number\r\n    Default: 80\r\n    Description: Budget Threshold\r\n\r\nResources:\r\n  BudgetExample:\r\n    Type: \"AWS::Budgets::Budget\"\r\n    Properties:\r\n      Budget:\r\n        BudgetLimit:\r\n          Amount: !Sub ${BudgetAmount}\r\n          Unit: USD\r\n        TimeUnit: MONTHLY\r\n        BudgetType: COST\r\n      NotificationsWithSubscribers:\r\n        - Notification:\r\n            NotificationType: ACTUAL\r\n            ComparisonOperator: GREATER_THAN\r\n            Threshold: !Sub ${AmountThreshold}\r\n          Subscribers:\r\n            - SubscriptionType: EMAIL\r\n              Address: !Sub ${EmailRecipients}\r\n```\r\nThe error thrown is:\r\n```\r\n##[error]MultipleValidationErrors: There were 2 validation errors:\r\n* InvalidParameterType: Expected params.Parameters[1].ParameterValue to be a string\r\n* InvalidParameterType: Expected params.Parameters[2].ParameterValue to be a string\r\n```", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "And the passing of them to the Cloudformation template: ``` - task: CloudFormationCreateOrUpdateStack@1 displayName: budgets inputs: awsCredentials: ${{parameters.aws_credentials}} regionName: ${{parameters.aws_region}} stackName: ${{parameters.stack_name}} templateSource: 'file' templateFile: $(Pipeline.Workspace)/${{parameters.project_name}}-templates/budgets.yml templateParametersSource: \"inline\" templateParameters: | - ParameterKey: EmailRecipients ParameterValue: ${{parameters.email_recipients}} - ParameterKey: BudgetAmount ParameterValue: ${{parameters.budget_amount}} - ParameterKey: AmountThreshold ParameterValue: ${{parameters.amount_threshold}} useChangeSet: true changeSetName: 'role-changeset' captureStackOutputs: asVariables captureAsSecuredVars: false ``` The Cloudformation template `budgets.yml`: ``` Parameters: EmailRecipients: Type: String Description: Name of the Email Recipient BudgetAmount: Type: Number Default: 500 Description: Budget Amount AmountThreshold: Type: Number Default: 80 Description: Budget Threshold Resources: BudgetExample: Type: \"AWS::Budgets::Budget\" Properties: Budget: BudgetLimit: Amount: !Sub ${BudgetAmount} Unit: USD TimeUnit: MONTHLY BudgetType: COST NotificationsWithSubscribers: - Notification: NotificationType: ACTUAL ComparisonOperator: GREATER_THAN Threshold: !Sub ${AmountThreshold} Subscribers: - SubscriptionType: EMAIL Address: !Sub ${EmailRecipients} ``` The error thrown is: ``` ##[error]MultipleValidationErrors: There were 2 validation errors: * InvalidParameterType: Expected params.Parameters[1].ParameterValue to be a string * InvalidParameterType: Expected params.Parameters[2].ParameterValue to be a string ```", "keywords": ["cost", "change"]}]}, {"Id": "240208782", "PostHistoryTypeId": "1", "PostId": "66061022", "RevisionGUID": "653e98e0-dcbd-4276-8061-0e6a96de6b7a", "CreationDate": "2021-02-05T09:49:09.397", "UserId": "7445528", "Text": "Pass Azure pipeline variable to AWS Cloudformation template as parameter with type: Number", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "240208783", "PostHistoryTypeId": "3", "PostId": "66061022", "RevisionGUID": "653e98e0-dcbd-4276-8061-0e6a96de6b7a", "CreationDate": "2021-02-05T09:49:09.397", "UserId": "7445528", "Text": "|amazon-web-services|azure-devops|azure-pipelines|aws-cloudformation|azure-pipelines-release-pipeline|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "66095131", "PostTypeId": "2", "ParentId": "66061022", "CreationDate": "2021-02-08T02:14:53.720", "Score": "1", "Body": "<p>In Azure Devops, the variable is <strong>String type</strong> by default. So when you use variable to pass the value to parameter, the value is still the string type. This could be the root cause of this issue.</p>\n<p>To solve this issue, you need to use the number type <a href=\"https://learn.microsoft.com/en-us/azure/devops/pipelines/process/runtime-parameters?view=azure-devops&amp;tabs=script#parameter-data-types\" rel=\"nofollow noreferrer\">Parameters</a>.</p>\n<p><strong>Format:</strong></p>\n<pre><code>parameters:\n- name: myNumber\n  type: number\n  default: 2\n</code></pre>\n<p>In you case, you could define the Number type Parameters in your Yaml template(deploy_env.yml), and set the Number type Parameters to pass the value in Main Yaml\uff08azure-pipelines.yml\uff09.</p>\n<p>Here is an example:</p>\n<pre><code>parameters:\n\n    - name: budget_amount\n      type: number\n      default: 100\n    \n    - name: amount_threshold\n      type: number\n      default: 80\n    \n    - name: email_recipients\n      type: string\n      default: &quot;example@gmail.com&quot;\n    \n    \n    \n    steps: \n    \n    - task: CloudFormationCreateOrUpdateStack@1\n    ....\n</code></pre>\n<p>Main Yaml\uff08azure-pipelines.yml\uff09:</p>\n<pre><code>parameters:\n  - name: budget_amount\n    type: number\n    default: 90\n\n  - name: amount_threshold\n    type: number\n    default: 80\n\n  - name: email_recipients\n    type: string\n    default: &quot;example@gmail.com&quot;\n\n\npool:\n  vmImage: 'ubuntu-latest'\n\nsteps:\n- template: deploy_env.yml\n  parameters:\n    budget_amount: ${{parameters.budget_amount}}\n    amount_threshold: ${{parameters.amount_threshold}}\n    email_recipients: ${{parameters.email_recipients}}\n</code></pre>\n", "OwnerUserId": "13464420", "LastActivityDate": "2021-02-08T02:14:53.720", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "240364955", "PostHistoryTypeId": "2", "PostId": "66095131", "RevisionGUID": "5d8757a2-9215-48c1-bf32-d4596124e7f0", "CreationDate": "2021-02-08T02:14:53.720", "UserId": "13464420", "Text": "In Azure Devops, the variable is **String type** by default. So when you use variable to pass the value to parameter, the value is still the string type. This could be the root cause of this issue.\r\n\r\nTo solve this issue, you need to use the number type [Parameters][1].\r\n\r\n**Format:**\r\n\r\n    parameters:\r\n    - name: myNumber\r\n      type: number\r\n      default: 2\r\n\r\nIn you case, you could define the Number type Parameters in your Yaml template(deploy_env.yml), and set the Number type Parameters to pass the value in Main Yaml\uff08azure-pipelines.yml\uff09.\r\n\r\nHere is an example:\r\n\r\n\r\n    parameters:\r\n    \r\n        - name: budget_amount\r\n          type: number\r\n          default: 100\r\n        \r\n        - name: amount_threshold\r\n          type: number\r\n          default: 80\r\n        \r\n        - name: email_recipients\r\n          type: string\r\n          default: \"example@gmail.com\"\r\n        \r\n        \r\n        \r\n        steps: \r\n        \r\n        - task: CloudFormationCreateOrUpdateStack@1\r\n        ....\r\n\r\nMain Yaml\uff08azure-pipelines.yml\uff09:\r\n\r\n    parameters:\r\n      - name: budget_amount\r\n        type: number\r\n        default: 90\r\n    \r\n      - name: amount_threshold\r\n        type: number\r\n        default: 80\r\n    \r\n      - name: email_recipients\r\n        type: string\r\n        default: \"example@gmail.com\"\r\n    \r\n    \r\n    pool:\r\n      vmImage: 'ubuntu-latest'\r\n    \r\n    steps:\r\n    - template: deploy_env.yml\r\n      parameters:\r\n        budget_amount: ${{parameters.budget_amount}}\r\n        amount_threshold: ${{parameters.amount_threshold}}\r\n        email_recipients: ${{parameters.email_recipients}}\r\n\r\n\r\n  [1]: https://learn.microsoft.com/en-us/azure/devops/pipelines/process/runtime-parameters?view=azure-devops&tabs=script#parameter-data-types\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": []}