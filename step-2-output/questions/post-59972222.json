{"Id": "59972222", "PostTypeId": "1", "CreationDate": "2020-01-29T17:08:19.847", "Score": "0", "ViewCount": "536", "Body": "<p>I am working with the AWS Samples templates from <a href=\"https://s3-us-west-1.amazonaws.com/cloudformation-templates-us-west-1/S3_Website_With_CloudFront_Distribution.template\" rel=\"nofollow noreferrer\">enter link description here</a> where I reduced the mapping a little, but leaving everything else as is.  In review the code, and reading the notes within the template, it appears that I should be able to run the code by simply entering the name of the Host Zone which I have registered with Route 53, within the parameter field when running the stack. I also created the certificate via the ACM.</p>\n\n<p>However, I am getting, however, the following error:</p>\n\n<p>To add an alternate domain name (CNAME) to a CloudFront distribution, you must attach a trusted certificate that validates your authorization to use the domain name. For more details, see: <a href=\"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements</a> (Service: AmazonCloudFront; Status Code: 400; Error Code: InvalidViewerCertificate; Request ID: ---------)</p>\n\n<pre><code>{\n  \"AWSTemplateFormatVersion\" : \"2010-09-09\",\n\n  \"Description\" : \"AWS CloudFormation Sample Template S3_Website_With_CloudFront_Distribution: Sample template showing how to create a website with a custom DNS name, hosted on Amazon S3 and served via Amazone CloudFront. It assumes you already have a Hosted Zone registered with Amazon Route 53. **WARNING** This template creates an Amazon Route 53 DNS record, an S3 bucket and a CloudFront distribution. You will be billed for the AWS resources used if you create a stack from this template.\",\n\n  \"Parameters\" : {\n    \"HostedZone\" : {\n      \"Type\" : \"String\",\n      \"Description\" : \"The DNS name of an existing Amazon Route 53 hosted zone\",\n      \"AllowedPattern\" : \"(?!-)[a-zA-Z0-9-.]{1,63}(?&lt;!-)\",\n      \"ConstraintDescription\" : \"must be a valid DNS zone name.\"\n    }\n  },\n\n  \"Mappings\" : {\n    \"Region2S3WebsiteSuffix\": {\n      \"us-east-1\"      : { \"Suffix\": \".s3-website-us-east-1.amazonaws.com\" }\n    }\n\n  },\n\n  \"Resources\" : {\n    \"S3BucketForWebsiteContent\" : {\n      \"Type\" : \"AWS::S3::Bucket\",\n      \"Properties\" : {\n        \"AccessControl\" : \"PublicRead\",\n        \"WebsiteConfiguration\" : {\n           \"IndexDocument\" : \"index.html\",\n           \"ErrorDocument\" : \"error.html\"\n        }\n      }\n    },\n\n    \"WebsiteCDN\" : {\n      \"Type\" : \"AWS::CloudFront::Distribution\",\n      \"Properties\" : {\n         \"DistributionConfig\" : {\n           \"Comment\" : \"CDN for S3-backed website\",\n           \"Aliases\" : [{ \"Fn::Join\" : [ \"\", [{\"Ref\" : \"AWS::StackName\"}, {\"Ref\" : \"AWS::AccountId\"}, \".\", {\"Ref\" : \"AWS::Region\"}, \".\", { \"Ref\" : \"HostedZone\" }]]}],\n           \"Enabled\" : \"true\",\n       \"DefaultCacheBehavior\" : {\n         \"ForwardedValues\" : { \"QueryString\" : \"true\" },\n         \"TargetOriginId\" : \"only-origin\",\n         \"ViewerProtocolPolicy\" : \"allow-all\"\n       },\n           \"DefaultRootObject\" : \"index.html\",\n       \"Origins\" : [\n         { \"CustomOriginConfig\" : \n                 {\n                   \"HTTPPort\" : \"80\",\n                   \"HTTPSPort\" : \"443\",\n                   \"OriginProtocolPolicy\" : \"http-only\"\n                 },\n               \"DomainName\" : { \"Fn::Join\" : [\"\", [{\"Ref\" : \"S3BucketForWebsiteContent\"},\n                                                   {\"Fn::FindInMap\" : [ \"Region2S3WebsiteSuffix\", {\"Ref\" : \"AWS::Region\"}, \"Suffix\" ]}]]},\n           \"Id\" : \"only-origin\"\n             }]\n         }\n      }\n    },\n\n    \"WebsiteDNSName\" : {\n      \"Type\" : \"AWS::Route53::RecordSet\",\n      \"Properties\" : {\n        \"HostedZoneName\" : { \"Fn::Join\" : [ \"\", [{ \"Ref\" : \"HostedZone\" }, \".\"]]},\n        \"Comment\" : \"CNAME redirect custom name to CloudFront distribution\",\n        \"Name\" : { \"Fn::Join\" : [ \"\", [{\"Ref\" : \"AWS::StackName\"}, {\"Ref\" : \"AWS::AccountId\"}, \".\", {\"Ref\" : \"AWS::Region\"}, \".\", { \"Ref\" : \"HostedZone\" }]]},\n        \"Type\" : \"CNAME\",\n        \"TTL\" : \"900\",\n        \"ResourceRecords\" : [{ \"Fn::Join\" : [ \"\", [\"http://\", {\"Fn::GetAtt\" : [\"WebsiteCDN\", \"DomainName\"]} ]]}]\n      }\n    }\n  },\n\n  \"Outputs\" : {\n    \"WebsiteURL\" : {\n      \"Value\" : {\"Fn::Join\" : [ \"\", [\"http://\", {\"Ref\" : \"WebsiteDNSName\"} ]] },\n      \"Description\" : \"The URL of the newly created website\"\n    },\n    \"BucketName\" : {\n      \"Value\" : { \"Ref\" : \"S3BucketForWebsiteContent\" },\n      \"Description\" : \"Name of S3 bucket to hold website content\"\n    }\n  }\n}\n</code></pre>\n", "OwnerUserId": "3200355", "LastActivityDate": "2020-01-29T22:20:11.357", "Title": "AWS Sample Template: S3_Website_With_CloudFront_Distribution.template Fails Upon Start do to Route 53 Domain Name", "Tags": "|amazon-web-services|amazon-s3|aws-cloudformation|amazon-cloudfront|", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "213917822", "PostHistoryTypeId": "2", "PostId": "59972222", "RevisionGUID": "a79ebe72-a78d-4f34-82ba-d6f13a4980b8", "CreationDate": "2020-01-29T17:08:19.847", "UserId": "3200355", "Text": "I am working with the AWS Samples templates from [enter link description here][1] where I reduced the mapping a little, but leaving everything else as is.  In review the code, and reading the notes within the template, it appears that I should be able to run the code by simply entering the name of the Host Zone which I have registered with Route 53, within the parameter field when running the stack. I also created the certificate via the ACM.\r\n\r\nHowever, I am getting, however, the following error:\r\n\r\nTo add an alternate domain name (CNAME) to a CloudFront distribution, you must attach a trusted certificate that validates your authorization to use the domain name. For more details, see: https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements (Service: AmazonCloudFront; Status Code: 400; Error Code: InvalidViewerCertificate; Request ID: ---------)\r\n\r\n\r\n\r\n```\r\n{\r\n  \"AWSTemplateFormatVersion\" : \"2010-09-09\",\r\n\r\n  \"Description\" : \"AWS CloudFormation Sample Template S3_Website_With_CloudFront_Distribution: Sample template showing how to create a website with a custom DNS name, hosted on Amazon S3 and served via Amazone CloudFront. It assumes you already have a Hosted Zone registered with Amazon Route 53. **WARNING** This template creates an Amazon Route 53 DNS record, an S3 bucket and a CloudFront distribution. You will be billed for the AWS resources used if you create a stack from this template.\",\r\n\r\n  \"Parameters\" : {\r\n    \"HostedZone\" : {\r\n      \"Type\" : \"String\",\r\n      \"Description\" : \"The DNS name of an existing Amazon Route 53 hosted zone\",\r\n      \"AllowedPattern\" : \"(?!-)[a-zA-Z0-9-.]{1,63}(?<!-)\",\r\n      \"ConstraintDescription\" : \"must be a valid DNS zone name.\"\r\n    }\r\n  },\r\n\r\n  \"Mappings\" : {\r\n    \"Region2S3WebsiteSuffix\": {\r\n      \"us-east-1\"      : { \"Suffix\": \".s3-website-us-east-1.amazonaws.com\" }\r\n    }\r\n\r\n  },\r\n\r\n  \"Resources\" : {\r\n    \"S3BucketForWebsiteContent\" : {\r\n      \"Type\" : \"AWS::S3::Bucket\",\r\n      \"Properties\" : {\r\n        \"AccessControl\" : \"PublicRead\",\r\n        \"WebsiteConfiguration\" : {\r\n           \"IndexDocument\" : \"index.html\",\r\n           \"ErrorDocument\" : \"error.html\"\r\n        }\r\n      }\r\n    },\r\n\r\n    \"WebsiteCDN\" : {\r\n      \"Type\" : \"AWS::CloudFront::Distribution\",\r\n      \"Properties\" : {\r\n         \"DistributionConfig\" : {\r\n           \"Comment\" : \"CDN for S3-backed website\",\r\n           \"Aliases\" : [{ \"Fn::Join\" : [ \"\", [{\"Ref\" : \"AWS::StackName\"}, {\"Ref\" : \"AWS::AccountId\"}, \".\", {\"Ref\" : \"AWS::Region\"}, \".\", { \"Ref\" : \"HostedZone\" }]]}],\r\n           \"Enabled\" : \"true\",\r\n    \"DefaultCacheBehavior\" : {\r\n      \"ForwardedValues\" : { \"QueryString\" : \"true\" },\r\n      \"TargetOriginId\" : \"only-origin\",\r\n      \"ViewerProtocolPolicy\" : \"allow-all\"\r\n    },\r\n           \"DefaultRootObject\" : \"index.html\",\r\n    \"Origins\" : [\r\n      { \"CustomOriginConfig\" : \r\n                 {\r\n                   \"HTTPPort\" : \"80\",\r\n                   \"HTTPSPort\" : \"443\",\r\n                   \"OriginProtocolPolicy\" : \"http-only\"\r\n                 },\r\n               \"DomainName\" : { \"Fn::Join\" : [\"\", [{\"Ref\" : \"S3BucketForWebsiteContent\"},\r\n                                                   {\"Fn::FindInMap\" : [ \"Region2S3WebsiteSuffix\", {\"Ref\" : \"AWS::Region\"}, \"Suffix\" ]}]]},\r\n        \"Id\" : \"only-origin\"\r\n             }]\r\n         }\r\n      }\r\n    },\r\n\r\n    \"WebsiteDNSName\" : {\r\n      \"Type\" : \"AWS::Route53::RecordSet\",\r\n      \"Properties\" : {\r\n        \"HostedZoneName\" : { \"Fn::Join\" : [ \"\", [{ \"Ref\" : \"HostedZone\" }, \".\"]]},\r\n        \"Comment\" : \"CNAME redirect custom name to CloudFront distribution\",\r\n        \"Name\" : { \"Fn::Join\" : [ \"\", [{\"Ref\" : \"AWS::StackName\"}, {\"Ref\" : \"AWS::AccountId\"}, \".\", {\"Ref\" : \"AWS::Region\"}, \".\", { \"Ref\" : \"HostedZone\" }]]},\r\n        \"Type\" : \"CNAME\",\r\n        \"TTL\" : \"900\",\r\n        \"ResourceRecords\" : [{ \"Fn::Join\" : [ \"\", [\"http://\", {\"Fn::GetAtt\" : [\"WebsiteCDN\", \"DomainName\"]} ]]}]\r\n      }\r\n    }\r\n  },\r\n\r\n  \"Outputs\" : {\r\n    \"WebsiteURL\" : {\r\n      \"Value\" : {\"Fn::Join\" : [ \"\", [\"http://\", {\"Ref\" : \"WebsiteDNSName\"} ]] },\r\n      \"Description\" : \"The URL of the newly created website\"\r\n    },\r\n    \"BucketName\" : {\r\n      \"Value\" : { \"Ref\" : \"S3BucketForWebsiteContent\" },\r\n      \"Description\" : \"Name of S3 bucket to hold website content\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n\r\n  [1]: https://s3-us-west-1.amazonaws.com/cloudformation-templates-us-west-1/S3_Website_With_CloudFront_Distribution.template", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "However, I am getting, however, the following error: To add an alternate domain name (CNAME) to a CloudFront distribution, you must attach a trusted certificate that validates your authorization to use the domain name. ", "keywords": ["domain"]}, {"source": "Text", "text": "For more details, see: https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements (Service: AmazonCloudFront; Status Code: 400; Error Code: InvalidViewerCertificate; Request ID: ---------) ``` { \"AWSTemplateFormatVersion\" : \"2010-09-09\", \"Description\" : \"AWS CloudFormation Sample Template S3_Website_With_CloudFront_Distribution: Sample template showing how to create a website with a custom DNS name, hosted on Amazon S3 and served via Amazone CloudFront. ", "keywords": ["domain"]}, {"source": "Text", "text": "You will be billed for the AWS resources used if you create a stack from this template.\", \"Parameters\" : { \"HostedZone\" : { \"Type\" : \"String\", \"Description\" : \"The DNS name of an existing Amazon Route 53 hosted zone\", \"AllowedPattern\" : \"(?!-)[a-zA-Z0-9-.]{1,63}(?<!-)\", \"ConstraintDescription\" : \"must be a valid DNS zone name.\" } }, \"Mappings\" : { \"Region2S3WebsiteSuffix\": { \"us-east-1\" : { \"Suffix\": \".s3-website-us-east-1.amazonaws.com\" } } }, \"Resources\" : { \"S3BucketForWebsiteContent\" : { \"Type\" : \"AWS::S3::Bucket\", \"Properties\" : { \"AccessControl\" : \"PublicRead\", \"WebsiteConfiguration\" : { \"IndexDocument\" : \"index.html\", \"ErrorDocument\" : \"error.html\" } } }, \"WebsiteCDN\" : { \"Type\" : \"AWS::CloudFront::Distribution\", \"Properties\" : { \"DistributionConfig\" : { \"Comment\" : \"CDN for S3-backed website\", \"Aliases\" : [{ \"Fn::Join\" : [ \"\", [{\"Ref\" : \"AWS::StackName\"}, {\"Ref\" : \"AWS::AccountId\"}, \".\", {\"Ref\" : \"AWS::Region\"}, \".\", { \"Ref\" : \"HostedZone\" ", "keywords": ["bill"]}]}, {"Id": "213917823", "PostHistoryTypeId": "1", "PostId": "59972222", "RevisionGUID": "a79ebe72-a78d-4f34-82ba-d6f13a4980b8", "CreationDate": "2020-01-29T17:08:19.847", "UserId": "3200355", "Text": "AWS Sample Template: S3_Website_With_CloudFront_Distribution.template Fails Upon Start do to Route 53 Domain Name", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "AWS Sample Template: S3_Website_With_CloudFront_Distribution.template Fails Upon Start do to Route 53 Domain Name", "keywords": ["domain"]}]}, {"Id": "213917824", "PostHistoryTypeId": "3", "PostId": "59972222", "RevisionGUID": "a79ebe72-a78d-4f34-82ba-d6f13a4980b8", "CreationDate": "2020-01-29T17:08:19.847", "UserId": "3200355", "Text": "|amazon-web-services|amazon-s3|aws-cloudformation|amazon-cloudfront|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "59976463", "PostTypeId": "2", "ParentId": "59972222", "CreationDate": "2020-01-29T22:20:11.357", "Score": "0", "Body": "<p>It is because you should have an SSL certificate for the alternate domain that you are trying to add. You can request an <code>ACM</code> public certificate in <code>us-east-1</code> region. </p>\n\n<p>I suggest you set up the ACM certificate outside the cloudformation, because creating an ACM certificate requires manual DNS/Email verification.</p>\n\n<p>Hope this helps.</p>\n\n<p>Reference:</p>\n\n<p><a href=\"https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-invalid-viewer-certificate/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-invalid-viewer-certificate/</a></p>\n", "OwnerUserId": "1448679", "LastActivityDate": "2020-01-29T22:20:11.357", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "106071217", "PostId": "59976463", "Score": "1", "Text": "Yes, I believe that is correct as well.  I did create a public certificate via the ACM for the Host Zone in question.  Finally broke down and submitted a ticket with AWS Support, and they were able to duplicate the issue with my cert & zone information.  Waiting to post the their findings.", "CreationDate": "2020-01-30T01:16:39.730", "UserId": "3200355", "filtered-sentences": []}], "history": [{"Id": "213935272", "PostHistoryTypeId": "2", "PostId": "59976463", "RevisionGUID": "a634c6c3-9e78-489f-a349-10719a9af9a0", "CreationDate": "2020-01-29T22:20:11.357", "UserId": "1448679", "Text": "It is because you should have an SSL certificate for the alternate domain that you are trying to add. You can request an `ACM` public certificate in `us-east-1` region. \r\n\r\nI suggest you set up the ACM certificate outside the cloudformation, because creating an ACM certificate requires manual DNS/Email verification.\r\n\r\nHope this helps.\r\n\r\nReference:\r\n\r\nhttps://aws.amazon.com/premiumsupport/knowledge-center/cloudfront-invalid-viewer-certificate/", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "It is because you should have an SSL certificate for the alternate domain that you are trying to add. ", "keywords": ["domain"]}]}], "filtered-sentences": [{"source": "Body", "text": "It is because you should have an SSL certificate for the alternate domain that you are trying to add. ", "keywords": ["domain"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "AWS Sample Template: S3_Website_With_CloudFront_Distribution.template Fails Upon Start do to Route 53 Domain Name", "keywords": ["domain"]}, {"source": "Body", "text": "However, I am getting, however, the following error: To add an alternate domain name (CNAME) to a CloudFront distribution, you must attach a trusted certificate that validates your authorization to use the domain name. ", "keywords": ["domain"]}, {"source": "Body", "text": "For more details, see: https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements (Service: AmazonCloudFront; Status Code: 400; Error Code: InvalidViewerCertificate; Request ID: ---------)", "keywords": ["domain"]}]}