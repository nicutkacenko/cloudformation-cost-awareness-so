{"Id": "66959517", "PostTypeId": "1", "CreationDate": "2021-04-05T20:40:31.113", "Score": "0", "ViewCount": "459", "Body": "<p>We are migrating REST API service from EC2 to Lambda/API Gateway (to lower billing) using the AWS - SAM feature. This service is consumed only by internal application(INTRANET). We don't have VPN connectivity between on-premise and AWS. Each function is housed in a separate folder which includes a YAML file template. When deployed using the same stack name it deletes the previous function. We tried to use,</p>\n<blockquote>\n<p>DeletionPolicy: Retain</p>\n</blockquote>\n<p>which errored out ,</p>\n<blockquote>\n<p>'property DeletionPolicy not defined for resource of type\nAWS::Serverless::Function'</p>\n</blockquote>\n<p>Our requirement is, to have a common base URL without using R53 (if possible).</p>\n<p>Is there a better way to do this?</p>\n", "OwnerUserId": "578434", "LastActivityDate": "2023-01-04T09:11:48.770", "Title": "AWS SAM/CloudFormation Template Lambda Delete Protection", "Tags": "|amazon-web-services|aws-cloudformation|aws-api-gateway|aws-sam|", "AnswerCount": "2", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "244072023", "PostHistoryTypeId": "2", "PostId": "66959517", "RevisionGUID": "bff29690-79ae-4951-970a-ea690d6da78b", "CreationDate": "2021-04-05T20:40:31.113", "UserId": "578434", "Text": "We are migrating REST API service from EC2 to Lambda/API Gateway (to lower billing) using the AWS - SAM feature. This service is consumed only by internal application(INTRANET). We don't have VPN connectivity between on-premise and AWS. Each function is housed in a separate folder which includes a YAML file template. When deployed using the same stack name it deletes the previous function. We tried to use,\r\n\r\n> DeletionPolicy: Retain\r\n\r\nwhich errored out ,\r\n\r\n> 'property DeletionPolicy not defined for resource of type\r\n> AWS::Serverless::Function'\r\n\r\nOur requirement is, to have a common base URL without using R53 (if possible).\r\n\r\nIs there a better way to do this?\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "We are migrating REST API service from EC2 to Lambda/API Gateway (to lower billing) using the AWS - SAM feature. ", "keywords": ["bill", "feature"]}, {"source": "Text", "text": "We don't have VPN connectivity between on-premise and AWS. ", "keywords": ["vpn"]}]}, {"Id": "244072024", "PostHistoryTypeId": "1", "PostId": "66959517", "RevisionGUID": "bff29690-79ae-4951-970a-ea690d6da78b", "CreationDate": "2021-04-05T20:40:31.113", "UserId": "578434", "Text": "AWS SAM/CloudFormation Template Lambda Delete Protection", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "244072025", "PostHistoryTypeId": "3", "PostId": "66959517", "RevisionGUID": "bff29690-79ae-4951-970a-ea690d6da78b", "CreationDate": "2021-04-05T20:40:31.113", "UserId": "578434", "Text": "|amazon-web-services|aws-cloudformation|aws-api-gateway|aws-sam|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "75003217", "PostTypeId": "2", "ParentId": "66959517", "CreationDate": "2023-01-04T09:11:48.770", "Score": "0", "Body": "<p>I believe you don't need to retain the old lambda, it's fine to delete the old as you deploy new changes.</p>\n<p>What needed is to tied the Lambda with API gateway.\nIn other words, your cloudformation template should have Lambda resources and for API Gateway point to the like</p>\n<pre><code>Uri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${LambdaFunction.Arn}/invocations'\n</code></pre>\n<p>within <code>AWS::ApiGateway::Method</code> resources</p>\n<p>I quoted my code block from <a href=\"https://github.com/aws-samples/aws-lambda-url-apigateway-cfn/blob/main/src/template_lambda_APIG.yaml#L195-L197\" rel=\"nofollow noreferrer\">AWS Samples on github</a></p>\n<p>In case you have different cloud formation templates you might consider to Output section in cloudformation templates to export resources</p>\n", "OwnerUserId": "7931847", "LastActivityDate": "2023-01-04T09:11:48.770", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "285474173", "PostHistoryTypeId": "2", "PostId": "75003217", "RevisionGUID": "31737dc1-5e84-4d76-a684-d37922072ecd", "CreationDate": "2023-01-04T09:11:48.770", "UserId": "7931847", "Text": "I believe you don't need to retain the old lambda, it's fine to delete the old as you deploy new changes. \r\n\r\nWhat needed is to tied the Lambda with API gateway. \r\nIn other words, your cloudformation template should have Lambda resources and for API Gateway point to the like \r\n```\r\nUri: !Sub 'arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${LambdaFunction.Arn}/invocations'\r\n```  \r\nwithin `AWS::ApiGateway::Method` resources\r\n\r\nI quoted my code block from [AWS Samples on github](https://github.com/aws-samples/aws-lambda-url-apigateway-cfn/blob/main/src/template_lambda_APIG.yaml#L195-L197)\r\n\r\nIn case you have different cloud formation templates you might consider to Output section in cloudformation templates to export resources ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I believe you don't need to retain the old lambda, it's fine to delete the old as you deploy new changes. ", "keywords": ["change"]}]}], "filtered-sentences": [{"source": "Body", "text": "I believe you don't need to retain the old lambda, it's fine to delete the old as you deploy new changes. ", "keywords": ["change"]}]}, {"Id": "66959601", "PostTypeId": "2", "ParentId": "66959517", "CreationDate": "2021-04-05T20:47:56.740", "Score": "0", "Body": "<p><a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-product-attribute-reference.html\" rel=\"nofollow noreferrer\">CloudFormation attributes</a>, such as <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-deletionpolicy.html\" rel=\"nofollow noreferrer\"><code>DeletionPolicy</code></a>, are not defined inside the <code>Properties</code> section. You may need to un-indent <a href=\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-deletionpolicy.html\" rel=\"nofollow noreferrer\"><code>DeletionPolicy</code></a> so it is not defined within the <code>Properties</code> section</p>\n", "OwnerUserId": "4122849", "LastActivityDate": "2021-04-05T20:47:56.740", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "118359918", "PostId": "66959601", "Score": "0", "Text": "It is failing and rollingback. And I tried to remove the attribute and it  failed. I have to delete the stack and re-run without the attribute. :(", "CreationDate": "2021-04-05T21:03:46.943", "UserId": "578434", "filtered-sentences": []}], "history": [{"Id": "244072368", "PostHistoryTypeId": "2", "PostId": "66959601", "RevisionGUID": "3a2597fd-35df-4b78-8a4d-e2e63da3b697", "CreationDate": "2021-04-05T20:47:56.740", "UserId": "4122849", "Text": "[CloudFormation attributes](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-product-attribute-reference.html), such as [`DeletionPolicy`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-deletionpolicy.html), are not defined inside the `Properties` section. You may need to un-indent [`DeletionPolicy`](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-deletionpolicy.html) so it is not defined within the `Properties` section", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": true, "filtered-sentences": [{"source": "Body", "text": "We are migrating REST API service from EC2 to Lambda/API Gateway (to lower billing) using the AWS - SAM feature. ", "keywords": ["bill", "feature"]}, {"source": "Body", "text": "We don't have VPN connectivity between on-premise and AWS. ", "keywords": ["vpn"]}]}