{"Id": "56014709", "PostTypeId": "1", "CreationDate": "2019-05-07T02:25:41.507", "Score": "1", "ViewCount": "491", "Body": "<p>I am following <a href=\"https://aws.amazon.com/blogs/big-data/query-and-visualize-aws-cost-and-usage-data-using-amazon-athena-and-amazon-quicksight/\" rel=\"nofollow noreferrer\">this link</a> to set up my cost and usage report to athena. </p>\n\n<p>at the moment i successfully launched the stack and added the lambda trigger.</p>\n\n<p>Based on the guide, at this point, in the Lambda console, i should have this 5 functions created. \n<em>aws-cost-n-usage-S3-lambda-fn-B\naws-cost-n-usage-main-lambda-fn-A\naws-cost-n-usage-S3-lambda-fn-B-2\naws-cost-n-usage-Athena-lambda-fn-C\naws-cost-n-usage-Athena-lambda-fn-C-2</em></p>\n\n<p>but i am missing fn-c and fn-c-2</p>\n\n<p>upon checking my Athena console, i am also facing some problems where i cannot create any table,</p>\n\n<p>Athena SQL Query:</p>\n\n<pre><code>CREATE TABLE aws_billing_report.parquet_my_cur_report_pass_3_month_view_03\nWITH (external_location = 's3://athena-cau-ndjson/parq_sum/view-mon-03-yr-2019/',\n    format = 'Parquet',\n    parquet_compression = 'SNAPPY')\nAS SELECT bill_billingperiodstartdate, bill_billingperiodenddate, lineItem_UsageStartDate, lineItem_UsageEndDate, identity_LineItemId, identity_TimeInterval, bill_InvoiceId, bill_BillingEntity, bill_BillType, bill_PayerAccountId, lineItem_UsageAccountId, lineItem_ProductCode, lineItem_UsageType, lineItem_Operation, lineItem_AvailabilityZone, lineitem_usageamount, lineItem_NormalizationFactor, lineItem_NormalizedUsageAmount, lineItem_CurrencyCode, lineitem_unblendedrate, lineitem_blendedrate, lineitem_unblendedcost, lineItem_blendedCost, lineItem_TaxType, lineitem_resourceid, product_ProductName, product_instanceFamily, product_instanceType, product_productFamily, product_storage, product_storageClass, product_usagetype, product_volumeType, product_region, product_fromlocation, pricing_term, reservation_upfrontvalue, reservation_unusedquantity, reservation_effectivecost, month, year\nFROM aws_billing_report.parquet_my_cur_report_year_2019_month_03\n</code></pre>\n\n<p>with error output similar to this: </p>\n\n<pre><code>Your query has the following error(s):\nSYNTAX_ERROR: line 49:3: Schema aws_billing_report does not exist. You may need to manually clean the data at location 's3://athena-cau-ndjson/aws-athena-query-results/tables/e9fe05e0----------------------' before retrying. Athena will not delete data in your account.\nThis query ran against the \"default\" database, unless qualified by the query. Please post the error message on our forum or contact customer support with Query Id: e9fe05e0-0631-49bb-86a7-1bffbfd7b0c9.\n</code></pre>\n\n<p>tried cleaning the folder as suggested in the error. but its not working.</p>\n\n<p>any other suggestions?</p>\n", "OwnerUserId": "10603846", "LastEditorUserId": "10603846", "LastEditDate": "2019-05-07T05:26:18.817", "LastActivityDate": "2019-05-07T05:26:18.817", "Title": "Setting up Amazon Athena and QuickSight for Cost and Usage Report error", "Tags": "|amazon-web-services|amazon-s3|aws-cloudformation|amazon-athena|amazon-quicksight|", "AnswerCount": "0", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "98689573", "PostId": "56014709", "Score": "0", "Text": "Can you confirm if aws_billing_report database is created/present already before running the create table statement?", "CreationDate": "2019-05-07T12:46:07.647", "UserId": "4326922", "filtered-sentences": []}, {"Id": "98708092", "PostId": "56014709", "Score": "0", "Text": "@bdcloud when i checked my Athena history, all `drop if exist` commands were successful, but `create` command will fail all the time.", "CreationDate": "2019-05-08T01:52:43.920", "UserId": "10603846", "filtered-sentences": []}, {"Id": "98708140", "PostId": "56014709", "Score": "0", "Text": "@bdcloud ive used the cloudformation stack provided in the link. so if i understand it correctly, the stack should also create the table for me?", "CreationDate": "2019-05-08T01:55:55.973", "UserId": "10603846", "filtered-sentences": []}], "history": [{"Id": "197218351", "PostHistoryTypeId": "2", "PostId": "56014709", "RevisionGUID": "cb9bb6b4-f9aa-48b5-a4af-eb5ae4bba75f", "CreationDate": "2019-05-07T02:25:41.507", "UserId": "10603846", "Text": "I am following [this link][1] to set up my cost and usage report to athena. \r\n\r\nat the moment i successfully launched the stack and added the lambda trigger.\r\n\r\nBased on the guide, at this point, in the Lambda console, i should have this 5 functions created. \r\n*aws-cost-n-usage-S3-lambda-fn-B\r\naws-cost-n-usage-main-lambda-fn-A\r\naws-cost-n-usage-S3-lambda-fn-B-2\r\naws-cost-n-usage-Athena-lambda-fn-C\r\naws-cost-n-usage-Athena-lambda-fn-C-2*\r\n\r\nbut i am missing fn-c and fn-c-2\r\n\r\nupon checking my Athena console, i am also facing some problems where i cannot create any table,\r\nwith error similar to this: \r\n*Your query has the following error(s):\r\nSYNTAX_ERROR: line 49:3: Schema aws_billing_report does not exist. You may need to manually clean the data at location 's3://aws-athena-query-results-051888502658-us-east-2/Unsaved/2019/05/06/tables/----------------------' before retrying. Athena will not delete data in your account.\r\nThis query ran against the \"default\" database, unless qualified by the query. Please post the error message on our forum or contact customer support with Query Id: 461e4c5c-a0de-4cfe-ba64-747c9df2698f.*\r\n\r\ntried cleaning the folder as suggested in the error. but its not working.\r\n\r\nany other suggestions?\r\n\r\n\r\n  [1]: https://aws.amazon.com/blogs/big-data/query-and-visualize-aws-cost-and-usage-data-using-amazon-athena-and-amazon-quicksight/", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I am following [this link][1] to set up my cost and usage report to athena. ", "keywords": ["cost"]}, {"source": "Text", "text": "*aws-cost-n-usage-S3-lambda-fn-B aws-cost-n-usage-main-lambda-fn-A aws-cost-n-usage-S3-lambda-fn-B-2 aws-cost-n-usage-Athena-lambda-fn-C aws-cost-n-usage-Athena-lambda-fn-C-2* but i am missing fn-c and fn-c-2 upon checking my Athena console, i am also facing some problems where i cannot create any table, with error similar to this: *Your query has the following error(s): SYNTAX_ERROR: line 49:3: Schema aws_billing_report does not exist. ", "keywords": ["cost"]}, {"source": "Text", "text": "[1]: https://aws.amazon.com/blogs/big-data/query-and-visualize-aws-cost-and-usage-data-using-amazon-athena-and-amazon-quicksight/", "keywords": ["cost"]}]}, {"Id": "197218352", "PostHistoryTypeId": "1", "PostId": "56014709", "RevisionGUID": "cb9bb6b4-f9aa-48b5-a4af-eb5ae4bba75f", "CreationDate": "2019-05-07T02:25:41.507", "UserId": "10603846", "Text": "Setting up Amazon Athena and QuickSight for Cost and Usage Report error", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "Setting up Amazon Athena and QuickSight for Cost and Usage Report error", "keywords": ["cost"]}]}, {"Id": "197218353", "PostHistoryTypeId": "3", "PostId": "56014709", "RevisionGUID": "cb9bb6b4-f9aa-48b5-a4af-eb5ae4bba75f", "CreationDate": "2019-05-07T02:25:41.507", "UserId": "10603846", "Text": "|amazon-web-services|amazon-s3|aws-cloudformation|amazon-athena|amazon-quicksight|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "197223958", "PostHistoryTypeId": "5", "PostId": "56014709", "RevisionGUID": "e0f4b50d-7fd5-4a26-ae34-884c87976082", "CreationDate": "2019-05-07T05:26:18.817", "UserId": "10603846", "Comment": "added 1239 characters in body", "Text": "I am following [this link][1] to set up my cost and usage report to athena. \r\n\r\nat the moment i successfully launched the stack and added the lambda trigger.\r\n\r\nBased on the guide, at this point, in the Lambda console, i should have this 5 functions created. \r\n*aws-cost-n-usage-S3-lambda-fn-B\r\naws-cost-n-usage-main-lambda-fn-A\r\naws-cost-n-usage-S3-lambda-fn-B-2\r\naws-cost-n-usage-Athena-lambda-fn-C\r\naws-cost-n-usage-Athena-lambda-fn-C-2*\r\n\r\nbut i am missing fn-c and fn-c-2\r\n\r\nupon checking my Athena console, i am also facing some problems where i cannot create any table,\r\n\r\nAthena SQL Query:\r\n    \r\n    CREATE TABLE aws_billing_report.parquet_my_cur_report_pass_3_month_view_03\r\n    WITH (external_location = 's3://athena-cau-ndjson/parq_sum/view-mon-03-yr-2019/',\r\n        format = 'Parquet',\r\n        parquet_compression = 'SNAPPY')\r\n    AS SELECT bill_billingperiodstartdate, bill_billingperiodenddate, lineItem_UsageStartDate, lineItem_UsageEndDate, identity_LineItemId, identity_TimeInterval, bill_InvoiceId, bill_BillingEntity, bill_BillType, bill_PayerAccountId, lineItem_UsageAccountId, lineItem_ProductCode, lineItem_UsageType, lineItem_Operation, lineItem_AvailabilityZone, lineitem_usageamount, lineItem_NormalizationFactor, lineItem_NormalizedUsageAmount, lineItem_CurrencyCode, lineitem_unblendedrate, lineitem_blendedrate, lineitem_unblendedcost, lineItem_blendedCost, lineItem_TaxType, lineitem_resourceid, product_ProductName, product_instanceFamily, product_instanceType, product_productFamily, product_storage, product_storageClass, product_usagetype, product_volumeType, product_region, product_fromlocation, pricing_term, reservation_upfrontvalue, reservation_unusedquantity, reservation_effectivecost, month, year\r\n    FROM aws_billing_report.parquet_my_cur_report_year_2019_month_03\r\n\r\nwith error output similar to this: \r\n\r\n    Your query has the following error(s):\r\n    SYNTAX_ERROR: line 49:3: Schema aws_billing_report does not exist. You may need to manually clean the data at location 's3://athena-cau-ndjson/aws-athena-query-results/tables/e9fe05e0----------------------' before retrying. Athena will not delete data in your account.\r\n    This query ran against the \"default\" database, unless qualified by the query. Please post the error message on our forum or contact customer support with Query Id: e9fe05e0-0631-49bb-86a7-1bffbfd7b0c9.\r\n\r\ntried cleaning the folder as suggested in the error. but its not working.\r\n\r\nany other suggestions?\r\n\r\n\r\n  [1]: https://aws.amazon.com/blogs/big-data/query-and-visualize-aws-cost-and-usage-data-using-amazon-athena-and-amazon-quicksight/", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I am following [this link][1] to set up my cost and usage report to athena. ", "keywords": ["cost"]}, {"source": "Text", "text": "*aws-cost-n-usage-S3-lambda-fn-B aws-cost-n-usage-main-lambda-fn-A aws-cost-n-usage-S3-lambda-fn-B-2 aws-cost-n-usage-Athena-lambda-fn-C aws-cost-n-usage-Athena-lambda-fn-C-2* but i am missing fn-c and fn-c-2 upon checking my Athena console, i am also facing some problems where i cannot create any table, Athena SQL Query: CREATE TABLE aws_billing_report.parquet_my_cur_report_pass_3_month_view_03 WITH (external_location = 's3://athena-cau-ndjson/parq_sum/view-mon-03-yr-2019/', format = 'Parquet', parquet_compression = 'SNAPPY') AS SELECT bill_billingperiodstartdate, bill_billingperiodenddate, lineItem_UsageStartDate, lineItem_UsageEndDate, identity_LineItemId, identity_TimeInterval, bill_InvoiceId, bill_BillingEntity, bill_BillType, bill_PayerAccountId, lineItem_UsageAccountId, lineItem_ProductCode, lineItem_UsageType, lineItem_Operation, lineItem_AvailabilityZone, lineitem_usageamount, lineItem_NormalizationFactor, lineItem_NormalizedUsageAmount, lineItem_CurrencyCode, lineitem_unblendedrate, lineitem_blendedrate, lineitem_unblendedcost, lineItem_blendedCost, lineItem_TaxType, lineitem_resourceid, product_ProductName, product_instanceFamily, product_instanceType, product_productFamily, product_storage, product_storageClass, product_usagetype, product_volumeType, product_region, product_fromlocation, pricing_term, reservation_upfrontvalue, reservation_unusedquantity, reservation_effectivecost, month, year FROM aws_billing_report.parquet_my_cur_report_year_2019_month_03 with error output similar to this: Your query has the following error(s): SYNTAX_ERROR: line 49:3: Schema aws_billing_report does not exist. ", "keywords": ["bill", "cost"]}, {"source": "Text", "text": "Please post the error message on our forum or contact customer support with Query Id: e9fe05e0-0631-49bb-86a7-1bffbfd7b0c9. tried cleaning the folder as suggested in the error. but its not working. any other suggestions? [1]: https://aws.amazon.com/blogs/big-data/query-and-visualize-aws-cost-and-usage-data-using-amazon-athena-and-amazon-quicksight/", "keywords": ["cost"]}]}], "contains-topic": false, "filtered-sentences": [{"source": "Title", "text": "Setting up Amazon Athena and QuickSight for Cost and Usage Report error", "keywords": ["cost"]}, {"source": "Body", "text": "I am following this link to set up my cost and usage report to athena. ", "keywords": ["cost"]}, {"source": "Body", "text": "Based on the guide, at this point, in the Lambda console, i should have this 5 functions created. aws-cost-n-usage-S3-lambda-fn-B aws-cost-n-usage-main-lambda-fn-A aws-cost-n-usage-S3-lambda-fn-B-2 aws-cost-n-usage-Athena-lambda-fn-C aws-cost-n-usage-Athena-lambda-fn-C-2 but i am missing fn-c and fn-c-2 upon checking my Athena console, i am also facing some problems where i cannot create any table, Athena SQL Query: with error output similar to this: tried cleaning the folder as suggested in the error. but its not working. any other suggestions?", "keywords": ["cost"]}]}