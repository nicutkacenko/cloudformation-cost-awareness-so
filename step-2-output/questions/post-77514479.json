{"Id": "77514479", "PostTypeId": "1", "CreationDate": "2023-11-20T08:45:58.993", "Score": "0", "ViewCount": "101", "Body": "<p>I am new in AWS with CDK and trying to reduce cost in NAT-Gateway and ALB.\nI have a stack for every client within NAT-Gateway, ALB, EC2, EFS and so on. If I have 3 clients I will end with 3 NAT-Gateways, 3 ALBs, ...\nThe questions is; How can I share the Nat-Gateway and ALB with all my clients to reduce cost? Is it possible? Can I have one VPC-public with NAT-Gateway, ALB and one VPC-private for every client? Does it make sense? Thank you.</p>\n<p>I am trying: One VPC for all my stacks. VPC-public with NAT-Gateway and ALB. VPC-private for every client.</p>\n", "OwnerUserId": "9629508", "LastActivityDate": "2023-11-20T11:16:39.167", "Title": "AWS CDK: Reuse NAT-Gateway and App Load Balancer (ALB) to reduce cost", "Tags": "|python-3.x|amazon-web-services|aws-cloudformation|aws-cdk|aws-nat-gateway|", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "300363848", "PostHistoryTypeId": "2", "PostId": "77514479", "RevisionGUID": "213077f3-ec73-436b-b8f0-ce334cc38287", "CreationDate": "2023-11-20T08:45:58.993", "UserId": "9629508", "Text": "I am new in AWS with CDK and trying to reduce cost in NAT-Gateway and ALB.\r\nI have a stack for every client within NAT-Gateway, ALB, EC2, EFS and so on. If I have 3 clients I will end with 3 NAT-Gateways, 3 ALBs, ... \r\nThe questions is; How can I share the Nat-Gateway and ALB with all my clients to reduce cost? Is it possible? Can I have one VPC-public with NAT-Gateway, ALB and one VPC-private for every client? Does it make sense? Thank you.\r\n\r\nI am trying: One VPC for all my stacks. VPC-public with NAT-Gateway and ALB. VPC-private for every client.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I am new in AWS with CDK and trying to reduce cost in NAT-Gateway and ALB. ", "keywords": ["cost", "nat"]}, {"source": "Text", "text": "I have a stack for every client within NAT-Gateway, ALB, EC2, EFS and so on. ", "keywords": ["nat"]}, {"source": "Text", "text": "If I have 3 clients I will end with 3 NAT-Gateways, 3 ALBs, ... ", "keywords": ["nat"]}, {"source": "Text", "text": "The questions is; How can I share the Nat-Gateway and ALB with all my clients to reduce cost? ", "keywords": ["cost", "nat"]}, {"source": "Text", "text": "Can I have one VPC-public with NAT-Gateway, ALB and one VPC-private for every client? ", "keywords": ["nat"]}, {"source": "Text", "text": "VPC-public with NAT-Gateway and ALB. VPC-private for every client.", "keywords": ["nat"]}]}, {"Id": "300363850", "PostHistoryTypeId": "1", "PostId": "77514479", "RevisionGUID": "213077f3-ec73-436b-b8f0-ce334cc38287", "CreationDate": "2023-11-20T08:45:58.993", "UserId": "9629508", "Text": "AWS CDK: Reuse NAT-Gateway and App Load Balancer (ALB) to reduce cost", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "AWS CDK: Reuse NAT-Gateway and App Load Balancer (ALB) to reduce cost", "keywords": ["cost", "nat"]}]}, {"Id": "300363851", "PostHistoryTypeId": "3", "PostId": "77514479", "RevisionGUID": "213077f3-ec73-436b-b8f0-ce334cc38287", "CreationDate": "2023-11-20T08:45:58.993", "UserId": "9629508", "Text": "|python-3.x|amazon-web-services|aws-cloudformation|aws-cdk|aws-nat-gateway|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "|python-3.x|amazon-web-services|aws-cloudformation|aws-cdk|aws-nat-gateway|", "keywords": ["nat"]}]}, {"Id": "300363852", "PostHistoryTypeId": "66", "PostId": "77514479", "RevisionGUID": "213077f3-ec73-436b-b8f0-ce334cc38287", "CreationDate": "2023-11-20T08:45:58.993", "UserId": "9629508", "filtered-sentences": []}], "answers": [{"Id": "77515451", "PostTypeId": "2", "ParentId": "77514479", "CreationDate": "2023-11-20T11:16:39.167", "Score": "0", "Body": "<p>You could choose to only use one NAT Gateway per VPC. All private subnets can route traffic through that NAT Gateway. However, it is not redundant in that the Availability Zone running the NAT Gateway could fail and the private instances would not be able to reach the Internet. Thus, some people choose to have one NAT Gateway per AZ they are using.</p>\n<p>Your ultimate best design would be to have a 'multi-tenant' application where all of your clients use the same application on the same EC2 instance(s). However, you appear to need separate EC2 instances for each of your clients, which makes things more expensive.</p>\n<p>You can certainly re-use the Application Load Balancer if everything is running in the one VPC. You can configure a slightly different path so that the Load Balancer knows to send the traffic to specific EC2 instances based on the client indicated in the path in the URL.</p>\n<p>So, the simplest design is:</p>\n<ul>\n<li>One VPC</li>\n<li>One NAT Gateway (more if you need high-availability)</li>\n<li>One Load Balancer</li>\n<li>EC2 instances in private subnets</li>\n</ul>\n<p>If you are dividing resources between VPCs, then it is much harder to share resources. You'd need to use VPC Peering or Transit Gateways that are more complex.</p>\n", "OwnerUserId": "174777", "LastActivityDate": "2023-11-20T11:16:39.167", "CommentCount": "1", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "136656277", "PostId": "77515451", "Score": "0", "Text": "Thanks a lot for your help. I will be working in this implementation.\nAny cdk repo or doc where I can go deeper? Thanks!", "CreationDate": "2023-11-20T12:36:31.307", "UserId": "9629508", "filtered-sentences": []}], "history": [{"Id": "300369499", "PostHistoryTypeId": "2", "PostId": "77515451", "RevisionGUID": "19e9dd7b-7832-4acb-8031-470bbfb1c3e1", "CreationDate": "2023-11-20T11:16:39.167", "UserId": "174777", "Text": "You could choose to only use one NAT Gateway per VPC. All private subnets can route traffic through that NAT Gateway. However, it is not redundant in that the Availability Zone running the NAT Gateway could fail and the private instances would not be able to reach the Internet. Thus, some people choose to have one NAT Gateway per AZ they are using.\r\n\r\nYour ultimate best design would be to have a 'multi-tenant' application where all of your clients use the same application on the same EC2 instance(s). However, you appear to need separate EC2 instances for each of your clients, which makes things more expensive.\r\n\r\nYou can certainly re-use the Application Load Balancer if everything is running in the one VPC. You can configure a slightly different path so that the Load Balancer knows to send the traffic to specific EC2 instances based on the client indicated in the path in the URL.\r\n\r\nSo, the simplest design is:\r\n- One VPC\r\n- One NAT Gateway (more if you need high-availability)\r\n- One Load Balancer\r\n- EC2 instances in private subnets\r\n\r\nIf you are dividing resources between VPCs, then it is much harder to share resources. You'd need to use VPC Peering or Transit Gateways that are more complex.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "You could choose to only use one NAT Gateway per VPC. ", "keywords": ["nat"]}, {"source": "Text", "text": "All private subnets can route traffic through that NAT Gateway. ", "keywords": ["nat"]}, {"source": "Text", "text": "However, it is not redundant in that the Availability Zone running the NAT Gateway could fail and the private instances would not be able to reach the Internet. ", "keywords": ["nat"]}, {"source": "Text", "text": "Thus, some people choose to have one NAT Gateway per AZ they are using. ", "keywords": ["nat"]}, {"source": "Text", "text": "Your ultimate best design would be to have a 'multi-tenant' application where all of your clients use the same application on the same EC2 instance(s). ", "keywords": ["instance"]}, {"source": "Text", "text": "However, you appear to need separate EC2 instances for each of your clients, which makes things more expensive. ", "keywords": ["expense"]}, {"source": "Text", "text": "So, the simplest design is: - One VPC - One NAT Gateway (more if you need high-availability) - One Load Balancer - EC2 instances in private subnets ", "keywords": ["nat"]}]}, {"Id": "300369501", "PostHistoryTypeId": "33", "PostId": "77515451", "RevisionGUID": "a28f243d-4080-4bd3-8c16-fb7e1188a48f", "CreationDate": "2023-11-20T11:16:39.167", "UserId": "-1011", "Comment": "350491", "filtered-sentences": []}], "filtered-sentences": [{"source": "Body", "text": "You could choose to only use one NAT Gateway per VPC. ", "keywords": ["nat"]}, {"source": "Body", "text": "All private subnets can route traffic through that NAT Gateway. ", "keywords": ["nat"]}, {"source": "Body", "text": "However, it is not redundant in that the Availability Zone running the NAT Gateway could fail and the private instances would not be able to reach the Internet. ", "keywords": ["nat"]}, {"source": "Body", "text": "Thus, some people choose to have one NAT Gateway per AZ they are using. ", "keywords": ["nat"]}, {"source": "Body", "text": "Your ultimate best design would be to have a 'multi-tenant' application where all of your clients use the same application on the same EC2 instance(s). ", "keywords": ["instance"]}, {"source": "Body", "text": "However, you appear to need separate EC2 instances for each of your clients, which makes things more expensive. ", "keywords": ["expense"]}, {"source": "Body", "text": "So, the simplest design is: One VPC One NAT Gateway (more if you need high-availability) One Load Balancer EC2 instances in private subnets ", "keywords": ["nat"]}]}], "contains-topic": true, "filtered-sentences": [{"source": "Title", "text": "AWS CDK: Reuse NAT-Gateway and App Load Balancer (ALB) to reduce cost", "keywords": ["cost", "nat"]}, {"source": "Body", "text": "I am new in AWS with CDK and trying to reduce cost in NAT-Gateway and ALB. ", "keywords": ["cost", "nat"]}, {"source": "Body", "text": "I have a stack for every client within NAT-Gateway, ALB, EC2, EFS and so on. ", "keywords": ["nat"]}, {"source": "Body", "text": "If I have 3 clients I will end with 3 NAT-Gateways, 3 ALBs, ... ", "keywords": ["nat"]}, {"source": "Body", "text": "The questions is; How can I share the Nat-Gateway and ALB with all my clients to reduce cost? ", "keywords": ["cost", "nat"]}, {"source": "Body", "text": "Can I have one VPC-public with NAT-Gateway, ALB and one VPC-private for every client? ", "keywords": ["nat"]}, {"source": "Body", "text": "VPC-public with NAT-Gateway and ALB. VPC-private for every client.", "keywords": ["nat"]}]}