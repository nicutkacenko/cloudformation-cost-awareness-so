{"Id": "72014326", "PostTypeId": "1", "CreationDate": "2022-04-26T12:53:26.137", "Score": "0", "ViewCount": "864", "Body": "<p>This has been such a pain in the backend to waste hours and still unable to get one line of AWS CloudFormation syntax clear.</p>\n<p>If the AWS guys can write their documentation slightly better - just pay a little bit more attention to it - it would make like easier for the developers.</p>\n<p>I am trying to use CloudFormation to deploy API Gateway with VPC Link and NLB. The Goal is to proxy pass all requests to the NLB:</p>\n<pre><code>  ApiProxyMethod: \n    Type: AWS::ApiGateway::Method\n    Properties: \n      RestApiId: !Ref ApiGatewayRestApi\n      ResourceId: !Ref ApiProxyResource\n      # AuthorizationScopes: # https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-method.html#cfn-apigateway-method-authorizationscopes\n      AuthorizationType: COGNITO_USER_POOLS\n      AuthorizerId: !Ref ApiAuthorizer\n      HttpMethod: ANY\n      OperationName: &quot;ProxyAllRequests&quot;\n      Integration: \n        ConnectionType: VPC_LINK\n        ConnectionId: !Ref ApiGatewayVpcLink\n        IntegrationHttpMethod: ANY\n        PassthroughBehavior: String\n        Type: &quot;VPC_LINK&quot; # Member must satisfy enum value set: [HTTP, AWS_PROXY, HTTP_PROXY, AWS] \n        Uri: &quot;http://NLB-myapp-internal-beta-12345.elb.ap-northeast-1.amazonaws.com/{proxy}&quot;\n</code></pre>\n<p>However, this fails and it complains about wrong <code>Type</code> value: <code>Member must satisfy enum value set: [HTTP, AWS_PROXY, HTTP_PROXY, AWS]</code></p>\n<p>Now, which one of them is for VPC_Link / NLB?</p>\n<p>They could have listed these values in the documentation of <code>AWS::ApiGateway::Method Integration</code>, but they choose not to.</p>\n", "OwnerUserId": "3703783", "LastActivityDate": "2022-07-31T15:08:16.767", "Title": "AWS Cloudformation - How to attach vpc link / NLB to method in api gateway?", "Tags": "|amazon-web-services|aws-cloudformation|aws-api-gateway|amazon-vpc|amazon-elb|", "AnswerCount": "1", "CommentCount": "3", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "127247870", "PostId": "72014326", "Score": "1", "Text": "This is from the docs: An HTTP or HTTP proxy integration with a `connectionType` of VPC_LINK is referred to as a private integration and uses a VpcLink to connect API Gateway to a network load balancer of a VPC. And also: For a private HTTP integration, the URI is not used for routing.", "CreationDate": "2022-04-26T13:02:39.297", "UserId": "8343484", "filtered-sentences": []}, {"Id": "127252514", "PostId": "72014326", "Score": "0", "Text": "@MarkoE  Where is this documented? I was so frustrated that I didn't find this.", "CreationDate": "2022-04-26T16:07:43.517", "UserId": "3703783", "filtered-sentences": []}, {"Id": "127256249", "PostId": "72014326", "Score": "0", "Text": "Second one is here: https://docs.aws.amazon.com/apigateway/latest/api/API_PutIntegration.html#apigw-PutIntegration-request-uri. The first one is referred in response syntax: https://docs.aws.amazon.com/apigateway/latest/api/API_PutIntegration.html#apigw-PutIntegration-response-type.", "CreationDate": "2022-04-26T19:11:38.250", "UserId": "8343484", "filtered-sentences": []}], "history": [{"Id": "268927836", "PostHistoryTypeId": "2", "PostId": "72014326", "RevisionGUID": "faae48a9-6bed-488b-9c96-577776c5956b", "CreationDate": "2022-04-26T12:53:26.137", "UserId": "3703783", "Text": "This has been such a pain in the backend to waste hours and still unable to get one line of AWS CloudFormation syntax clear. \r\n\r\nIf the AWS guys can write their documentation slightly better - just pay a little bit more attention to it - it would make like easier for the developers. \r\n\r\nI am trying to use CloudFormation to deploy API Gateway with VPC Link and NLB. The Goal is to proxy pass all requests to the NLB: \r\n\r\n```\r\n  ApiProxyMethod: \r\n    Type: AWS::ApiGateway::Method\r\n    Properties: \r\n      RestApiId: !Ref ApiGatewayRestApi\r\n      ResourceId: !Ref ApiProxyResource\r\n      # AuthorizationScopes: # https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-method.html#cfn-apigateway-method-authorizationscopes\r\n      AuthorizationType: COGNITO_USER_POOLS\r\n      AuthorizerId: !Ref ApiAuthorizer\r\n      HttpMethod: ANY\r\n      OperationName: \"ProxyAllRequests\"\r\n      Integration: \r\n        ConnectionType: VPC_LINK\r\n        ConnectionId: !Ref ApiGatewayVpcLink\r\n        IntegrationHttpMethod: ANY\r\n        PassthroughBehavior: String\r\n        Type: \"VPC_LINK\" # Member must satisfy enum value set: [HTTP, AWS_PROXY, HTTP_PROXY, AWS] \r\n        Uri: \"http://NLB-myapp-internal-beta-12345.elb.ap-northeast-1.amazonaws.com/{proxy}\"\r\n```\r\n\r\nHowever, this fails and it complains about wrong `Type` value: `Member must satisfy enum value set: [HTTP, AWS_PROXY, HTTP_PROXY, AWS]`\r\n\r\nNow, which one of them is for VPC_Link / NLB? \r\n\r\nThey could have listed these values in the documentation of `AWS::ApiGateway::Method Integration`, but they choose not to. \r\n\r\n", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "If the AWS guys can write their documentation slightly better - just pay a little bit more attention to it - it would make like easier for the developers. ", "keywords": ["pay"]}]}, {"Id": "268927838", "PostHistoryTypeId": "1", "PostId": "72014326", "RevisionGUID": "faae48a9-6bed-488b-9c96-577776c5956b", "CreationDate": "2022-04-26T12:53:26.137", "UserId": "3703783", "Text": "AWS Cloudformation - How to attach vpc link / NLB to method in api gateway?", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "268927839", "PostHistoryTypeId": "3", "PostId": "72014326", "RevisionGUID": "faae48a9-6bed-488b-9c96-577776c5956b", "CreationDate": "2022-04-26T12:53:26.137", "UserId": "3703783", "Text": "|amazon-web-services|aws-cloudformation|aws-api-gateway|amazon-vpc|amazon-elb|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "73184418", "PostTypeId": "2", "ParentId": "72014326", "CreationDate": "2022-07-31T15:08:16.767", "Score": "5", "Body": "<p>In order to proxy pass all requests to the NLB, you need to specify the <code>Type</code> field as <code>HTTP_PROXY</code></p>\n<p><a href=\"https://docs.aws.amazon.com/apigateway/latest/api/API_Integration.html#apigw-Type-Integration-connectionType\" rel=\"noreferrer\">Here</a> you can find more useful documentation about integration parameters</p>\n<pre><code>  ApiProxyMethod: \n    Type: AWS::ApiGateway::Method\n    Properties: \n      RestApiId: !Ref ApiGatewayRestApi\n      ResourceId: !Ref ApiProxyResource\n      AuthorizationType: COGNITO_USER_POOLS\n      AuthorizerId: !Ref ApiAuthorizer\n      HttpMethod: ANY\n      OperationName: &quot;ProxyAllRequests&quot;\n      Integration: \n        ConnectionType: VPC_LINK\n        ConnectionId: !Ref ApiGatewayVpcLink\n        IntegrationHttpMethod: ANY\n        PassthroughBehavior: String\n        Type: HTTP_PROXY\n        Uri: &quot;http://NLB-myapp-internal-beta-12345.elb.ap-northeast-1.amazonaws.com/{proxy}&quot;\n</code></pre>\n", "OwnerUserId": "7546386", "LastActivityDate": "2022-07-31T15:08:16.767", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "275316064", "PostHistoryTypeId": "2", "PostId": "73184418", "RevisionGUID": "fadc82f7-8f5f-451c-932f-5aebd0acb4fa", "CreationDate": "2022-07-31T15:08:16.767", "UserId": "7546386", "Text": "In order to proxy pass all requests to the NLB, you need to specify the `Type` field as `HTTP_PROXY`\r\n\r\n[Here][1] you can find more useful documentation about integration parameters\r\n\r\n```\r\n  ApiProxyMethod: \r\n    Type: AWS::ApiGateway::Method\r\n    Properties: \r\n      RestApiId: !Ref ApiGatewayRestApi\r\n      ResourceId: !Ref ApiProxyResource\r\n      AuthorizationType: COGNITO_USER_POOLS\r\n      AuthorizerId: !Ref ApiAuthorizer\r\n      HttpMethod: ANY\r\n      OperationName: \"ProxyAllRequests\"\r\n      Integration: \r\n        ConnectionType: VPC_LINK\r\n        ConnectionId: !Ref ApiGatewayVpcLink\r\n        IntegrationHttpMethod: ANY\r\n        PassthroughBehavior: String\r\n        Type: HTTP_PROXY\r\n        Uri: \"http://NLB-myapp-internal-beta-12345.elb.ap-northeast-1.amazonaws.com/{proxy}\"\r\n```\r\n\r\n\r\n  [1]: https://docs.aws.amazon.com/apigateway/latest/api/API_Integration.html#apigw-Type-Integration-connectionType", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "If the AWS guys can write their documentation slightly better - just pay a little bit more attention to it - it would make like easier for the developers. ", "keywords": ["pay"]}]}