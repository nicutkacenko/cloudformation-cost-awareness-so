{"Id": "69997144", "PostTypeId": "1", "AcceptedAnswerId": "69997191", "CreationDate": "2021-11-16T23:11:58.147", "Score": "2", "ViewCount": "1958", "Body": "<p>For some reason I'm unable to figure out why this is going wrong.</p>\n<p>I've created a public ECR repository and I try to refer the image as <code>ImageUri</code> under the <code>Code</code> block in my AWS::Lambda::Function.</p>\n<pre><code>  SlackNotifierFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: !Join [&quot;-&quot;, [!Ref Name, &quot;slack&quot;, &quot;notifier&quot;]]\n      Role: !GetAtt LambdaRole.Arn\n      Code:\n        ImageUri: public.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier:latest\n      Timeout: 1\n      MemorySize: 128\n      PackageType: Image\n      Architectures: [&quot;arm64&quot;]\n      Environment:\n        Variables:\n          LOG_LEVEL: INFO\n          SLACK_TOKEN: !Ref SlackToken\n          SLACK_CHANNEL: !Ref SlackChannel\n</code></pre>\n<p>CloudFormation throws the following error whilst creating the Lambda function.</p>\n<blockquote>\n<p>Resource handler returned message: &quot;Source image\npublic.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier:latest\nis not valid. Provide a valid source image. (Service: Lambda, Status\nCode: 400, Request ID: 9150921d-4b35-44ae-a4eb-c137f2a779e9, Extended\nRequest ID: null)&quot; (RequestToken:\n616bb226-a46b-faf1-c959-aad09880b137, HandlerErrorCode:\nInvalidRequest)</p>\n</blockquote>\n<p>Here's the ECR public gallery link: <a href=\"https://gallery.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier\" rel=\"nofollow noreferrer\">https://gallery.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier</a></p>\n", "OwnerUserId": "13155217", "LastActivityDate": "2021-11-16T23:17:37.153", "Title": "Specify ImageUri in AWS::Lambda::Function throws CF error", "Tags": "|amazon-web-services|aws-lambda|aws-cloudformation|", "AnswerCount": "1", "CommentCount": "0", "ContentLicense": "CC BY-SA 4.0", "history": [{"Id": "258135570", "PostHistoryTypeId": "2", "PostId": "69997144", "RevisionGUID": "a28987e0-38a0-480d-9e6a-f5be72163f15", "CreationDate": "2021-11-16T23:11:58.147", "UserId": "13155217", "Text": "For some reason I'm unable to figure out why this is going wrong.\r\n\r\nI've created a public ECR repository and I try to refer the image as `ImageUri` under the `Code` block in my AWS::Lambda::Function.\r\n\r\n      SlackNotifierFunction:\r\n        Type: AWS::Lambda::Function\r\n        Properties:\r\n          FunctionName: !Join [\"-\", [!Ref Name, \"slack\", \"notifier\"]]\r\n          Role: !GetAtt LambdaRole.Arn\r\n          Code:\r\n            ImageUri: public.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier:latest\r\n          Timeout: 1\r\n          MemorySize: 128\r\n          PackageType: Image\r\n          Architectures: [\"arm64\"]\r\n          Environment:\r\n            Variables:\r\n              LOG_LEVEL: INFO\r\n              SLACK_TOKEN: !Ref SlackToken\r\n              SLACK_CHANNEL: !Ref SlackChannel\r\n\r\n\r\nCloudFormation throws the following error whilst creating the Lambda function.\r\n\r\n> Resource handler returned message: \"Source image\r\n> public.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier:latest\r\n> is not valid. Provide a valid source image. (Service: Lambda, Status\r\n> Code: 400, Request ID: 9150921d-4b35-44ae-a4eb-c137f2a779e9, Extended\r\n> Request ID: null)\" (RequestToken:\r\n> 616bb226-a46b-faf1-c959-aad09880b137, HandlerErrorCode:\r\n> InvalidRequest)\r\n\r\nHere's the ECR public gallery link: https://gallery.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier ", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": [{"source": "Text", "text": "I've created a public ECR repository and I try to refer the image as `ImageUri` under the `Code` block in my AWS::Lambda::Function. SlackNotifierFunction: Type: AWS::Lambda::Function Properties: FunctionName: !Join [\"-\", [!Ref Name, \"slack\", \"notifier\"]] Role: !GetAtt LambdaRole.Arn Code: ImageUri: public.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier:latest Timeout: 1 MemorySize: 128 PackageType: Image Architectures: [\"arm64\"] Environment: Variables: LOG_LEVEL: INFO SLACK_TOKEN: !Ref SlackToken SLACK_CHANNEL: !Ref SlackChannel CloudFormation throws the following error whilst creating the Lambda function. > Resource handler returned message: \"Source image > public.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier:latest > is not valid. ", "keywords": ["cost"]}, {"source": "Text", "text": "Provide a valid source image. (Service: Lambda, Status > Code: 400, Request ID: 9150921d-4b35-44ae-a4eb-c137f2a779e9, Extended > Request ID: null)\" (RequestToken: > 616bb226-a46b-faf1-c959-aad09880b137, HandlerErrorCode: > InvalidRequest) Here's the ECR public gallery link: https://gallery.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier", "keywords": ["cost"]}]}, {"Id": "258135572", "PostHistoryTypeId": "1", "PostId": "69997144", "RevisionGUID": "a28987e0-38a0-480d-9e6a-f5be72163f15", "CreationDate": "2021-11-16T23:11:58.147", "UserId": "13155217", "Text": "Specify ImageUri in AWS::Lambda::Function throws CF error", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}, {"Id": "258135573", "PostHistoryTypeId": "3", "PostId": "69997144", "RevisionGUID": "a28987e0-38a0-480d-9e6a-f5be72163f15", "CreationDate": "2021-11-16T23:11:58.147", "UserId": "13155217", "Text": "|amazon-web-services|aws-lambda|aws-cloudformation|", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "answers": [{"Id": "69997191", "PostTypeId": "2", "ParentId": "69997144", "CreationDate": "2021-11-16T23:17:37.153", "Score": "1", "Body": "<p>It seems like providing an image uri referring to a public ECR gallery hosted image is not possible as of today.</p>\n", "OwnerUserId": "13155217", "LastActivityDate": "2021-11-16T23:17:37.153", "CommentCount": "2", "ContentLicense": "CC BY-SA 4.0", "comments": [{"Id": "124347571", "PostId": "69997191", "Score": "1", "Text": "Where did you find this information and how are you meant to now provide a public lambda function for that uses a container that will be used via CloudFormation across multiple unrelated AWS accounts?", "CreationDate": "2021-12-14T05:22:37.923", "UserId": "840741", "filtered-sentences": []}, {"Id": "124347584", "PostId": "69997191", "Score": "1", "Text": "I ask as I am trying to do the same thing and ran into the same error that you've posted above.", "CreationDate": "2021-12-14T05:23:46.053", "UserId": "840741", "filtered-sentences": []}], "history": [{"Id": "258135814", "PostHistoryTypeId": "2", "PostId": "69997191", "RevisionGUID": "500a5e7a-30af-4cf6-ae36-b17a657bf4fa", "CreationDate": "2021-11-16T23:17:37.153", "UserId": "13155217", "Text": "It seems like providing an image uri referring to a public ECR gallery hosted image is not possible as of today.", "ContentLicense": "CC BY-SA 4.0", "filtered-sentences": []}], "filtered-sentences": []}], "contains-topic": false, "filtered-sentences": [{"source": "Body", "text": "Resource handler returned message: \"Source image public.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier:latest is not valid. ", "keywords": ["cost"]}, {"source": "Body", "text": "Provide a valid source image. (Service: Lambda, Status Code: 400, Request ID: 9150921d-4b35-44ae-a4eb-c137f2a779e9, Extended Request ID: null)\" (RequestToken: 616bb226-a46b-faf1-c959-aad09880b137, HandlerErrorCode: InvalidRequest) Here's the ECR public gallery link: https://gallery.ecr.aws/g9c9m7n7/aws-cost-anomaly-slack-notifier", "keywords": ["cost"]}]}